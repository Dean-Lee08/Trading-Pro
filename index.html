<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Trading Platform Pro</title>
  <!-- Ïô∏Î∂Ä CSS ÌååÏùº Ïó∞Í≤∞ -->
  <link rel="stylesheet" href="css/styles.css">
 </head>
 <body>
  <div class="toast-notification" id="toastNotification">
   Data saved successfully!
  </div>
  <button class="mobile-menu-toggle" onclick="toggleSidebar()">
   ‚ò∞
  </button>
  <!-- Date picker modal -->
  <div class="date-picker-modal" id="datePickerModal">
   <div class="date-picker-content">
    <div class="date-picker-title">
     Select Trading Date
    </div>
    <input class="date-picker-input" id="datePickerInput" type="date"/>
    <div class="date-picker-actions">
     <button class="btn btn-secondary" onclick="closeDatePicker()">
      Cancel
     </button>
     <button class="btn btn-primary" onclick="applySelectedDate()">
      Apply
     </button>
    </div>
   </div>
  </div>
  <!-- Edit trade modal -->
  <div class="edit-trade-modal" id="editTradeModal">
   <div class="edit-trade-content">
    <div class="edit-trade-title">
     Edit Trade
    </div>
    <form id="editTradeForm">
     <input id="editTradeId" type="hidden"/>
     <div class="form-grid">
      <div class="form-group">
       <label>
        Symbol
       </label>
       <input id="editSymbol" required="" type="text"/>
      </div>
      <div class="form-group">
       <label>
        Shares
       </label>
       <input id="editShares" required="" type="number"/>
      </div>
      <div class="form-group">
       <label>
        Buy Price
       </label>
       <input id="editBuyPrice" required="" step="0.0001" type="number"/>
      </div>
      <div class="form-group">
       <label>
        Sell Price
       </label>
       <input id="editSellPrice" required="" step="0.0001" type="number"/>
      </div>
      <div class="form-group">
       <label>
        Entry Time
       </label>
       <input id="editEntryTime" type="time"/>
      </div>
      <div class="form-group">
       <label>
        Exit Time
       </label>
       <input id="editExitTime" type="time"/>
      </div>
     </div>
     <div class="edit-trade-actions">
      <button class="btn btn-secondary" onclick="closeEditTradeModal()" type="button">
       Cancel
      </button>
      <button class="btn btn-primary" type="submit">
       Update Trade
      </button>
     </div>
    </form>
   </div>
  </div>
  <!-- Month Details Modal -->
  <div class="month-details-modal" id="monthDetailsModal">
   <div class="month-details-content">
    <div class="month-details-header" id="monthDetailsTitle">
     Month Details
    </div>
    <div class="month-details-stats">
     <div class="month-detail-stat">
      <div class="month-detail-stat-value" id="monthDetailPnl">
       $0.00
      </div>
      <div class="month-detail-stat-label" data-lang="total-pl">
       Total P/L
      </div>
     </div>
     <div class="month-detail-stat">
      <div class="month-detail-stat-value neutral" id="monthDetailTrades">
       0
      </div>
      <div class="month-detail-stat-label" data-lang="total-trades">
       Total Trades
      </div>
     </div>
     <div class="month-detail-stat">
      <div class="month-detail-stat-value" id="monthDetailWinRate">
       0%
      </div>
      <div class="month-detail-stat-label" data-lang="win-rate">
       Win Rate
      </div>
     </div>
    </div>
    <div style="margin-bottom: 16px;">
     <button class="btn btn-primary" data-lang="view-full-month" onclick="navigateToMonth()" style="width: 100%;">
      View Full Month Calendar
     </button>
    </div>
    <div style="display: flex; justify-content: center;">
     <button class="btn btn-secondary" data-lang="close" onclick="closeMonthDetails()">
      Close
     </button>
    </div>
   </div>
  </div>
  <!-- Week Details Modal -->
  <div class="month-details-modal" id="weekDetailsModal">
   <div class="month-details-content">
    <div class="month-details-header" id="weekDetailsTitle">
     Week Details
    </div>
    <div class="month-details-stats">
     <div class="month-detail-stat">
      <div class="month-detail-stat-value" id="weekDetailPnl">
       $0.00
      </div>
      <div class="month-detail-stat-label" data-lang="total-pl">
       Total P/L
      </div>
     </div>
     <div class="month-detail-stat">
      <div class="month-detail-stat-value neutral" id="weekDetailTrades">
       0
      </div>
      <div class="month-detail-stat-label" data-lang="total-trades">
       Total Trades
      </div>
     </div>
     <div class="month-detail-stat">
      <div class="month-detail-stat-value" id="weekDetailWinRate">
       0%
      </div>
      <div class="month-detail-stat-label" data-lang="win-rate">
       Win Rate
      </div>
     </div>
    </div>
    <div style="max-height: 200px; overflow-y: auto; margin-bottom: 16px;">
     <div id="weekTradesList">
     </div>
    </div>
    <div style="display: flex; justify-content: center;">
     <button class="btn btn-secondary" data-lang="close" onclick="closeWeekDetails()">
      Close
     </button>
    </div>
   </div>
  </div>
  <div class="app-container">
   <!-- Sidebar -->
   <nav class="sidebar" id="sidebar">
    <div class="sidebar-header">
     <div class="sidebar-brand">
      <div class="sidebar-title">
       TradingPro
      </div>
      <div class="sidebar-subtitle">
       Advanced Trading Journal
      </div>
     </div>
    </div>
    <div class="nav-menu">
     <button class="nav-item active" onclick="showPage('dashboard')">
      <span class="nav-item-icon">
       üìä
      </span>
      <span data-lang="dashboard">
       Dashboard
      </span>
     </button>
     <button class="nav-item" onclick="showPage('calendar')">
      <span class="nav-item-icon">
       üìÖ
      </span>
      <span data-lang="calendar">
       Calendar View
      </span>
     </button>
     <button class="nav-item" onclick="showPage('analysis')">
      <span class="nav-item-icon">
       üìà
      </span>
      <span data-lang="analytics">
       Analytics
      </span>
     </button>
     <button class="nav-item" onclick="showPage('psychology')">
      <span class="nav-item-icon">
       üß†
      </span>
      <span data-lang="psychology">
       Psychology
      </span>
     </button>
     <button class="nav-item" onclick="showPage('notes')">
      <span class="nav-item-icon">
       üìù
      </span>
      <span data-lang="notes">
       Notes
      </span>
     </button>
     <button class="nav-item" onclick="showPage('trades')">
      <span class="nav-item-icon">
       üìã
      </span>
      <span data-lang="tradelist">
       Trade List
      </span>
     </button>
     <button class="nav-item" onclick="showPage('settings')">
      <span class="nav-item-icon">
       ‚öôÔ∏è
      </span>
      <span data-lang="settings">
       Settings
      </span>
     </button>
    </div>
   </nav>
   <!-- Main content -->
   <main class="main-content" id="mainContent">
    <!-- Dashboard page -->
    <div class="page active" id="dashboard">
     <div class="page-header">
      <div>
       <h1 class="page-title" data-lang="dashboard-title">
        Trading Dashboard
       </h1>
       <p class="page-subtitle" data-lang="dashboard-subtitle">
        Track your trades and performance
       </p>
      </div>
      <div class="page-header-info">
       <div class="date-range-selector">
        <input class="date-range-input" id="dashboardStartDate" type="date"/>
        <span style="color: #64748b;">
         to
        </span>
        <input class="date-range-input" id="dashboardEndDate" type="date"/>
        <button class="btn btn-secondary" onclick="clearDashboardRange()" style="padding: 4px 8px; font-size: 12px;">
         Clear
        </button>
       </div>
       <div class="date-navigation">
        <button class="date-nav-btn" onclick="changeTradingDate(-1)" title="Previous day">
         &larr;
        </button>
        <div class="current-date-display" id="currentDateDisplay" onclick="openDatePicker()">
        </div>
        <button class="date-nav-btn" onclick="changeTradingDate(1)" title="Next day">
         &rarr;
        </button>
       </div>
       <div class="dashboard-tabs">
        <button class="dashboard-tab active" data-lang="trading-record" onclick="showDashboardSection('trading')">
         Í±∞Îûò Í∏∞Î°ù
        </button>
        <button class="dashboard-tab" data-lang="position-calculator" onclick="showDashboardSection('position-calc')">
         Position Calculator
        </button>
       </div>
      </div>
     </div>
     <div class="stats-overview">
      <div class="stat-item">
       <h3 data-lang="total-pl">
        Total P/L
       </h3>
       <div class="stat-value" id="totalPL">
        $0.00
       </div>
       <div class="stat-subtitle" data-lang="net-result">
        Net Result
       </div>
      </div>
      <div class="stat-item">
       <h3 data-lang="trades">
        Trades
       </h3>
       <div class="stat-value neutral" id="totalTrades">
        0
       </div>
       <div class="stat-subtitle" data-lang="total-count">
        Total Count
       </div>
      </div>
      <div class="stat-item">
       <h3 data-lang="win-rate">
        Win Rate
       </h3>
       <div class="stat-value" id="winRate">
        0%
       </div>
       <div class="stat-subtitle" id="winLossCount">
        0W / 0L
       </div>
      </div>
     </div>
     <!-- Position Calculator Section -->
     <div class="position-calculator-section" id="positionCalculatorSection">
      <div class="calculator-main-grid">
       <div class="stats-sidebar">
        <div class="sidebar-title-stats" data-lang="position-analysis">
         Position Analysis
        </div>
        <div class="sidebar-stat">
         <span class="sidebar-stat-label" data-lang="recommended-size">
          Recommended Size
         </span>
         <span class="sidebar-stat-value positive" id="recommendedSize">
          $0
         </span>
        </div>
        <div class="sidebar-stat">
         <span class="sidebar-stat-label" data-lang="account-utilization">
          Account Utilization
         </span>
         <span class="sidebar-stat-value neutral" id="accountUtil">
          0%
         </span>
        </div>
        <div class="sidebar-stat">
         <span class="sidebar-stat-label" data-lang="expected-value">
          Expected Value
         </span>
         <span class="sidebar-stat-value" id="expectedVal">
          $0
         </span>
        </div>
        <div style="margin-top: 20px; padding-top: 16px; border-top: 1px solid #334155;">
         <div class="sidebar-title-stats" data-lang="auto-analysis" style="font-size: 14px;">
          ÏûêÎèô Î∂ÑÏÑù
         </div>
         <div class="sidebar-stat">
          <span class="sidebar-stat-label" data-lang="position-size">
           Ìè¨ÏßÄÏÖò ÌÅ¨Í∏∞
          </span>
          <span class="sidebar-stat-value positive" id="riskPositionSizeSidebar">
           $0
          </span>
         </div>
         <div class="sidebar-stat">
          <span class="sidebar-stat-label" data-lang="shares-quantity">
           Ï£ºÏãù ÏàòÎüâ
          </span>
          <span class="sidebar-stat-value neutral" id="riskSharesQuantitySidebar">
           0
          </span>
         </div>
         <div class="sidebar-stat">
          <span class="sidebar-stat-label" data-lang="risk-per-share">
           Ï£ºÎãπ Î¶¨Ïä§ÌÅ¨
          </span>
          <span class="sidebar-stat-value neutral" id="riskPerShareSidebar">
           $0.00
          </span>
         </div>
         <div class="sidebar-stat">
          <span class="sidebar-stat-label" data-lang="max-loss">
           ÏµúÎåÄ ÏÜêÏã§
          </span>
          <span class="sidebar-stat-value negative" id="riskMaxLossSidebar">
           $0.00
          </span>
         </div>
         <div class="sidebar-stat">
          <span class="sidebar-stat-label" data-lang="position-cost">
           Ìè¨ÏßÄÏÖò ÎπÑÏö©
          </span>
          <span class="sidebar-stat-value neutral" id="riskPositionCostSidebar">
           $0.00
          </span>
         </div>
        </div>
       </div>
       <div class="calculator-container">
        <!-- Calculator Tabs -->
        <div style="display: flex; background: #0f172a; border: 1px solid #334155; border-radius: 8px; overflow: hidden; margin-bottom: 20px;">
         <button class="position-calc-tab active" data-lang="kelly-calculator" onclick="showCalculatorTab('kelly')" style="background: #3b82f6; border: none; color: white; padding: 12px 20px; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.2s ease; border-right: 1px solid #334155; flex: 1;">
          Kelly Calculator
         </button>
         <button class="position-calc-tab" data-lang="risk-calculator" onclick="showCalculatorTab('risk')" style="background: transparent; border: none; color: #94a3b8; padding: 12px 20px; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.2s ease; flex: 1;">
          Risk Calculator
         </button>
        </div>
        <!-- Kelly Calculator Content -->
        <div class="calculator-content" id="kellyCalculator">
         <h2 class="calculator-title" data-lang="kelly-criterion-calculator">
          Kelly Criterion Calculator
         </h2>
         <div class="calc-grid">
          <div class="calc-input-group">
           <label class="calc-label" data-lang="account-balance">
            Í≥ÑÏ¢å ÏûîÍ≥† ($)
           </label>
           <input class="calc-input" id="calcAccountBalance" oninput="calculatePosition()" type="number" value=""/>
          </div>
          <div class="calc-input-group">
           <label class="calc-label" data-lang="win-rate-input">
            ÏäπÎ•† (%)
           </label>
           <input class="calc-input" id="calcWinRate" max="100" min="0" oninput="calculatePosition()" type="number" value=""/>
          </div>
          <div class="calc-input-group">
           <label class="calc-label" data-lang="average-win">
            ÌèâÍ∑† ÏàòÏùµ ($)
           </label>
           <input class="calc-input" id="calcAvgWin" oninput="calculatePosition()" type="number" value=""/>
          </div>
          <div class="calc-input-group">
           <label class="calc-label" data-lang="average-loss">
            ÌèâÍ∑† ÏÜêÏã§ ($)
           </label>
           <input class="calc-input" id="calcAvgLoss" oninput="calculatePosition()" type="number" value=""/>
          </div>
         </div>
         <div class="calc-input-group">
          <button class="btn btn-secondary" data-lang="auto-load-trade-data" onclick="autoLoadTradeData()" style="width: 100%;">
           Auto Load from Trade History
          </button>
         </div>
         <div class="kelly-options">
          <div class="kelly-options-title" data-lang="kelly-strategies">
           Position Sizing Strategy
          </div>
          <div class="kelly-option selected" data-multiplier="0.1" onclick="selectKellyMultiplier(this)">
           <div class="kelly-option-label" data-lang="ultra-safe">
            Ultra Safe
           </div>
           <div class="kelly-option-value">
            10% Kelly
           </div>
          </div>
          <div class="kelly-option" data-multiplier="0.25" onclick="selectKellyMultiplier(this)">
           <div class="kelly-option-label" data-lang="conservative">
            Conservative
           </div>
           <div class="kelly-option-value">
            25% Kelly
           </div>
          </div>
          <div class="kelly-option" data-multiplier="0.5" onclick="selectKellyMultiplier(this)">
           <div class="kelly-option-label" data-lang="moderate">
            Moderate
           </div>
           <div class="kelly-option-value">
            50% Kelly
           </div>
          </div>
         </div>
        </div>
        <!-- Risk Calculator Content -->
        <div class="calculator-content" id="riskCalculator" style="display: none;">
         <h2 class="calculator-title" data-lang="risk-management-calculator">
          Risk Management Calculator
         </h2>
         <div class="calc-grid">
          <div class="calc-input-group">
           <label class="calc-label" data-lang="account-balance">
            Í≥ÑÏ¢å ÏûîÍ≥† ($)
           </label>
           <input class="calc-input" id="riskAccountBalance" oninput="calculateRiskPosition()" type="number" value=""/>
          </div>
          <div class="calc-input-group">
           <label class="calc-label" data-lang="risk-percentage">
            Î¶¨Ïä§ÌÅ¨ ÎπÑÏú® (%)
           </label>
           <input class="calc-input" id="riskPercentage" max="10" min="0.1" oninput="calculateRiskPosition()" step="1" type="number" value=""/>
          </div>
          <div class="calc-input-group">
           <label class="calc-label" data-lang="entry-price">
            ÏßÑÏûÖ Í∞ÄÍ≤© ($)
           </label>
           <input class="calc-input" id="riskEntryPrice" oninput="calculateRiskPosition()" step="0.01" type="number" value=""/>
          </div>
          <div class="calc-input-group">
           <label class="calc-label" data-lang="stop-loss-price">
            ÏÜêÏ†à Í∞ÄÍ≤© ($)
           </label>
           <input class="calc-input" id="riskStopPrice" oninput="calculateRiskPosition()" step="0.01" type="number" value=""/>
          </div>
         </div>
         <div class="risk-preset-section">
          <div class="risk-preset-title">
           Î¶¨Ïä§ÌÅ¨ ÎπÑÏú®
          </div>
          <div class="risk-preset-buttons" style="gap: 4px;">
           <button class="risk-preset-btn" onclick="setRiskPreset(1)" style="background: #374151 !important; border: 1px solid #4b5563 !important; color: #e4e4e7 !important; padding: 8px 16px !important; border-radius: 6px !important; cursor: pointer !important; font-size: 13px !important; font-weight: 500 !important; transition: all 0.2s ease !important; min-width: 60px !important;">
            1%
           </button>
           <button class="risk-preset-btn active" onclick="setRiskPreset(2)" style="background: #3b82f6 !important; border: 1px solid #3b82f6 !important; color: white !important; padding: 8px 16px !important; border-radius: 6px !important; cursor: pointer !important; font-size: 13px !important; font-weight: 500 !important; transition: all 0.2s ease !important; min-width: 60px !important;">
            2%
           </button>
           <button class="risk-preset-btn" onclick="setRiskPreset(3)" style="background: #374151 !important; border: 1px solid #4b5563 !important; color: #e4e4e7 !important; padding: 8px 16px !important; border-radius: 6px !important; cursor: pointer !important; font-size: 13px !important; font-weight: 500 !important; transition: all 0.2s ease !important; min-width: 60px !important;">
            3%
           </button>
           <button class="risk-preset-btn" onclick="setRiskPreset(5)" style="background: #374151 !important; border: 1px solid #4b5563 !important; color: #e4e4e7 !important; padding: 8px 16px !important; border-radius: 6px !important; cursor: pointer !important; font-size: 13px !important; font-weight: 500 !important; transition: all 0.2s ease !important; min-width: 60px !important;">
            5%
           </button>
          </div>
         </div>
         <div class="calc-results">
          <div class="calc-result-item">
           <span class="calc-result-label" data-lang="position-size">
            Position Size
           </span>
           <span class="calc-result-value positive" id="riskPositionSize">
            $0
           </span>
          </div>
          <div class="calc-result-item">
           <span class="calc-result-label" data-lang="shares-quantity">
            Shares Quantity
           </span>
           <span class="calc-result-value neutral" id="riskSharesQuantity">
            0
           </span>
          </div>
          <div class="calc-result-item">
           <span class="calc-result-label" data-lang="risk-per-share">
            Risk per Share
           </span>
           <span class="calc-result-value neutral" id="riskPerShare">
            $0.00
           </span>
          </div>
          <div class="calc-result-item">
           <span class="calc-result-label" data-lang="max-loss">
            Max Loss
           </span>
           <span class="calc-result-value negative" id="riskMaxLoss">
            $0.00
           </span>
          </div>
          <div class="calc-result-item">
           <span class="calc-result-label" data-lang="position-cost">
            Position Cost
           </span>
           <span class="calc-result-value neutral" id="riskPositionCost">
            $0.00
           </span>
          </div>
          <div class="calc-result-item">
           <span class="calc-result-label" data-lang="account-utilization">
            Account Utilization
           </span>
           <span class="calc-result-value neutral" id="riskAccountUtil">
            0.00%
           </span>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <div class="dashboard-grid">
      <div class="trade-entry">
       <h2 data-lang="record-trade">
        Record Trade
       </h2>
       <form id="tradeForm">
        <div class="form-grid">
         <div class="form-group">
          <label data-lang="symbol">
           Symbol
          </label>
          <input id="symbol" placeholder="AAPL" required="" type="text"/>
         </div>
         <div class="form-group">
          <label data-lang="shares">
           Shares
          </label>
          <input id="shares" oninput="calculatePnL()" placeholder="100" required="" type="number"/>
         </div>
         <div class="form-group">
          <label data-lang="buy-price">
           Buy Price
          </label>
          <input id="buyPrice" oninput="calculatePnL()" placeholder="150.25" required="" step="0.0001" type="number"/>
         </div>
         <div class="form-group">
          <label data-lang="sell-price">
           Sell Price
          </label>
          <input id="sellPrice" oninput="calculatePnL()" placeholder="155.50" required="" step="0.0001" type="number"/>
         </div>
         <div class="form-group">
          <label data-lang="return-pct">
           Return %
          </label>
          <input id="returnPct" readonly="" style="background: #0f172a; color: #10b981;" type="text"/>
         </div>
         <div class="form-group">
          <label data-lang="pnl">
           P&amp;L
          </label>
          <input id="pnlDisplay" readonly="" style="background: #0f172a; color: #10b981;" type="text"/>
         </div>
         <div class="form-group">
          <label data-lang="entry-time">
           Entry Time
          </label>
          <div class="time-input-container">
           <input id="entryTime" type="time" value=""/>
           <button class="time-edit-btn" data-lang="edit" onclick="toggleTimeEdit()" type="button">
            Edit
           </button>
          </div>
         </div>
         <div class="form-group">
          <label data-lang="exit-time">
           Exit Time
          </label>
          <input id="exitTime" onchange="calculateHoldingTime()" type="time" value=""/>
         </div>
         <div class="form-group">
          <label data-lang="holding-time">
           Holding Time
          </label>
          <input id="holdingTimeDisplay" readonly="" style="background: #0f172a; color: #64748b;" type="text"/>
         </div>
         <div class="form-group">
          <label data-lang="amount">
           Amount ($)
          </label>
          <input id="amountDisplay" readonly="" style="background: #0f172a; color: #94a3b8;" type="text"/>
         </div>
        </div>
        <div class="form-actions">
         <button class="btn btn-secondary" data-lang="reset" onclick="resetForm()" type="button">
          Reset
         </button>
         <button class="btn btn-primary" data-lang="add-trade" type="submit">
          Add Trade
         </button>
        </div>
       </form>
      </div>
      <div>
       <div class="stats-sidebar">
        <div class="sidebar-title-stats" data-lang="performance">
         Performance
        </div>
        <div class="sidebar-stat">
         <span class="sidebar-stat-label" data-lang="best-trade">
          Best Trade
         </span>
         <span class="sidebar-stat-value positive" id="bestTrade">
          $0.00
         </span>
        </div>
        <div class="sidebar-stat">
         <span class="sidebar-stat-label" data-lang="worst-trade">
          Worst Trade
         </span>
         <span class="sidebar-stat-value negative" id="worstTrade">
          $0.00
         </span>
        </div>
        <div class="sidebar-stat">
         <span class="sidebar-stat-label" data-lang="avg-win">
          Avg Win
         </span>
         <span class="sidebar-stat-value positive" id="avgWin">
          $0.00
         </span>
        </div>
        <div class="sidebar-stat">
         <span class="sidebar-stat-label" data-lang="avg-loss">
          Avg Loss
         </span>
         <span class="sidebar-stat-value negative" id="avgLoss">
          $0.00
         </span>
        </div>
        <div class="sidebar-stat">
         <span class="sidebar-stat-label" data-lang="total-invested">
          Total Invested
         </span>
         <span class="sidebar-stat-value neutral" id="totalVolume">
          $0.00
         </span>
        </div>
        <div class="sidebar-stat">
         <span class="sidebar-stat-label" data-lang="profit-factor">
          Profit Factor
         </span>
         <span class="sidebar-stat-value" id="profitFactorSidebar">
          0.00
         </span>
        </div>
       </div>
       <div class="daily-fees-section">
        <div class="daily-fees-title" data-lang="daily-fees">
         Daily Fees
        </div>
        <input class="daily-fees-input" id="dailyFees" onchange="saveDailyFees()" placeholder="0.00" step="0.01" type="number"/>
       </div>
      </div>
     </div>
     <div class="trades-section">
      <div class="trades-header">
       <h2 data-lang="trade-history">
        Trade History
       </h2>
       <div style="display: flex; gap: 12px; align-items: center;">
        <button class="btn btn-secondary" data-lang="delete-selected" id="deleteSelectedBtn" onclick="deleteSelectedTrades()" style="display: none; background: #dc2626; border-color: #dc2626;">
         Delete Selected
        </button>
        <div class="period-summary" id="periodSummary">
        </div>
       </div>
      </div>
      <table class="trades-table">
       <thead>
        <tr>
         <th style="width: 40px;">
          <input id="selectAllTrades" onchange="toggleAllTrades()" style="accent-color: #3b82f6;" type="checkbox"/>
         </th>
         <th data-lang="date">
          Date
         </th>
         <th data-lang="symbol">
          Symbol
         </th>
         <th data-lang="buy-price">
          Buy Price
         </th>
         <th data-lang="sell-price">
          Sell Price
         </th>
         <th data-lang="shares">
          Shares
         </th>
         <th data-lang="amount">
          Amount
         </th>
         <th data-lang="time">
          Time
         </th>
         <th data-lang="pnl">
          P&amp;L
         </th>
         <th data-lang="return-pct">
          Return %
         </th>
         <th data-lang="actions">
          Actions
         </th>
        </tr>
       </thead>
       <tbody id="tradesTableBody">
        <tr>
         <td colspan="10">
          <div class="empty-state">
           <div class="empty-state-icon">
            üìä
           </div>
           <div data-lang="no-trades">
            No trades recorded yet
           </div>
          </div>
         </td>
        </tr>
       </tbody>
      </table>
     </div>
    </div>
    <!-- Calendar page -->
    <div class="page" id="calendar">
     <div class="page-header">
      <div>
       <h1 class="page-title" data-lang="calendar-title">
        Calendar View
       </h1>
       <p class="page-subtitle" data-lang="calendar-subtitle">
        Visualize your trading performance over time
       </p>
      </div>
     </div>
     <div class="calendar-container">
      <div class="calendar-main-grid">
       <div class="calendar-left">
        <div class="calendar-controls">
         <div class="calendar-nav">
          <button onclick="changeMonth(-1)">
           &larr; Previous
          </button>
          <h2 class="calendar-title" id="calendarTitle">
           January 2024
          </h2>
          <button onclick="changeMonth(1)">
           Next &rarr;
          </button>
         </div>
         <button class="btn btn-secondary" data-lang="clear-selection" onclick="clearCalendarRange()" style="padding: 6px 12px; font-size: 12px;">
          Clear Selection
         </button>
        </div>
        <div class="calendar-selection-info" data-lang="calendar-help" id="calendarSelectionInfo">
         Click and drag on calendar to select date range, or click on a day to see details
        </div>
        <div class="calendar-stats-summary" id="calendarStatsSummary">
         <div class="calendar-stat-item">
          <div class="calendar-stat-label" data-lang="selected-period">
           Selected Period
          </div>
          <div class="calendar-stat-value neutral" id="calendarPeriodLabel">
           Current Month
          </div>
         </div>
         <div class="calendar-stat-item">
          <div class="calendar-stat-label" data-lang="total-trades">
           Total Trades
          </div>
          <div class="calendar-stat-value neutral" id="calendarTotalTrades">
           0
          </div>
         </div>
         <div class="calendar-stat-item">
          <div class="calendar-stat-label" data-lang="total-pl">
           Total P/L
          </div>
          <div class="calendar-stat-value" id="calendarTotalPL">
           $0.00
          </div>
         </div>
         <div class="calendar-stat-item">
          <div class="calendar-stat-label" data-lang="avg-daily-pl">
           Avg Daily P/L
          </div>
          <div class="calendar-stat-value" id="calendarAvgDaily">
           $0.00
          </div>
         </div>
         <div class="calendar-stat-item">
          <div class="calendar-stat-label" data-lang="best-day">
           Best Day
          </div>
          <div class="calendar-stat-value positive" id="calendarBestDay">
           $0.00
          </div>
         </div>
         <div class="calendar-stat-item">
          <div class="calendar-stat-label" data-lang="worst-day">
           Worst Day
          </div>
          <div class="calendar-stat-value negative" id="calendarWorstDay">
           $0.00
          </div>
         </div>
        </div>
        <div class="calendar-grid" id="calendarGrid">
         <div class="calendar-day-header">
          Sun
         </div>
         <div class="calendar-day-header">
          Mon
         </div>
         <div class="calendar-day-header">
          Tue
         </div>
         <div class="calendar-day-header">
          Wed
         </div>
         <div class="calendar-day-header">
          Thu
         </div>
         <div class="calendar-day-header">
          Fri
         </div>
         <div class="calendar-day-header">
          Sat
         </div>
         <div class="calendar-day-header" id="weekPnlHeader" style="display: none;">
          Week P/L
         </div>
        </div>
       </div>
       <!-- Right sidebar -->
       <div class="calendar-sidebar">
        <div class="sidebar-title-calendar" data-lang="weekly-summary">
         Weekly Summary
        </div>
        <div class="weekly-summary" id="weeklySummary">
         <div class="weekly-item">
          <span class="weekly-label" data-lang="selected-week">
           Selected Week
          </span>
          <span class="weekly-value neutral" id="selectedWeekLabel">
           -
          </span>
         </div>
         <div class="weekly-item">
          <span class="weekly-label" data-lang="week-trades">
           Week Trades
          </span>
          <span class="weekly-value neutral" id="selectedWeekTrades">
           0
          </span>
         </div>
         <div class="weekly-item">
          <span class="weekly-label" data-lang="week-pnl">
           Week P/L
          </span>
          <span class="weekly-value" id="selectedWeekPnl">
           $0.00
          </span>
         </div>
         <div class="weekly-item">
          <span class="weekly-label" data-lang="week-win-rate">
           Week Win Rate
          </span>
          <span class="weekly-value" id="selectedWeekWinRate">
           0%
          </span>
         </div>
         <div class="weekly-item">
          <span class="weekly-label" data-lang="week-best-day">
           Best Day
          </span>
          <span class="weekly-value positive" id="selectedWeekBestDay">
           $0.00
          </span>
         </div>
         <div class="weekly-item">
          <span class="weekly-label" data-lang="week-worst-day">
           Worst Day
          </span>
          <span class="weekly-value negative" id="selectedWeekWorstDay">
           $0.00
          </span>
         </div>
        </div>
        <!-- Day details section -->
        <div class="day-details" id="dayDetails" style="display: none;">
         <div class="day-details-title" id="dayDetailsTitle">
          Selected Day
         </div>
         <div id="dayTradesList">
          <!-- Individual trades for selected day -->
         </div>
        </div>
       </div>
      </div>
      <!-- Annual Heatmap moved here - below main calendar -->
      <div class="annual-heatmap-container">
       <div class="annual-heatmap-title" id="annualHeatmapTitle">
        2024 Trading Overview
       </div>
       <div class="annual-heatmap-grid" id="annualHeatmapGrid">
        <!-- Month heatmaps will be generated here -->
       </div>
      </div>
     </div>
    </div>
    <!-- Enhanced Analytics page -->
    <div class="page" id="analysis">
     <div class="analytics-container">
      <div class="analytics-header">
       <div class="analytics-title-section">
        <div class="analytics-tabs">
         <button class="analytics-tab active" data-lang="detail" onclick="showAnalyticsSection('detail')">
          Detail
         </button>
         <button class="analytics-tab" data-lang="charts" onclick="showAnalyticsSection('charts')">
          Charts
         </button>
        </div>
       </div>
       <div class="filter-controls">
        <div class="date-range-selector">
         <input class="date-range-input" id="analyticsStartDate" type="date"/>
         <span style="color: #64748b;">
          to
         </span>
         <input class="date-range-input" id="analyticsEndDate" type="date"/>
         <button class="btn btn-secondary" onclick="clearAnalyticsRange()" style="padding: 4px 8px; font-size: 12px;">
          Clear
         </button>
        </div>
        <button class="filter-btn active" data-lang="all-time" onclick="setAnalyticsPeriod('all')">
         All Time
        </button>
        <button class="filter-btn" data-lang="this-month" onclick="setAnalyticsPeriod('month')">
         This Month
        </button>
        <button class="filter-btn" data-lang="this-week" onclick="setAnalyticsPeriod('week')">
         This Week
        </button>
        <button class="filter-btn" data-lang="today" onclick="setAnalyticsPeriod('day')">
         Today
        </button>
       </div>
      </div>
      <!-- Performance Summary Cards -->
      <div class="performance-summary">
       <div class="performance-summary-title" data-lang="performance-summary">
        Performance Summary
       </div>
       <div class="summary-cards">
        <div class="summary-card">
         <div class="summary-card-value" id="summaryNetProfit">
          $0.00
         </div>
         <div class="summary-card-label" data-lang="net-profit">
          Net Profit
         </div>
        </div>
        <div class="summary-card">
         <div class="summary-card-value neutral" id="summaryTotalTrades">
          0
         </div>
         <div class="summary-card-label" data-lang="total-trades">
          Total Trades
         </div>
        </div>
        <div class="summary-card">
         <div class="summary-card-value" id="summaryWinRate">
          0%
         </div>
         <div class="summary-card-label" data-lang="win-rate">
          Win Rate
         </div>
        </div>
        <div class="summary-card">
         <div class="summary-card-value" id="summaryProfitFactor">
          0.00
         </div>
         <div class="summary-card-label" data-lang="profit-factor">
          Profit Factor
         </div>
        </div>
        <div class="summary-card">
         <div class="summary-card-value" id="summaryLargestWin">
          $0.00
         </div>
         <div class="summary-card-label" data-lang="largest-win">
          Largest Win
         </div>
        </div>
        <div class="summary-card">
         <div class="summary-card-value" id="summaryLargestLoss">
          $0.00
         </div>
         <div class="summary-card-label" data-lang="largest-loss">
          Largest Loss
         </div>
        </div>
       </div>
      </div>
      <!-- Detail Section -->
      <div class="detail-section active" id="detailSection">
       <div class="detail-grid">
        <!-- Trading Performance -->
        <div class="detail-card">
         <div class="detail-card-header" data-lang="trading-performance" onclick="toggleDetailCard(this)">
          Trading Performance
          <span class="collapse-icon">
           ‚ñº
          </span>
         </div>
         <div class="detail-card-content">
          <div class="detail-item">
           <span class="detail-label" data-lang="total-pl">
            Total P&amp;L
           </span>
           <span class="detail-value" id="detailTotalPL">
            $0.00
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="total-gain">
            Total Gain
           </span>
           <span class="detail-value positive" id="detailTotalGain">
            $0.00
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="total-loss">
            Total Loss
           </span>
           <span class="detail-value negative" id="detailTotalLoss">
            $0.00
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="total-fees">
            Total Fees
           </span>
           <span class="detail-value neutral" id="detailTotalFees">
            $0.00
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="total-volume">
            Total Volume
           </span>
           <span class="detail-value neutral" id="detailTotalVolume">
            $0.00
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="profit-factor">
            Profit Factor
           </span>
           <span class="detail-value" id="detailProfitFactor">
            0.00
           </span>
          </div>
         </div>
        </div>
        <!-- Win/Loss Statistics -->
        <div class="detail-card">
         <div class="detail-card-header" data-lang="win-loss-stats" onclick="toggleDetailCard(this)">
          Win/Loss Statistics
          <span class="collapse-icon">
           ‚ñº
          </span>
         </div>
         <div class="detail-card-content">
          <div class="detail-item">
           <span class="detail-label" data-lang="winning-trades">
            Winning Trades
           </span>
           <span class="detail-value positive" id="detailWinningTrades">
            0 (0%)
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="losing-trades">
            Losing Trades
           </span>
           <span class="detail-value negative" id="detailLosingTrades">
            0 (0%)
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="avg-winning-trade">
            Avg Winning Trade
           </span>
           <span class="detail-value positive" id="detailAvgWinningTrade">
            $0.00
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="avg-losing-trade">
            Avg Losing Trade
           </span>
           <span class="detail-value negative" id="detailAvgLosingTrade">
            $0.00
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="largest-win">
            Largest Win
           </span>
           <span class="detail-value positive" id="detailLargestWin">
            $0.00
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="largest-loss">
            Largest Loss
           </span>
           <span class="detail-value negative" id="detailLargestLoss">
            $0.00
           </span>
          </div>
         </div>
        </div>
        <!-- Daily Performance -->
        <div class="detail-card">
         <div class="detail-card-header" data-lang="daily-performance" onclick="toggleDetailCard(this)">
          Daily Performance
          <span class="collapse-icon">
           ‚ñº
          </span>
         </div>
         <div class="detail-card-content">
          <div class="detail-item">
           <span class="detail-label" data-lang="daily-per-win">
            Daily P&amp;L per Win
           </span>
           <span class="detail-value positive" id="detailDailyPerWin">
            $0.00
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="daily-per-loss">
            Daily P&amp;L per Loss
           </span>
           <span class="detail-value negative" id="detailDailyPerLoss">
            $0.00
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="daily-per-fees">
            Daily Fees per Day
           </span>
           <span class="detail-value neutral" id="detailDailyPerFees">
            $0.00
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="best-trading-day">
            Best Trading Day
           </span>
           <span class="detail-value positive" id="detailBestTradingDay">
            $0.00
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="worst-trading-day">
            Worst Trading Day
           </span>
           <span class="detail-value negative" id="detailWorstTradingDay">
            $0.00
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="avg-daily-pl">
            Avg Daily P&amp;L
           </span>
           <span class="detail-value" id="detailAvgDailyPL">
            $0.00
           </span>
          </div>
         </div>
        </div>
        <!-- Time Analysis -->
        <div class="detail-card">
         <div class="detail-card-header" data-lang="time-analysis" onclick="toggleDetailCard(this)">
          Time Analysis
          <span class="collapse-icon">
           ‚ñº
          </span>
         </div>
         <div class="detail-card-content">
          <div class="detail-item">
           <span class="detail-label" data-lang="avg-hold-time">
            Avg Hold Time
           </span>
           <span class="detail-value neutral" id="detailAvgHoldTime">
            0m
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="shortest-hold">
            Shortest Hold
           </span>
           <span class="detail-value neutral" id="detailShortestHold">
            0m
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="longest-hold">
            Longest Hold
           </span>
           <span class="detail-value neutral" id="detailLongestHold">
            0m
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="best-trading-hour">
            Best Trading Hour
           </span>
           <span class="detail-value" id="detailBestHour">
            -
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="worst-trading-hour">
            Worst Trading Hour
           </span>
           <span class="detail-value" id="detailWorstHour">
            -
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="best-day-week">
            Best Day of Week
           </span>
           <span class="detail-value" id="detailBestDayOfWeek">
            -
           </span>
          </div>
         </div>
        </div>
        <!-- Trading Activity -->
        <div class="detail-card">
         <div class="detail-card-header" data-lang="trading-activity" onclick="toggleDetailCard(this)">
          Trading Activity
          <span class="collapse-icon">
           ‚ñº
          </span>
         </div>
         <div class="detail-card-content">
          <div class="detail-item">
           <span class="detail-label" data-lang="trading-days">
            Trading Days
           </span>
           <span class="detail-value neutral" id="detailTradingDays">
            0
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="avg-trades-per-day">
            Avg Trades per Day
           </span>
           <span class="detail-value neutral" id="detailAvgTradesPerDay">
            0.00
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="max-trades-day">
            Max Trades in Day
           </span>
           <span class="detail-value neutral" id="detailMaxTradesDay">
            0
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="avg-position-size">
            Avg Position Size
           </span>
           <span class="detail-value neutral" id="detailAvgPositionSize">
            $0
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="largest-position">
            Largest Position
           </span>
           <span class="detail-value neutral" id="detailLargestPosition">
            $0
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="smallest-position">
            Smallest Position
           </span>
           <span class="detail-value neutral" id="detailSmallestPosition">
            $0
           </span>
          </div>
         </div>
        </div>
        <!-- Streak Analysis -->
        <div class="detail-card">
         <div class="detail-card-header" data-lang="streak-analysis" onclick="toggleDetailCard(this)">
          Streak Analysis
          <span class="collapse-icon">
           ‚ñº
          </span>
         </div>
         <div class="detail-card-content">
          <div class="detail-item">
           <span class="detail-label" data-lang="current-streak">
            Current Streak
           </span>
           <span class="detail-value" id="detailCurrentStreak">
            0
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="max-win-streak">
            Max Win Streak
           </span>
           <span class="detail-value positive" id="detailMaxWinStreak">
            0
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="max-loss-streak">
            Max Loss Streak
           </span>
           <span class="detail-value negative" id="detailMaxLossStreak">
            0
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="current-win-streak">
            Current Win Streak
           </span>
           <span class="detail-value" id="detailCurrentWinStreak">
            0
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="current-loss-streak">
            Current Loss Streak
           </span>
           <span class="detail-value" id="detailCurrentLossStreak">
            0
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="avg-win-streak">
            Avg Win Streak
           </span>
           <span class="detail-value" id="detailAvgWinStreak">
            0.00
           </span>
          </div>
         </div>
        </div>
        <!-- Symbol Performance -->
        <div class="detail-card">
         <div class="detail-card-header" data-lang="symbol-performance" onclick="toggleDetailCard(this)">
          Symbol Performance
          <span class="collapse-icon">
           ‚ñº
          </span>
         </div>
         <div class="detail-card-content">
          <div class="detail-item">
           <span class="detail-label" data-lang="most-profitable-symbol">
            Most Profitable
           </span>
           <span class="detail-value" id="detailMostProfitableSymbol">
            -
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="least-profitable-symbol">
            Least Profitable
           </span>
           <span class="detail-value" id="detailLeastProfitableSymbol">
            -
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="most-traded-symbol">
            Most Traded
           </span>
           <span class="detail-value" id="detailMostTradedSymbol">
            -
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="unique-symbols">
            Unique Symbols
           </span>
           <span class="detail-value neutral" id="detailUniqueSymbols">
            0
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="symbol-win-rate">
            Best Symbol Win Rate
           </span>
           <span class="detail-value" id="detailBestSymbolWinRate">
            0%
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="symbol-avg-return">
            Best Symbol Avg Return
           </span>
           <span class="detail-value" id="detailBestSymbolReturn">
            0%
           </span>
          </div>
         </div>
        </div>
        <!-- Risk Management -->
        <div class="detail-card">
         <div class="detail-card-header" data-lang="risk-management" onclick="toggleDetailCard(this)">
          Risk Management
          <span class="collapse-icon">
           ‚ñº
          </span>
         </div>
         <div class="detail-card-content">
          <div class="detail-item">
           <span class="detail-label" data-lang="max-drawdown">
            Max Drawdown
           </span>
           <span class="detail-value negative" id="detailMaxDrawdown">
            $0.00
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="current-drawdown">
            Current Drawdown
           </span>
           <span class="detail-value" id="detailCurrentDrawdown">
            $0.00
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="recovery-factor">
            Recovery Factor
           </span>
           <span class="detail-value" id="detailRecoveryFactor">
            0.00
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="max-daily-loss">
            Max Daily Loss
           </span>
           <span class="detail-value negative" id="detailMaxDailyLoss">
            $0.00
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="max-daily-gain">
            Max Daily Gain
           </span>
           <span class="detail-value positive" id="detailMaxDailyGain">
            $0.00
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="risk-reward-ratio">
            Avg Risk/Reward
           </span>
           <span class="detail-value" id="detailRiskRewardRatio">
            0.00
           </span>
          </div>
         </div>
        </div>
       </div>
       <!-- Basic Charts Section in Detail -->
       <div class="basic-charts-section">
        <div class="basic-charts-title" data-lang="basic-charts">
         Basic Performance Charts
        </div>
        <div class="basic-charts-grid">
         <div class="basic-chart-card">
          <div class="basic-chart-header" data-lang="cumulative-pl">
           Cumulative P&amp;L
          </div>
          <div class="basic-chart-content">
           <canvas class="chart-canvas" id="basicCumulativePLChart">
           </canvas>
          </div>
         </div>
         <div class="basic-chart-card">
          <div class="basic-chart-header" data-lang="win-loss-ratio">
           Win/Loss Distribution
          </div>
          <div class="basic-chart-content">
           <canvas class="chart-canvas" id="basicWinLossChart">
           </canvas>
          </div>
         </div>
         <div class="basic-chart-card">
          <div class="basic-chart-header" data-lang="daily-pl">
           Daily P&amp;L
          </div>
          <div class="basic-chart-content">
           <canvas class="chart-canvas" id="basicDailyPLChart">
           </canvas>
          </div>
         </div>
         <div class="basic-chart-card">
          <div class="basic-chart-header" data-lang="monthly-performance">
           Monthly Performance
          </div>
          <div class="basic-chart-content">
           <canvas class="chart-canvas" id="basicMonthlyChart">
           </canvas>
          </div>
         </div>
        </div>
       </div>
      </div>
      <!-- Advanced Charts Section -->
      <div class="chart-section" id="chartSection">
       <div class="advanced-charts-grid">
        <div class="chart-container">
         <div class="chart-header" data-lang="equity-curve">
          Equity Curve
         </div>
         <div class="chart-content">
          <canvas class="chart-canvas" id="equityCurveChart">
          </canvas>
         </div>
        </div>
        <div class="chart-container">
         <div class="chart-header" data-lang="drawdown-chart">
          Drawdown Analysis
         </div>
         <div class="chart-content">
          <canvas class="chart-canvas" id="drawdownChart">
          </canvas>
         </div>
        </div>
        <div class="chart-container">
         <div class="chart-header" data-lang="symbol-performance-chart">
          Symbol Performance
         </div>
         <div class="chart-content">
          <canvas class="chart-canvas" id="symbolPerformanceChart">
          </canvas>
         </div>
        </div>
        <div class="chart-container">
         <div class="chart-header" data-lang="time-distribution">
          Time Distribution
         </div>
         <div class="chart-content">
          <canvas class="chart-canvas" id="timeDistributionChart">
          </canvas>
         </div>
        </div>
        <div class="chart-container">
         <div class="chart-header" data-lang="return-distribution">
          Return Distribution
         </div>
         <div class="chart-content">
          <canvas class="chart-canvas" id="returnDistributionChart">
          </canvas>
         </div>
        </div>
        <div class="chart-container">
         <div class="chart-header" data-lang="volume-analysis">
          Volume Analysis
         </div>
         <div class="chart-content">
          <canvas class="chart-canvas" id="volumeAnalysisChart">
          </canvas>
         </div>
        </div>
        <div class="chart-container">
         <div class="chart-header" data-lang="correlation-matrix">
          Performance Correlation
         </div>
         <div class="chart-content">
          <canvas class="chart-canvas" id="correlationMatrixChart">
          </canvas>
         </div>
        </div>
        <div class="chart-container">
         <div class="chart-header" data-lang="performance-attribution">
          Performance Attribution
         </div>
         <div class="chart-content">
          <canvas class="chart-canvas" id="performanceAttributionChart">
          </canvas>
         </div>
        </div>
        <div class="chart-container">
         <div class="chart-header" data-lang="trade-duration-analysis">
          Trade Duration Analysis
         </div>
         <div class="chart-content">
          <canvas class="chart-canvas" id="tradeDurationAnalysisChart">
          </canvas>
         </div>
        </div>
        <div class="chart-container">
         <div class="chart-header" data-lang="win-rate-by-time">
          Win Rate by Time
         </div>
         <div class="chart-content">
          <canvas class="chart-canvas" id="winRateByTimeChart">
          </canvas>
         </div>
        </div>
        <div class="chart-container">
         <div class="chart-header" data-lang="position-sizing-analysis">
          Position Sizing Analysis
         </div>
         <div class="chart-content">
          <canvas class="chart-canvas" id="positionSizingAnalysisChart">
          </canvas>
         </div>
        </div>
        <div class="chart-container">
         <div class="chart-header" data-lang="trading-efficiency-metrics">
          Trading Efficiency Metrics
         </div>
         <div class="chart-content">
          <canvas class="chart-canvas" id="tradingEfficiencyMetricsChart">
          </canvas>
         </div>
        </div>
       </div>
      </div>
     </div>
    </div>
    <!-- Psychology page -->
    <div class="page" id="psychology">
     <div class="page-header">
      <div>
       <h1 class="page-title" data-lang="psychology-title">
        Trading Psychology Analytics
       </h1>
       <p class="page-subtitle" data-lang="psychology-subtitle">
        Quantified psychological performance analysis
       </p>
      </div>
      <div class="psychology-controls">
       <div class="psychology-tabs">
        <button class="psychology-tab active" data-lang="daily-input" onclick="showPsychologySection('input')">
         Daily Input
        </button>
        <button class="psychology-tab" data-lang="metrics-dashboard" onclick="showPsychologySection('metrics')">
         Metrics Dashboard
        </button>
        <button class="psychology-tab" data-lang="bias-analysis" onclick="showPsychologySection('bias-analysis')">
         Bias Analysis
        </button>
        <button class="psychology-tab" data-lang="pattern-insights" onclick="showPsychologySection('patterns')">
         Pattern Insights
        </button>
       </div>
      </div>
     </div>
     <!-- Daily Input Section -->
     <div class="psychology-section active" id="psychologyInputSection">
      <div class="psychology-container">
       <h2 class="psychology-header" data-lang="daily-data-input">
        Daily Data Input
       </h2>
       <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 24px; margin-bottom: 24px;">
        <!-- Biological Data -->
        <div style="background: #0f172a; border: 1px solid #334155; border-radius: 8px; padding: 20px;">
         <h3 data-lang="biological-data" style="color: #f8fafc; font-size: 16px; margin-bottom: 16px;">
          Biological Data
         </h3>
         <div style="margin-bottom: 16px;">
          <label data-lang="sleep-hours" style="display: block; color: #94a3b8; font-size: 12px; margin-bottom: 4px;">
           Sleep Hours
          </label>
          <input id="sleepHours" max="12" min="0" placeholder="7.5" step="0.5" style="width: 100%; background: #1e293b; border: 1px solid #334155; color: #e4e4e7; padding: 8px 10px; border-radius: 6px;" type="number"/>
         </div>
        </div>
        <!-- Trading Environment -->
        <div style="background: #0f172a; border: 1px solid #334155; border-radius: 8px; padding: 20px;">
         <h3 data-lang="trading-environment" style="color: #f8fafc; font-size: 16px; margin-bottom: 16px;">
          Trading Environment
         </h3>
         <div style="margin-bottom: 16px;">
          <label data-lang="start-time" style="display: block; color: #94a3b8; font-size: 12px; margin-bottom: 4px;">
           Start Time
          </label>
          <input id="startTime" style="width: 100%; background: #1e293b; border: 1px solid #334155; color: #e4e4e7; padding: 8px 10px; border-radius: 6px;" type="time"/>
         </div>
         <div style="margin-bottom: 16px;">
          <label data-lang="end-time" style="display: block; color: #94a3b8; font-size: 12px; margin-bottom: 4px;">
           End Time
          </label>
          <input id="endTime" style="width: 100%; background: #1e293b; border: 1px solid #334155; color: #e4e4e7; padding: 8px 10px; border-radius: 6px;" type="time"/>
         </div>
         <div>
          <label data-lang="environment-type" style="display: block; color: #94a3b8; font-size: 12px; margin-bottom: 4px;">
           Environment Type
          </label>
          <select id="environmentType" style="width: 100%; background: #1e293b; border: 1px solid #334155; color: #e4e4e7; padding: 8px 10px; border-radius: 6px;">
           <option value="home">
            Home
           </option>
           <option value="cafe">
            Cafe
           </option>
           <option value="office">
            Office
           </option>
           <option value="hotel">
            Hotel
           </option>
          </select>
         </div>
        </div>
        <!-- Economic Pressure -->
        <div style="background: #0f172a; border: 1px solid #334155; border-radius: 8px; padding: 20px;">
         <h3 data-lang="economic-pressure" style="color: #f8fafc; font-size: 16px; margin-bottom: 16px;">
          Economic Pressure
         </h3>
         <div style="margin-bottom: 16px;">
          <label data-lang="account-balance" style="display: block; color: #94a3b8; font-size: 12px; margin-bottom: 4px;">
           Account Balance ($)
          </label>
          <input id="accountBalance" min="0" oninput="updateTargetPercentages()" placeholder="10000" style="width: 100%; background: #1e293b; border: 1px solid #334155; color: #e4e4e7; padding: 8px 10px; border-radius: 6px;" type="number"/>
         </div>
         <div style="margin-bottom: 16px;">
          <label data-lang="daily-target" style="display: block; color: #94a3b8; font-size: 12px; margin-bottom: 4px;">
           Daily P&amp;L Target ($)
          </label>
          <div style="display: flex; gap: 8px; align-items: center;">
           <input id="dailyTarget" oninput="updateTargetPercentages()" placeholder="200" style="flex: 1; background: #1e293b; border: 1px solid #334155; color: #e4e4e7; padding: 8px 10px; border-radius: 6px;" type="number"/>
           <span id="dailyTargetPercent" style="color: #64748b; font-size: 12px; min-width: 40px;">
            0%
           </span>
          </div>
         </div>
         <div>
          <label data-lang="max-daily-loss" style="display: block; color: #94a3b8; font-size: 12px; margin-bottom: 4px;">
           Max Daily Loss ($)
          </label>
          <div style="display: flex; gap: 8px; align-items: center;">
           <input id="maxDailyLoss" oninput="updateTargetPercentages()" placeholder="500" style="flex: 1; background: #1e293b; border: 1px solid #334155; color: #e4e4e7; padding: 8px 10px; border-radius: 6px;" type="number"/>
           <span id="maxLossPercent" style="color: #64748b; font-size: 12px; min-width: 40px;">
            0%
           </span>
          </div>
         </div>
        </div>
        <!-- Emotional State -->
        <div style="background: #0f172a; border: 1px solid #334155; border-radius: 8px; padding: 20px;">
         <h3 data-lang="emotional-state" style="color: #f8fafc; font-size: 16px; margin-bottom: 16px;">
          Emotional State
         </h3>
         <div style="margin-bottom: 16px;">
          <label data-lang="stress-level" style="display: block; color: #94a3b8; font-size: 12px; margin-bottom: 4px;">
           Stress Level (1-5)
          </label>
          <input id="stressLevel" max="5" min="1" oninput="updateSliderDisplay('stressLevel', 'stressValue')" style="width: 100%; accent-color: #3b82f6;" type="range" value="3"/>
          <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 4px;">
           <span style="color: #64748b; font-size: 11px;">
            Low
           </span>
           <span id="stressValue" style="color: #e4e4e7; font-size: 12px; font-weight: 600;">
            3
           </span>
           <span style="color: #64748b; font-size: 11px;">
            High
           </span>
          </div>
         </div>
         <div style="margin-bottom: 16px;">
          <label data-lang="confidence-level" style="display: block; color: #94a3b8; font-size: 12px; margin-bottom: 4px;">
           Confidence Level (1-5)
          </label>
          <input id="confidenceLevel" max="5" min="1" oninput="updateSliderDisplay('confidenceLevel', 'confidenceValue')" style="width: 100%; accent-color: #3b82f6;" type="range" value="3"/>
          <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 4px;">
           <span style="color: #64748b; font-size: 11px;">
            Low
           </span>
           <span id="confidenceValue" style="color: #e4e4e7; font-size: 12px; font-weight: 600;">
            3
           </span>
           <span style="color: #64748b; font-size: 11px;">
            High
           </span>
          </div>
         </div>
         <div>
          <label data-lang="focus-level" style="display: block; color: #94a3b8; font-size: 12px; margin-bottom: 4px;">
           Focus Level (1-5)
          </label>
          <input id="focusLevel" max="5" min="1" oninput="updateSliderDisplay('focusLevel', 'focusValue')" style="width: 100%; accent-color: #3b82f6;" type="range" value="3"/>
          <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 4px;">
           <span style="color: #64748b; font-size: 11px;">
            Low
           </span>
           <span id="focusValue" style="color: #e4e4e7; font-size: 12px; font-weight: 600;">
            3
           </span>
           <span style="color: #64748b; font-size: 11px;">
            High
           </span>
          </div>
         </div>
        </div>
       </div>
       <!-- Action Buttons -->
       <div style="display: flex; gap: 12px; justify-content: center; margin-bottom: 24px;">
        <button class="psychology-save-btn" data-lang="save-psychology-data" onclick="savePsychologyData()">
         Save Psychology Data
        </button>
        <button class="psychology-save-btn" data-lang="calculate-score" onclick="calculateDailyScore()" style="background: #3b82f6;">
         Calculate Daily Score
        </button>
        <button class="psychology-save-btn" data-lang="reset-psychology-data" onclick="resetPsychologyData()" style="background: #ef4444;">
         Reset Data
        </button>
       </div>
       <!-- Enhanced Visual Dashboard -->
       <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 32px;">
        <!-- Sleep Performance Card -->
        <div style="background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border: 2px solid #334155; border-radius: 12px; padding: 20px; position: relative; overflow: hidden;">
         <div style="position: absolute; top: -50%; right: -50%; width: 100%; height: 100%; background: radial-gradient(circle, rgba(16, 185, 129, 0.1) 0%, transparent 70%); pointer-events: none;">
         </div>
         <div style="position: relative; z-index: 1;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
           <h3 data-lang="sleep-performance" style="color: #10b981; font-size: 16px; font-weight: 600;">
            Sleep Performance
           </h3>
           <div style="width: 40px; height: 40px; background: rgba(16, 185, 129, 0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
            <span style="font-size: 20px;">
             üõå
            </span>
           </div>
          </div>
          <div style="display: flex; align-items: baseline; gap: 8px; margin-bottom: 8px;">
           <span id="sleepHoursDisplay" style="font-size: 28px; font-weight: 700; color: #e4e4e7;">
            0
           </span>
           <span style="color: #94a3b8; font-size: 14px;">
            hours
           </span>
          </div>
          <div id="sleepQualityIndicator" style="height: 4px; background: #334155; border-radius: 2px; overflow: hidden;">
           <div id="sleepQualityBar" style="height: 100%; background: linear-gradient(90deg, #ef4444, #f59e0b, #10b981); width: 0%; transition: width 0.3s ease;">
           </div>
          </div>
          <div id="sleepStatus" style="color: #94a3b8; font-size: 12px; margin-top: 8px;">
           No data
          </div>
         </div>
        </div>
        <!-- Environment Card -->
        <div style="background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border: 2px solid #334155; border-radius: 12px; padding: 20px; position: relative; overflow: hidden;">
         <div style="position: absolute; top: -50%; right: -50%; width: 100%; height: 100%; background: radial-gradient(circle, rgba(59, 130, 246, 0.1) 0%, transparent 70%); pointer-events: none;">
         </div>
         <div style="position: relative; z-index: 1;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
           <h3 data-lang="environment-score" style="color: #3b82f6; font-size: 16px; font-weight: 600;">
            Environment Score
           </h3>
           <div style="width: 40px; height: 40px; background: rgba(59, 130, 246, 0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
            <span style="font-size: 20px;">
             üè¢
            </span>
           </div>
          </div>
          <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
           <div style="width: 60px; height: 60px; position: relative;">
            <svg style="width: 100%; height: 100%; transform: rotate(-90deg);">
             <circle cx="30" cy="30" fill="none" r="25" stroke="#334155" stroke-width="4">
             </circle>
             <circle cx="30" cy="30" fill="none" id="environmentCircle" r="25" stroke="#3b82f6" stroke-dasharray="157" stroke-dashoffset="157" stroke-width="4" style="transition: stroke-dashoffset 0.5s ease;">
             </circle>
            </svg>
            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
             <span id="environmentScore" style="font-size: 14px; font-weight: 700; color: #e4e4e7;">
              0
             </span>
            </div>
           </div>
           <div>
            <div id="environmentTypeDisplay" style="color: #e4e4e7; font-size: 14px; font-weight: 600;">
             -
            </div>
            <div id="environmentStatus" style="color: #94a3b8; font-size: 12px;">
             No data
            </div>
           </div>
          </div>
         </div>
        </div>
        <!-- Emotional State Card -->
        <div style="background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border: 2px solid #334155; border-radius: 12px; padding: 20px; position: relative; overflow: hidden;">
         <div style="position: absolute; top: -50%; right: -50%; width: 100%; height: 100%; background: radial-gradient(circle, rgba(139, 92, 246, 0.1) 0%, transparent 70%); pointer-events: none;">
         </div>
         <div style="position: relative; z-index: 1;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
           <h3 data-lang="emotional-readiness" style="color: #8b5cf6; font-size: 16px; font-weight: 600;">
            Emotional Readiness
           </h3>
           <div style="width: 40px; height: 40px; background: rgba(139, 92, 246, 0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
            <span style="font-size: 20px;">
             üß†
            </span>
           </div>
          </div>
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 12px;">
           <div style="text-align: center;">
            <div id="stressDisplay" style="font-size: 18px; font-weight: 700; color: #e4e4e7;">
             3
            </div>
            <div style="color: #94a3b8; font-size: 10px;">
             Stress
            </div>
           </div>
           <div style="text-align: center;">
            <div id="confidenceDisplay" style="font-size: 18px; font-weight: 700; color: #e4e4e7;">
             3
            </div>
            <div style="color: #94a3b8; font-size: 10px;">
             Confidence
            </div>
           </div>
           <div style="text-align: center;">
            <div id="focusDisplay" style="font-size: 18px; font-weight: 700; color: #e4e4e7;">
             3
            </div>
            <div style="color: #94a3b8; font-size: 10px;">
             Focus
            </div>
           </div>
          </div>
          <div id="emotionalStatus" style="color: #94a3b8; font-size: 12px; text-align: center;">
           No data
          </div>
         </div>
        </div>
        <!-- Risk Assessment Card -->
        <div style="background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border: 2px solid #334155; border-radius: 12px; padding: 20px; position: relative; overflow: hidden;">
         <div style="position: absolute; top: -50%; right: -50%; width: 100%; height: 100%; background: radial-gradient(circle, rgba(245, 158, 11, 0.1) 0%, transparent 70%); pointer-events: none;">
         </div>
         <div style="position: relative; z-index: 1;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
           <h3 data-lang="risk-assessment" style="color: #f59e0b; font-size: 16px; font-weight: 600;">
            Risk Assessment
           </h3>
           <div style="width: 40px; height: 40px; background: rgba(245, 158, 11, 0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
            <span style="font-size: 20px;">
             ‚ö†Ô∏è
            </span>
           </div>
          </div>
          <div style="margin-bottom: 12px;">
           <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
            <span style="color: #94a3b8; font-size: 12px;">
             Target Risk
            </span>
            <span id="targetRiskPercent" style="color: #e4e4e7; font-size: 12px; font-weight: 600;">
             0%
            </span>
           </div>
           <div style="background: #334155; height: 6px; border-radius: 3px; overflow: hidden;">
            <div id="targetRiskBar" style="height: 100%; background: linear-gradient(90deg, #10b981, #f59e0b, #ef4444); width: 0%; transition: width 0.3s ease;">
            </div>
           </div>
          </div>
          <div style="margin-bottom: 8px;">
           <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
            <span style="color: #94a3b8; font-size: 12px;">
             Max Loss Risk
            </span>
            <span id="maxLossRiskPercent" style="color: #e4e4e7; font-size: 12px; font-weight: 600;">
             0%
            </span>
           </div>
           <div style="background: #334155; height: 6px; border-radius: 3px; overflow: hidden;">
            <div id="maxLossRiskBar" style="height: 100%; background: linear-gradient(90deg, #10b981, #f59e0b, #ef4444); width: 0%; transition: width 0.3s ease;">
            </div>
           </div>
          </div>
          <div id="riskStatus" style="color: #94a3b8; font-size: 12px; text-align: center;">
           No data
          </div>
         </div>
        </div>
       </div>
       <!-- Performance Chart Section -->
       <div style="background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 24px; margin-bottom: 24px;">
        <h3 data-lang="psychology-performance-chart" style="color: #f8fafc; font-size: 18px; font-weight: 600; margin-bottom: 20px; text-align: center;">
         Psychology vs Performance Analysis
        </h3>
        <div style="height: 300px; display: flex; align-items: center; justify-content: center;">
         <canvas id="psychologyPerformanceChart" style="max-width: 100%; max-height: 100%;">
         </canvas>
        </div>
       </div>
      </div>
     </div>
     <!-- Metrics Dashboard Section -->
     <div class="psychology-section" id="psychologyMetricsSection">
      <div class="psychology-container">
       <h2 class="psychology-header" data-lang="psychology-dashboard">
        Psychology Dashboard
       </h2>
       <!-- Daily Psychology Score -->
       <div style="background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 20px; margin-bottom: 24px;">
        <h3 data-lang="daily-psychology-score" style="color: #f8fafc; font-size: 18px; margin-bottom: 16px; text-align: center;">
         Daily Psychology Score
        </h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
         <div id="sleepFactorCard" style="background: #0f172a; border: 2px solid #334155; border-radius: 8px; padding: 16px; text-align: center;">
          <div data-lang="sleep-factor" style="color: #94a3b8; font-size: 12px; margin-bottom: 8px;">
           Sleep Factor
          </div>
          <div id="sleepFactorScore" style="color: #f8fafc; font-size: 24px; font-weight: 700; margin-bottom: 4px;">
           0/25
          </div>
          <div id="sleepFactorStatus" style="color: #64748b; font-size: 11px;">
           No data
          </div>
         </div>
         <div id="stressFactorCard" style="background: #0f172a; border: 2px solid #334155; border-radius: 8px; padding: 16px; text-align: center;">
          <div data-lang="stress-factor" style="color: #94a3b8; font-size: 12px; margin-bottom: 8px;">
           Stress Factor
          </div>
          <div id="stressFactorScore" style="color: #f8fafc; font-size: 24px; font-weight: 700; margin-bottom: 4px;">
           0/25
          </div>
          <div id="stressFactorStatus" style="color: #64748b; font-size: 11px;">
           No data
          </div>
         </div>
         <div id="disciplineFactorCard" style="background: #0f172a; border: 2px solid #334155; border-radius: 8px; padding: 16px; text-align: center;">
          <div data-lang="discipline-factor" style="color: #94a3b8; font-size: 12px; margin-bottom: 8px;">
           Discipline Factor
          </div>
          <div id="disciplineFactorScore" style="color: #f8fafc; font-size: 24px; font-weight: 700; margin-bottom: 4px;">
           0/25
          </div>
          <div id="disciplineFactorStatus" style="color: #64748b; font-size: 11px;">
           No data
          </div>
         </div>
         <div id="consistencyFactorCard" style="background: #0f172a; border: 2px solid #334155; border-radius: 8px; padding: 16px; text-align: center;">
          <div data-lang="consistency-factor" style="color: #94a3b8; font-size: 12px; margin-bottom: 8px;">
           Consistency Factor
          </div>
          <div id="consistencyFactorScore" style="color: #f8fafc; font-size: 24px; font-weight: 700; margin-bottom: 4px;">
           0/25
          </div>
          <div id="consistencyFactorStatus" style="color: #64748b; font-size: 11px;">
           No data
          </div>
         </div>
         <div id="totalScoreCard" style="background: #0f172a; border: 2px solid #3b82f6; border-radius: 8px; padding: 16px; text-align: center;">
          <div data-lang="total-score" style="color: #94a3b8; font-size: 12px; margin-bottom: 8px;">
           Total Score
          </div>
          <div id="totalPsychScore" style="color: #3b82f6; font-size: 28px; font-weight: 700; margin-bottom: 4px;">
           0/100
          </div>
          <div id="totalScoreStatus" style="color: #64748b; font-size: 11px;">
           No data
          </div>
         </div>
        </div>
       </div>
       <!-- Weekly Bias Risk Assessment -->
       <div style="background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 20px; margin-bottom: 24px;">
        <h3 data-lang="weekly-bias-risk" style="color: #f8fafc; font-size: 18px; margin-bottom: 16px; text-align: center;">
         Weekly Bias Risk Assessment
        </h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px;">
         <div id="overconfidenceRiskCard" style="background: #0f172a; border: 2px solid #334155; border-radius: 8px; padding: 16px; text-align: center;">
          <div data-lang="overconfidence-risk" style="color: #94a3b8; font-size: 12px; margin-bottom: 8px;">
           Overconfidence Risk
          </div>
          <div id="overconfidenceRisk" style="color: #f8fafc; font-size: 20px; font-weight: 700; margin-bottom: 4px;">
           Low
          </div>
          <div id="overconfidenceDetails" style="color: #64748b; font-size: 11px;">
           Calibration Error: 0.0%
          </div>
         </div>
         <div id="lossAversionRiskCard" style="background: #0f172a; border: 2px solid #334155; border-radius: 8px; padding: 16px; text-align: center;">
          <div data-lang="loss-aversion-risk" style="color: #94a3b8; font-size: 12px; margin-bottom: 8px;">
           Loss Aversion Risk
          </div>
          <div id="lossAversionRisk" style="color: #f8fafc; font-size: 20px; font-weight: 700; margin-bottom: 4px;">
           Low
          </div>
          <div id="lossAversionDetails" style="color: #64748b; font-size: 11px;">
           Disposition Ratio: 0.0
          </div>
         </div>
         <div id="anchoringRiskCard" style="background: #0f172a; border: 2px solid #334155; border-radius: 8px; padding: 16px; text-align: center;">
          <div data-lang="anchoring-risk" style="color: #94a3b8; font-size: 12px; margin-bottom: 8px;">
           Anchoring Risk
          </div>
          <div id="anchoringRisk" style="color: #f8fafc; font-size: 20px; font-weight: 700; margin-bottom: 4px;">
           Low
          </div>
          <div id="anchoringDetails" style="color: #64748b; font-size: 11px;">
           Entry Price Dependency: 0%
          </div>
         </div>
        </div>
       </div>
       <!-- Performance Correlation -->
       <div style="background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 20px;">
        <h3 data-lang="performance-correlation" style="color: #f8fafc; font-size: 18px; margin-bottom: 16px; text-align: center;">
         Performance Correlation Analysis
        </h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
         <div style="background: #0f172a; border: 1px solid #334155; border-radius: 8px; padding: 16px; text-align: center;">
          <div data-lang="sleep-performance" style="color: #94a3b8; font-size: 12px; margin-bottom: 8px;">
           Sleep vs Performance
          </div>
          <div id="sleepCorrelation" style="color: #f8fafc; font-size: 18px; font-weight: 700;">
           +0.00
          </div>
         </div>
         <div style="background: #0f172a; border: 1px solid #334155; border-radius: 8px; padding: 16px; text-align: center;">
          <div data-lang="caffeine-performance" style="color: #94a3b8; font-size: 12px; margin-bottom: 8px;">
           Caffeine vs Performance
          </div>
          <div id="caffeineCorrelation" style="color: #f8fafc; font-size: 18px; font-weight: 700;">
           +0.00
          </div>
         </div>
         <div style="background: #0f172a; border: 1px solid #334155; border-radius: 8px; padding: 16px; text-align: center;">
          <div data-lang="timing-performance" style="color: #94a3b8; font-size: 12px; margin-bottom: 8px;">
           Timing vs Performance
          </div>
          <div id="timingCorrelation" style="color: #f8fafc; font-size: 18px; font-weight: 700;">
           +0.00
          </div>
         </div>
         <div style="background: #0f172a; border: 1px solid #334155; border-radius: 8px; padding: 16px; text-align: center;">
          <div data-lang="confidence-performance" style="color: #94a3b8; font-size: 12px; margin-bottom: 8px;">
           Confidence vs Performance
          </div>
          <div id="confidenceCorrelation" style="color: #f8fafc; font-size: 18px; font-weight: 700;">
           +0.00
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <!-- Bias Analysis Section -->
     <div class="psychology-section" id="psychologyBiasSection">
      <div class="psychology-container">
       <h2 class="psychology-header" data-lang="bias-analysis-title">
        Quantified Bias Analysis
       </h2>
       <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 24px;">
        <!-- Overconfidence Bias -->
        <div style="background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 20px;">
         <h3 data-lang="overconfidence-bias" style="color: #f8fafc; font-size: 16px; margin-bottom: 16px;">
          Overconfidence Bias
         </h3>
         <div style="margin-bottom: 16px;">
          <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
           <span data-lang="calibration-error" style="color: #94a3b8; font-size: 13px;">
            Calibration Error
           </span>
           <span id="calibrationError" style="color: #e4e4e7; font-size: 13px; font-weight: 600;">
            0.0%
           </span>
          </div>
          <div style="background: #0f172a; height: 6px; border-radius: 3px; overflow: hidden;">
           <div id="calibrationErrorBar" style="height: 100%; background: #10b981; width: 0%; transition: width 0.3s ease;">
           </div>
          </div>
         </div>
         <div style="margin-bottom: 16px;">
          <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
           <span data-lang="overtrading-index" style="color: #94a3b8; font-size: 13px;">
            Overtrading Index
           </span>
           <span id="overtradingIndex" style="color: #e4e4e7; font-size: 13px; font-weight: 600;">
            0%
           </span>
          </div>
          <div style="background: #0f172a; height: 6px; border-radius: 3px; overflow: hidden;">
           <div id="overtradingBar" style="height: 100%; background: #f59e0b; width: 0%; transition: width 0.3s ease;">
           </div>
          </div>
         </div>
         <div>
          <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
           <span data-lang="position-deviation" style="color: #94a3b8; font-size: 13px;">
            Position Size Deviation
           </span>
           <span id="positionDeviation" style="color: #e4e4e7; font-size: 13px; font-weight: 600;">
            0.0
           </span>
          </div>
          <div style="background: #0f172a; height: 6px; border-radius: 3px; overflow: hidden;">
           <div id="positionDeviationBar" style="height: 100%; background: #3b82f6; width: 0%; transition: width 0.3s ease;">
           </div>
          </div>
         </div>
        </div>
        <!-- Loss Aversion -->
        <div style="background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 20px;">
         <h3 data-lang="loss-aversion-bias" style="color: #f8fafc; font-size: 16px; margin-bottom: 16px;">
          Loss Aversion Bias
         </h3>
         <div style="margin-bottom: 16px;">
          <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
           <span data-lang="disposition-ratio" style="color: #94a3b8; font-size: 13px;">
            Disposition Ratio
           </span>
           <span id="dispositionRatio" style="color: #e4e4e7; font-size: 13px; font-weight: 600;">
            1.0
           </span>
          </div>
          <div style="background: #0f172a; height: 6px; border-radius: 3px; overflow: hidden;">
           <div id="dispositionBar" style="height: 100%; background: #ef4444; width: 0%; transition: width 0.3s ease;">
           </div>
          </div>
         </div>
         <div style="margin-bottom: 16px;">
          <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
           <span data-lang="stop-loss-execution" style="color: #94a3b8; font-size: 13px;">
            Stop Loss Execution Rate
           </span>
           <span id="stopLossRate" style="color: #e4e4e7; font-size: 13px; font-weight: 600;">
            0%
           </span>
          </div>
          <div style="background: #0f172a; height: 6px; border-radius: 3px; overflow: hidden;">
           <div id="stopLossBar" style="height: 100%; background: #10b981; width: 0%; transition: width 0.3s ease;">
           </div>
          </div>
         </div>
         <div>
          <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
           <span data-lang="stop-loss-modification" style="color: #94a3b8; font-size: 13px;">
            Stop Loss Modification Rate
           </span>
           <span id="stopLossModRate" style="color: #e4e4e7; font-size: 13px; font-weight: 600;">
            0%
           </span>
          </div>
          <div style="background: #0f172a; height: 6px; border-radius: 3px; overflow: hidden;">
           <div id="stopLossModBar" style="height: 100%; background: #8b5cf6; width: 0%; transition: width 0.3s ease;">
           </div>
          </div>
         </div>
        </div>
        <!-- Anchoring Bias -->
        <div style="background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 20px;">
         <h3 data-lang="anchoring-bias" style="color: #f8fafc; font-size: 16px; margin-bottom: 16px;">
          Anchoring Bias
         </h3>
         <div style="margin-bottom: 16px;">
          <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
           <span data-lang="entry-price-dependency" style="color: #94a3b8; font-size: 13px;">
            Entry Price Dependency
           </span>
           <span id="entryPriceDep" style="color: #e4e4e7; font-size: 13px; font-weight: 600;">
            0%
           </span>
          </div>
          <div style="background: #0f172a; height: 6px; border-radius: 3px; overflow: hidden;">
           <div id="entryPriceBar" style="height: 100%; background: #06b6d4; width: 0%; transition: width 0.3s ease;">
           </div>
          </div>
         </div>
         <div style="margin-bottom: 16px;">
          <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
           <span data-lang="round-number-bias" style="color: #94a3b8; font-size: 13px;">
            Round Number Bias
           </span>
           <span id="roundNumberBias" style="color: #e4e4e7; font-size: 13px; font-weight: 600;">
            0%
           </span>
          </div>
          <div style="background: #0f172a; height: 6px; border-radius: 3px; overflow: hidden;">
           <div id="roundNumberBar" style="height: 100%; background: #f59e0b; width: 0%; transition: width 0.3s ease;">
           </div>
          </div>
         </div>
         <div>
          <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
           <span data-lang="recent-high-anchor" style="color: #94a3b8; font-size: 13px;">
            Recent High Anchor
           </span>
           <span id="recentHighAnchor" style="color: #e4e4e7; font-size: 13px; font-weight: 600;">
            0%
           </span>
          </div>
          <div style="background: #0f172a; height: 6px; border-radius: 3px; overflow: hidden;">
           <div id="recentHighBar" style="height: 100%; background: #ef4444; width: 0%; transition: width 0.3s ease;">
           </div>
          </div>
         </div>
        </div>
       </div>
       <!-- Weekly Risk Summary -->
       <div style="background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 20px; margin-top: 24px;">
        <h3 data-lang="weekly-risk-summary" style="color: #f8fafc; font-size: 16px; margin-bottom: 16px;">
         Weekly Risk Summary
        </h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
         <div style="background: #0f172a; border: 1px solid #334155; border-radius: 8px; padding: 16px; text-align: center;">
          <div data-lang="overall-bias-risk" style="color: #94a3b8; font-size: 12px; margin-bottom: 8px;">
           Overall Bias Risk
          </div>
          <div id="overallBiasRisk" style="color: #f8fafc; font-size: 20px; font-weight: 700; margin-bottom: 4px;">
           Low
          </div>
          <div id="overallBiasScore" style="color: #64748b; font-size: 11px;">
           Score: 0/100
          </div>
         </div>
         <div style="background: #0f172a; border: 1px solid #334155; border-radius: 8px; padding: 16px; text-align: center;">
          <div data-lang="risk-trend" style="color: #94a3b8; font-size: 12px; margin-bottom: 8px;">
           Risk Trend
          </div>
          <div id="riskTrend" style="color: #f8fafc; font-size: 20px; font-weight: 700; margin-bottom: 4px;">
           Stable
          </div>
          <div id="riskTrendDetails" style="color: #64748b; font-size: 11px;">
           Last 7 days
          </div>
         </div>
         <div style="background: #0f172a; border: 1px solid #334155; border-radius: 8px; padding: 16px; text-align: center;">
          <div data-lang="action-needed" style="color: #94a3b8; font-size: 12px; margin-bottom: 8px;">
           Action Needed
          </div>
          <div id="actionNeeded" style="color: #f8fafc; font-size: 20px; font-weight: 700; margin-bottom: 4px;">
           None
          </div>
          <div id="actionDetails" style="color: #64748b; font-size: 11px;">
           All metrics normal
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <!-- Pattern Insights Section -->
     <div class="psychology-section" id="psychologyPatternsSection">
      <div class="psychology-container">
       <h2 class="psychology-header" data-lang="pattern-insights-title">
        Pattern Insights &amp; Recommendations
       </h2>
       <!-- Time-Based Performance -->
       <div style="background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 20px; margin-bottom: 24px;">
        <h3 data-lang="time-based-performance" style="color: #f8fafc; font-size: 16px; margin-bottom: 16px;">
         Time-Based Performance Analysis
        </h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
         <div style="background: #0f172a; border: 1px solid #334155; border-radius: 8px; padding: 16px; text-align: center;">
          <div data-lang="best-trading-hour" style="color: #94a3b8; font-size: 12px; margin-bottom: 8px;">
           Best Trading Hour
          </div>
          <div id="bestTradingHour" style="color: #10b981; font-size: 18px; font-weight: 700; margin-bottom: 4px;">
           --:--
          </div>
          <div id="bestHourPerformance" style="color: #64748b; font-size: 11px;">
           Win Rate: --%
          </div>
         </div>
         <div style="background: #0f172a; border: 1px solid #334155; border-radius: 8px; padding: 16px; text-align: center;">
          <div data-lang="worst-trading-hour" style="color: #94a3b8; font-size: 12px; margin-bottom: 8px;">
           Worst Trading Hour
          </div>
          <div id="worstTradingHour" style="color: #ef4444; font-size: 18px; font-weight: 700; margin-bottom: 4px;">
           --:--
          </div>
          <div id="worstHourPerformance" style="color: #64748b; font-size: 11px;">
           Win Rate: --%
          </div>
         </div>
         <div style="background: #0f172a; border: 1px solid #334155; border-radius: 8px; padding: 16px; text-align: center;">
          <div data-lang="optimal-sleep-range" style="color: #94a3b8; font-size: 12px; margin-bottom: 8px;">
           Optimal Sleep Range
          </div>
          <div id="optimalSleepRange" style="color: #3b82f6; font-size: 18px; font-weight: 700; margin-bottom: 4px;">
           -.- hours
          </div>
          <div id="sleepRangePerformance" style="color: #64748b; font-size: 11px;">
           Avg P&amp;L: $--
          </div>
         </div>
         <div style="background: #0f172a; border: 1px solid #334155; border-radius: 8px; padding: 16px; text-align: center;">
          <div data-lang="delay-impact" style="color: #94a3b8; font-size: 12px; margin-bottom: 8px;">
           Start Delay Impact
          </div>
          <div id="delayImpact" style="color: #f59e0b; font-size: 18px; font-weight: 700; margin-bottom: 4px;">
           --min
          </div>
          <div id="delayPerformance" style="color: #64748b; font-size: 11px;">
           Performance drop: --%
          </div>
         </div>
        </div>
       </div>
       <!-- Consecutive Trades Pattern -->
       <div style="background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 20px; margin-bottom: 24px;">
        <h3 data-lang="consecutive-pattern" style="color: #f8fafc; font-size: 16px; margin-bottom: 16px;">
         Consecutive Trades Pattern
        </h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px;">
         <div style="background: #0f172a; border: 1px solid #334155; border-radius: 8px; padding: 16px;">
          <div data-lang="after-losses" style="color: #94a3b8; font-size: 14px; margin-bottom: 12px;">
           Performance After Losses
          </div>
          <div style="color: #e4e4e7; font-size: 13px; margin-bottom: 8px;">
           After 1 loss:
           <span id="after1Loss" style="font-weight: 600;">
            --%
           </span>
          </div>
          <div style="color: #e4e4e7; font-size: 13px; margin-bottom: 8px;">
           After 2 losses:
           <span id="after2Losses" style="font-weight: 600;">
            --%
           </span>
          </div>
          <div style="color: #e4e4e7; font-size: 13px;">
           After 3+ losses:
           <span id="after3Losses" style="font-weight: 600;">
            --%
           </span>
          </div>
         </div>
         <div style="background: #0f172a; border: 1px solid #334155; border-radius: 8px; padding: 16px;">
          <div data-lang="after-wins" style="color: #94a3b8; font-size: 14px; margin-bottom: 12px;">
           Performance After Wins
          </div>
          <div style="color: #e4e4e7; font-size: 13px; margin-bottom: 8px;">
           After 1 win:
           <span id="after1Win" style="font-weight: 600;">
            --%
           </span>
          </div>
          <div style="color: #e4e4e7; font-size: 13px; margin-bottom: 8px;">
           After 2 wins:
           <span id="after2Wins" style="font-weight: 600;">
            --%
           </span>
          </div>
          <div style="color: #e4e4e7; font-size: 13px;">
           After 3+ wins:
           <span id="after3Wins" style="font-weight: 600;">
            --%
           </span>
          </div>
         </div>
        </div>
       </div>
       <!-- AI-Generated Insights -->
       <div style="background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 20px;">
        <h3 data-lang="ai-insights" style="color: #f8fafc; font-size: 16px; margin-bottom: 16px;">
         AI-Generated Insights
        </h3>
        <div id="aiInsightsList" style="display: grid; gap: 12px;">
         <div style="background: #0f172a; border-left: 4px solid #3b82f6; padding: 12px 16px; border-radius: 0 6px 6px 0;">
          <div data-lang="no-insights" style="color: #e4e4e7; font-size: 14px; line-height: 1.5;">
           Collect more psychology data to generate personalized insights.
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
    </div>
    <!-- Notes page -->
    <div class="page" id="notes">
     <div class="page-header">
      <div>
       <h1 class="page-title" data-lang="notes-title">
        Trading Notes
       </h1>
       <p class="page-subtitle" data-lang="notes-subtitle">
        Document your trading insights and thoughts
       </p>
      </div>
      <div class="notes-controls">
       <button class="btn btn-primary" data-lang="new-note" onclick="showNoteEditor()">
        New Note
       </button>
      </div>
     </div>
     <div class="notes-container">
      <!-- Notes Tabs -->
      <div class="notes-tabs">
       <button class="notes-tab active" data-lang="all-notes" onclick="showNotesSection('all')">
        All
       </button>
       <button class="notes-tab" data-lang="daily-review" onclick="showNotesSection('daily')">
        Daily Review
       </button>
       <button class="notes-tab" data-lang="strategy" onclick="showNotesSection('strategy')">
        Strategy
       </button>
       <button class="notes-tab" data-lang="general" onclick="showNotesSection('general')">
        General
       </button>
      </div>
      <!-- Note Editor -->
      <div class="note-editor" id="noteEditor" style="display: none;">
       <div class="note-formatting-toolbar">
        <button class="formatting-btn" onclick="toggleBold()" title="Bold">
         B
        </button>
        <button class="formatting-btn" onclick="toggleItalic()" title="Italic">
         I
        </button>
        <button class="formatting-btn" onclick="toggleUnderline()" title="Underline">
         U
        </button>
        <select class="font-selector" id="fontSelector" onchange="changeFont()">
         <option value="'Source Code Pro', monospace">
          Source Code Pro
         </option>
         <option value="'JetBrains Mono', monospace">
          JetBrains Mono
         </option>
         <option value="'Inter', sans-serif">
          Inter
         </option>
         <option value="'Georgia', serif">
          Georgia
         </option>
        </select>
        <div class="color-picker">
         <div class="color-option" onmousedown="event.preventDefault(); changeTextColor('#e4e4e7');" style="background-color: #e4e4e7;">
         </div>
         <div class="color-option" onmousedown="event.preventDefault(); changeTextColor('#10b981');" style="background-color: #10b981;">
         </div>
         <div class="color-option" onmousedown="event.preventDefault(); changeTextColor('#ef4444');" style="background-color: #ef4444;">
         </div>
         <div class="color-option" onmousedown="event.preventDefault(); changeTextColor('#3b82f6');" style="background-color: #3b82f6;">
         </div>
         <div class="color-option" onmousedown="event.preventDefault(); changeTextColor('#f59e0b');" style="background-color: #f59e0b;">
         </div>
         <div class="color-option" onmousedown="event.preventDefault(); changeTextColor('#8b5cf6');" style="background-color: #8b5cf6;">
         </div>
        </div>
       </div>
       <input class="note-title-input" data-lang="note-title-placeholder" id="noteTitle" placeholder="Enter note title..." type="text"/>
       <div class="note-content-input" contenteditable="true" data-placeholder="Write your note here..." id="noteContentEditor">
       </div>
       <div class="note-actions">
        <button class="btn btn-secondary" data-lang="cancel" onclick="cancelNote()">
         Cancel
        </button>
        <button class="btn btn-primary" data-lang="save-note" onclick="saveNote()">
         Save Note
        </button>
       </div>
      </div>
      <!-- Note View Mode -->
      <div class="note-view-mode" id="noteViewMode" style="display: none;">
       <div class="note-view-title" id="noteViewTitle">
       </div>
       <div class="note-view-content" id="noteViewContent">
       </div>
       <div class="note-view-actions">
        <button class="btn btn-secondary" data-lang="back" onclick="backToNotesList()">
         Back
        </button>
        <button class="btn btn-primary" data-lang="edit" onclick="editCurrentNote()">
         Edit
        </button>
       </div>
      </div>
      <!-- Notes Sections -->
      <div class="note-section active" id="allNotesSection">
       <div class="notes-list" id="allNotesList">
        <div class="empty-state">
         <div class="empty-state-icon">
          üìù
         </div>
         <div data-lang="no-notes">
          No notes written yet. Click "New Note" to start.
         </div>
        </div>
       </div>
      </div>
      <div class="note-section" id="dailyNotesSection">
       <div class="notes-list" id="dailyNotesList">
        <div class="empty-state">
         <div class="empty-state-icon">
          üìù
         </div>
         <div data-lang="no-daily-notes">
          No daily review notes yet. Click "New Note" to start.
         </div>
        </div>
       </div>
      </div>
      <div class="note-section" id="strategyNotesSection">
       <div class="notes-list" id="strategyNotesList">
        <div class="empty-state">
         <div class="empty-state-icon">
          üìä
         </div>
         <div data-lang="no-strategy-notes">
          No strategy notes yet. Click "New Note" to start.
         </div>
        </div>
       </div>
      </div>
      <div class="note-section" id="generalNotesSection">
       <div class="notes-list" id="generalNotesList">
        <div class="empty-state">
         <div class="empty-state-icon">
          üìÑ
         </div>
         <div data-lang="no-general-notes">
          No general notes yet. Click "New Note" to start.
         </div>
        </div>
       </div>
      </div>
     </div>
    </div>
    <!-- Trade List page -->
    <div class="page" id="trades">
     <div class="page-header">
      <div>
       <h1 class="page-title" data-lang="tradelist-title">
        Trade List
       </h1>
       <p class="page-subtitle" data-lang="tradelist-subtitle">
        Complete list of all your trades
       </p>
      </div>
      <div class="date-range-selector">
       <input class="date-range-input" id="tradesStartDate" type="date"/>
       <span style="color: #64748b;">
        to
       </span>
       <input class="date-range-input" id="tradesEndDate" type="date"/>
       <button class="btn btn-secondary" onclick="clearTradesRange()" style="padding: 4px 8px; font-size: 12px;">
        Clear
       </button>
      </div>
     </div>
     <div class="trades-section">
      <div class="trades-header">
       <h2 data-lang="trade-history">
        Trade History
       </h2>
       <div style="display: flex; gap: 12px; align-items: center;">
        <button class="btn btn-secondary" data-lang="delete-selected" id="deleteSelectedListBtn" onclick="deleteSelectedTradesList()" style="display: none; background: #dc2626; border-color: #dc2626;">
         Delete Selected
        </button>
        <div class="period-summary" id="allTradesSummary">
        </div>
       </div>
      </div>
      <table class="trades-table">
       <thead>
        <tr>
         <th style="width: 40px;">
          <input id="selectAllTradesList" onchange="toggleAllTradesList()" style="accent-color: #3b82f6;" type="checkbox"/>
         </th>
         <th data-lang="date">
          Date
         </th>
         <th data-lang="symbol">
          Symbol
         </th>
         <th data-lang="buy-price">
          Buy Price
         </th>
         <th data-lang="sell-price">
          Sell Price
         </th>
         <th data-lang="shares">
          Shares
         </th>
         <th data-lang="amount">
          Amount
         </th>
         <th data-lang="time">
          Time
         </th>
         <th data-lang="pnl">
          P&amp;L
         </th>
         <th data-lang="return-pct">
          Return %
         </th>
         <th data-lang="actions">
          Actions
         </th>
        </tr>
       </thead>
       <tbody id="allTradesTableBody">
        <tr>
         <td colspan="10">
          <div class="empty-state">
           <div class="empty-state-icon">
            üìä
           </div>
           <div data-lang="no-trades">
            No trades recorded yet
           </div>
          </div>
         </td>
        </tr>
       </tbody>
      </table>
     </div>
    </div>
    <!-- Settings page -->
    <div class="page" id="settings">
     <div class="page-header">
      <div>
       <h1 class="page-title" data-lang="settings-title">
        Settings
       </h1>
       <p class="page-subtitle" data-lang="settings-subtitle">
        Configure your trading journal preferences
       </p>
      </div>
     </div>
     <div class="settings-section">
      <h3 data-lang="general-settings">
       General Settings
      </h3>
      <div class="settings-option">
       <label data-lang="default-language">
        Default Language
       </label>
       <select id="settingsLanguageSelect" onchange="changeLanguageFromSettings()">
        <option value="en">
         English
        </option>
        <option value="ko">
         ÌïúÍµ≠Ïñ¥
        </option>
       </select>
      </div>
     </div>
     <div class="settings-section">
      <h3 data-lang="data-management">
       Data Management
      </h3>
      <button class="settings-btn" data-lang="export-data" onclick="exportData()">
       Export Data
      </button>
      <button class="settings-btn" data-lang="import-data" onclick="importData()">
       Import Data
      </button>
      <input accept=".json" id="importFileInput" onchange="handleFileImport()" style="display: none;" type="file"/>
     </div>
     <div class="settings-section">
      <h3 data-lang="danger-zone">
       Danger Zone
      </h3>
      <button class="settings-btn danger" data-lang="clear-all-data" onclick="clearAllData()">
       
      </button>
     </div>
    </div>
   </main>
  </div>
  <!-- Chart.js ÎùºÏù¥Î∏åÎü¨Î¶¨ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  
  <!-- javaScript ÌååÏùºÎì§ -->
  <script src="js/config.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/trading.js"></script>
  <script>

        
        // Notes section functions
        function showNotesSection(section) {
            // ÎÖ∏Ìä∏ ÏûëÏÑ±/Ìé∏Ïßë Ï§ëÏù∏ÏßÄ ÌôïÏù∏
    const noteEditor = document.getElementById('noteEditor');
    const isEditing = noteEditor.style.display === 'block';
    
    if (isEditing) {
        const title = document.getElementById('noteTitle').value.trim();
        const content = document.getElementById('noteContentEditor').innerHTML.trim();
        
        if (title || content) {
            const confirmMessage = currentLanguage === 'ko' ? 
                'ÏûëÏÑ± Ï§ëÏù∏ ÎÖ∏Ìä∏Í∞Ä ÏûàÏäµÎãàÎã§. Ï†ÄÏû•ÌïòÏßÄ ÏïäÍ≥† Ïù¥ÎèôÌïòÏãúÍ≤†ÏäµÎãàÍπå?' : 
                'You have unsaved note content. Do you want to leave without saving?';
            
            if (!confirm(confirmMessage)) {
                return;
            }
        }
    }
            
            // Î™®Îì† ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî
            currentNotesSection = section;
            currentViewingNoteId = null;
            editingNoteId = null;
            
            // ÏóêÎîîÌÑ∞ÏôÄ Î∑∞Î™®Îìú Ïà®Í∏∞Í∏∞
            document.getElementById('noteEditor').style.display = 'none';
            document.getElementById('noteViewMode').style.display = 'none';
            
            // ÌÉ≠ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
            document.querySelectorAll('.notes-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Î™®Îì† ÏÑπÏÖò Ïà®Í∏∞Í∏∞
            document.querySelectorAll('.note-section').forEach(noteSection => {
                noteSection.classList.remove('active');
                noteSection.style.display = 'none';
            });
            
            // ÏÑ†ÌÉùÎêú ÏÑπÏÖòÎßå ÌëúÏãú
            const targetSection = document.getElementById(`${section}NotesSection`);
            if (targetSection) {
                targetSection.classList.add('active');
                targetSection.style.display = 'block';
            }
            
            // ÎÖ∏Ìä∏ Î™©Î°ù ÏÉàÎ°úÍ≥†Ïπ®
            setTimeout(() => {
                renderNotesList(section);
            }, 10);
        }

        // Note formatting functions
        function toggleBold() {
            document.execCommand('bold');
            document.querySelector('[onclick="toggleBold()"]').classList.toggle('active');
        }

        function toggleItalic() {
            document.execCommand('italic');
            document.querySelector('[onclick="toggleItalic()"]').classList.toggle('active');
        }

        function toggleUnderline() {
            document.execCommand('underline');
            document.querySelector('[onclick="toggleUnderline()"]').classList.toggle('active');
        }

        function changeFont() {
            const font = document.getElementById('fontSelector').value;
            currentFont = font;
            document.getElementById('noteContentEditor').style.fontFamily = font;
            document.execCommand('fontName', false, font);
        }

        function changeTextColor(color) {
            currentTextColor = color;
            document.querySelectorAll('.color-option').forEach(option => {
                option.classList.remove('active');
            });
            
            // ÏÉâÏÉÅ Îß§Ìïë Í∞ùÏ≤¥Î•º ÏÇ¨Ïö©Ìïú Ïò¨Î∞îÎ•∏ ÌôúÏÑ±Ìôî
            const colorMap = {
                '#e4e4e7': 'rgb(228, 228, 231)',
                '#10b981': 'rgb(16, 185, 129)',
                '#ef4444': 'rgb(239, 68, 68)',
                '#3b82f6': 'rgb(59, 130, 246)',
                '#f59e0b': 'rgb(245, 158, 11)',
                '#8b5cf6': 'rgb(139, 92, 246)'
            };
            
            document.querySelectorAll('.color-option').forEach(option => {
                if (colorMap[color] === option.style.backgroundColor) {
                    option.classList.add('active');
                }
            });

            const selection = window.getSelection();
            
            if (selection.rangeCount > 0 && selection.toString().trim().length > 0) {
                document.execCommand('styleWithCSS', false, true);
                document.execCommand('foreColor', false, color);
                return;
            }
            
            const editor = document.getElementById('noteContentEditor');
            editor.style.color = color;
        }

        // Analytics date range functions
        function clearAnalyticsRange() {
            analyticsStartDate = null;
            analyticsEndDate = null;
            document.getElementById('analyticsStartDate').value = '';
            document.getElementById('analyticsEndDate').value = '';
            updateDetailedAnalytics();
        }

        // Enhanced Notes functions with categories
        function showNoteEditor() {
    // Í∏∞Ï°¥ ÎÇ¥Ïö©Ïù¥ ÏûàÎäîÏßÄ ÌôïÏù∏
    const noteEditor = document.getElementById('noteEditor');
    const isCurrentlyEditing = noteEditor.style.display === 'block';
    
    if (isCurrentlyEditing) {
        const title = document.getElementById('noteTitle').value.trim();
        const content = document.getElementById('noteContentEditor').innerHTML.trim();
        
        if (title || content) {
            const confirmMessage = currentLanguage === 'ko' ? 
                'ÏûëÏÑ± Ï§ëÏù∏ ÎÖ∏Ìä∏Í∞Ä ÏûàÏäµÎãàÎã§. ÏÉà ÎÖ∏Ìä∏Î•º ÏãúÏûëÌïòÏãúÍ≤†ÏäµÎãàÍπå?' : 
                'You have unsaved content. Start a new note?';
            
            if (!confirm(confirmMessage)) {
                return;
            }
        }
    }

    editingNoteId = null;
    currentFont = "'Inter', sans-serif";
    currentTextColor = '#e4e4e7';
    
    document.getElementById('noteTitle').value = '';
    document.getElementById('noteContentEditor').innerHTML = '';
    document.getElementById('noteContentEditor').style.fontFamily = currentFont;
    document.getElementById('noteContentEditor').style.color = currentTextColor;
    document.getElementById('fontSelector').value = currentFont;
    
    // ÏÉâÏÉÅ ÏòµÏÖò Ï¥àÍ∏∞Ìôî
    document.querySelectorAll('.color-option').forEach(option => {
        option.classList.remove('active');
    });
    const defaultColorOption = document.querySelector('.color-option[style*="228, 228, 231"]');
    if (defaultColorOption) {
        defaultColorOption.classList.add('active');
    }
    
    document.getElementById('noteEditor').style.display = 'block';
    document.getElementById('noteViewMode').style.display = 'none';
    document.querySelectorAll('.note-section').forEach(section => {
        section.style.display = 'none';
    });
    document.getElementById('noteTitle').focus();
}
        
        function editNote(noteId) {
    const note = notes.find(n => n.id === noteId);
    if (note) {
        editingNoteId = noteId;
        currentTextColor = note.textColor || '#e4e4e7';
        currentFont = note.font || "'Inter', sans-serif";
        
        document.getElementById('noteTitle').value = note.title;
        document.getElementById('noteContentEditor').innerHTML = note.content;
        document.getElementById('noteContentEditor').style.fontFamily = currentFont;
        document.getElementById('noteContentEditor').style.color = currentTextColor;
        document.getElementById('fontSelector').value = currentFont;
        
        // ÏÉâÏÉÅ ÏòµÏÖò ÏóÖÎç∞Ïù¥Ìä∏
        document.querySelectorAll('.color-option').forEach(option => {
            option.classList.remove('active');
        });
        
        // ÌòÑÏû¨ ÏÉâÏÉÅÏóê ÎßûÎäî ÏòµÏÖò ÏÑ†ÌÉù
        const colorMap = {
            '#e4e4e7': 'rgb(228, 228, 231)',
            '#10b981': 'rgb(16, 185, 129)',
            '#ef4444': 'rgb(239, 68, 68)',
            '#3b82f6': 'rgb(59, 130, 246)',
            '#f59e0b': 'rgb(245, 158, 11)',
            '#8b5cf6': 'rgb(139, 92, 246)'
        };
        
        document.querySelectorAll('.color-option').forEach(option => {
            if (colorMap[currentTextColor] === option.style.backgroundColor) {
                option.classList.add('active');
            }
        });
        
        document.getElementById('noteEditor').style.display = 'block';
        document.getElementById('noteViewMode').style.display = 'none';
        document.querySelectorAll('.note-section').forEach(section => {
            section.style.display = 'none';
        });
        document.getElementById('noteTitle').focus();
    }
}

        function deleteNote(noteId) {
            if (confirm(currentLanguage === 'ko' ? 'Ïù¥ ÎÖ∏Ìä∏Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?' : 'Are you sure you want to delete this note?')) {
                notes = notes.filter(note => note.id !== noteId);
                saveNotes();
                renderAllNotesSections();
                showToast(currentLanguage === 'ko' ? 'ÎÖ∏Ìä∏Í∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§' : 'Note deleted');
            }
        }

        function saveNote() {
    const title = document.getElementById('noteTitle').value.trim();
    const content = document.getElementById('noteContentEditor').innerHTML.trim();
    
    if (!title || !content) {
        alert(currentLanguage === 'ko' ? 'Ï†úÎ™©Í≥º ÎÇ¥Ïö©ÏùÑ Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' : 'Please enter both title and content.');
        return;
    }

    const now = new Date();
    
    if (editingNoteId) {
        // Update existing note
        const noteIndex = notes.findIndex(n => n.id === editingNoteId);
        if (noteIndex !== -1) {
            notes[noteIndex] = {
                ...notes[noteIndex],
                title: title,
                content: content,
                font: currentFont,
                textColor: currentTextColor,
                updatedAt: now.toISOString()
            };
        }
    } else {
        // Create new note
        const actualCategory = currentNotesSection === 'all' ? 'general' : currentNotesSection;
        const newNote = {
            id: Date.now(),
            title: title,
            content: content,
            font: currentFont,
            textColor: currentTextColor,
            category: actualCategory,
            pinned: false,
            createdAt: now.toISOString(),
            updatedAt: now.toISOString()
        };
        notes.unshift(newNote);
    }

    saveNotes();
    cancelNote();
    renderAllNotesSections();
    showToast(editingNoteId ? 
        (currentLanguage === 'ko' ? 'ÎÖ∏Ìä∏Í∞Ä ÏóÖÎç∞Ïù¥Ìä∏ÎêòÏóàÏäµÎãàÎã§' : 'Note updated') :
        (currentLanguage === 'ko' ? 'ÎÖ∏Ìä∏Í∞Ä Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§' : 'Note saved')
    );
}

        function cancelNote() {
    editingNoteId = null;
    currentViewingNoteId = null;
    
    document.getElementById('noteEditor').style.display = 'none';
    document.getElementById('noteViewMode').style.display = 'none';
    
    // Î™®Îì† ÏÑπÏÖò Ïà®Í∏∞Í∏∞ ÌõÑ ÌòÑÏû¨ Ïπ¥ÌÖåÍ≥†Î¶¨Îßå ÌëúÏãú
    document.querySelectorAll('.note-section').forEach(section => {
        section.style.display = 'none';
        section.classList.remove('active');
    });
    
    const targetSection = document.getElementById(`${currentNotesSection}NotesSection`);
    if (targetSection) {
        targetSection.style.display = 'block';
        targetSection.classList.add('active');
    }
    
    // ÎÖ∏Ìä∏ Î™©Î°ù ÏÉàÎ°ú Î†åÎçîÎßÅ
    setTimeout(() => {
        renderNotesList(currentNotesSection);
    }, 10);
}

        function renderAllNotesSections() {
            renderNotesList('all');
            renderNotesList('daily');
            renderNotesList('strategy');
            renderNotesList('general');
        }

        function renderNotesList(category) {
    let categoryNotes;
    if (category === 'all') {
        categoryNotes = notes;
    } else {
        categoryNotes = notes.filter(note => note.category === category);
    }
    
    // Í≥†Ï†ïÎêú ÎÖ∏Ìä∏ÏôÄ ÏùºÎ∞ò ÎÖ∏Ìä∏ Î∂ÑÎ¶¨
    const pinnedNotes = categoryNotes.filter(note => note.pinned);
    const regularNotes = categoryNotes.filter(note => !note.pinned);
    
    // Í≥†Ï†ïÎêú ÎÖ∏Ìä∏Îäî ÏóÖÎç∞Ïù¥Ìä∏ ÏãúÍ∞ÑÏàú, ÏùºÎ∞ò ÎÖ∏Ìä∏Îäî ÏÉùÏÑ± ÏãúÍ∞ÑÏàú Ï†ïÎ†¨
    pinnedNotes.sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));
    regularNotes.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
    
    const sortedNotes = [...pinnedNotes, ...regularNotes];
    
    const notesList = document.getElementById(`${category}NotesList`);
    
    if (sortedNotes.length === 0) {
        const emptyMessages = {
            all: currentLanguage === 'ko' ? 'ÏïÑÏßÅ ÏûëÏÑ±Îêú ÎÖ∏Ìä∏Í∞Ä ÏóÜÏäµÎãàÎã§. "ÏÉà ÎÖ∏Ìä∏"Î•º ÌÅ¥Î¶≠ÌïòÏó¨ ÏãúÏûëÌïòÏÑ∏Ïöî.' : 'No notes written yet. Click "New Note" to start.',
            daily: currentLanguage === 'ko' ? 'ÏùºÏùº Î¶¨Î∑∞ ÎÖ∏Ìä∏Í∞Ä ÏïÑÏßÅ ÏóÜÏäµÎãàÎã§. "ÏÉà ÎÖ∏Ìä∏"Î•º ÌÅ¥Î¶≠ÌïòÏó¨ ÏãúÏûëÌïòÏÑ∏Ïöî.' : 'No daily review notes yet. Click "New Note" to start.',
            strategy: currentLanguage === 'ko' ? 'Ï†ÑÎûµ ÎÖ∏Ìä∏Í∞Ä ÏïÑÏßÅ ÏóÜÏäµÎãàÎã§. "ÏÉà ÎÖ∏Ìä∏"Î•º ÌÅ¥Î¶≠ÌïòÏó¨ ÏãúÏûëÌïòÏÑ∏Ïöî.' : 'No strategy notes yet. Click "New Note" to start.',
            general: currentLanguage === 'ko' ? 'ÏùºÎ∞ò ÎÖ∏Ìä∏Í∞Ä ÏïÑÏßÅ ÏóÜÏäµÎãàÎã§. "ÏÉà ÎÖ∏Ìä∏"Î•º ÌÅ¥Î¶≠ÌïòÏó¨ ÏãúÏûëÌïòÏÑ∏Ïöî.' : 'No general notes yet. Click "New Note" to start.'
        };
        
        notesList.innerHTML = `
            <div class="empty-state">
                <div class="empty-state-icon">üìù</div>
                <div>${emptyMessages[category]}</div>
            </div>
        `;
        return;
    }

    notesList.innerHTML = sortedNotes.map(note => {
        const createdDate = new Date(note.createdAt);
        const formattedDate = createdDate.toLocaleDateString(currentLanguage === 'ko' ? 'ko-KR' : 'en-US', {
            year: 'numeric',
            month: 'short',
            day: 'numeric'
        });
        
        const preview = note.content.replace(/<[^>]*>/g, '');
        const previewText = preview.length > 150 ? preview.substring(0, 150) + '...' : preview;

        const categoryLabels = {
            daily: currentLanguage === 'ko' ? 'ÏùºÏùº Î¶¨Î∑∞' : 'Daily Review',
            strategy: currentLanguage === 'ko' ? 'Ï†ÑÎûµ' : 'Strategy',
            general: currentLanguage === 'ko' ? 'ÏùºÎ∞ò' : 'General'
        };

        const pinnedClass = note.pinned ? 'note-item-pinned' : '';
        const pinnedIcon = note.pinned ? 'üìå ' : '';
        const uniqueId = `${note.id}_${category}`;

        return `
            <div class="note-item ${pinnedClass}" onclick="viewNote(${note.id})">
                <div class="note-item-header">
                    <div>
                        <h3 class="note-item-title">${pinnedIcon}${note.title}</h3>
                        ${category === 'all' ? `<div class="note-item-category">${categoryLabels[note.category]}</div>` : ''}
                    </div>
                    <div class="note-item-header-right">
                        <span class="note-item-date">${formattedDate}</span>
                        <button class="pin-btn" onclick="event.stopPropagation(); togglePinNote(${note.id})" title="${note.pinned ? (currentLanguage === 'ko' ? 'Í≥†Ï†ï Ìï¥Ï†ú' : 'Unpin') : (currentLanguage === 'ko' ? 'ÏÉÅÎã® Í≥†Ï†ï' : 'Pin to top')}">${note.pinned ? 'üìå' : 'üìå'}</button>
                    </div>
                </div>
                <div class="note-item-preview" id="preview-${uniqueId}" style="color: ${note.textColor || '#94a3b8'}; font-family: ${note.font || "'Inter', sans-serif"};">${previewText}</div>
                <button class="expand-btn" data-note-id="${note.id}" data-category="${category}" onclick="event.stopPropagation(); toggleNotePreview(this)">${currentLanguage === 'ko' ? 'ÎçîÎ≥¥Í∏∞' : 'Show more'}</button>
                <div class="note-item-actions">
                    <button class="action-btn" onclick="event.stopPropagation(); editNote(${note.id})" title="Edit note">‚úèÔ∏è</button>
                    <button class="action-btn" onclick="event.stopPropagation(); deleteNote(${note.id})" title="Delete note">üóëÔ∏è</button>
                </div>
            </div>
        `;
    }).join('');
}

        function toggleNotePreview(buttonElement) {
    const noteId = parseInt(buttonElement.getAttribute('data-note-id'));
    const category = buttonElement.getAttribute('data-category');
    const uniqueId = `${noteId}_${category}`;
    
    const previewElement = document.getElementById(`preview-${uniqueId}`);
    const note = notes.find(n => n.id === noteId);
    
    if (!previewElement || !note) return;
    
    if (previewElement.classList.contains('expanded')) {
        // Collapse
        const preview = note.content.replace(/<[^>]*>/g, '');
        previewElement.innerHTML = preview.substring(0, 150) + '...';
        previewElement.style.fontFamily = note.font || "'Inter', sans-serif";
        previewElement.style.color = note.textColor || '#94a3b8';
        previewElement.classList.remove('expanded');
        buttonElement.textContent = currentLanguage === 'ko' ? 'ÎçîÎ≥¥Í∏∞' : 'Show more';
    } else {
        // Expand
        previewElement.innerHTML = note.content;
        previewElement.style.fontFamily = note.font || "'Inter', sans-serif";
        previewElement.style.color = note.textColor || '#94a3b8';
        previewElement.classList.add('expanded');
        buttonElement.textContent = currentLanguage === 'ko' ? 'Ï†ëÍ∏∞' : 'Show less';
    }
}

        function viewNote(noteId) {
            const note = notes.find(n => n.id === noteId);
            if (!note) return;
            
            currentViewingNoteId = noteId;
            
            document.getElementById('noteViewTitle').textContent = note.title;
            document.getElementById('noteViewContent').innerHTML = note.content;
            
            // Ìè∞Ìä∏ÏôÄ ÏÉâÏÉÅ Ï†ÅÏö©
            const viewContent = document.getElementById('noteViewContent');
            viewContent.style.fontFamily = note.font || "'Inter', sans-serif";
            viewContent.style.color = note.textColor || '#e4e4e7';
            
            // Show view mode, hide other sections
            document.getElementById('noteViewMode').style.display = 'block';
            document.getElementById('noteEditor').style.display = 'none';
            document.querySelectorAll('.note-section').forEach(section => {
                section.style.display = 'none';
            });
        }

        function backToNotesList() {
            currentViewingNoteId = null;
            editingNoteId = null;
            
            document.getElementById('noteViewMode').style.display = 'none';
            document.getElementById('noteEditor').style.display = 'none';
            
            // Î™®Îì† ÏÑπÏÖò Ïà®Í∏∞Í∏∞
            document.querySelectorAll('.note-section').forEach(section => {
                section.style.display = 'none';
                section.classList.remove('active');
            });
            
            // ÌòÑÏû¨ Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÑπÏÖòÎßå ÌëúÏãú
            const targetSection = document.getElementById(`${currentNotesSection}NotesSection`);
            if (targetSection) {
                targetSection.style.display = 'block';
                targetSection.classList.add('active');
            }
        }
        
        function editCurrentNote() {
            if (currentViewingNoteId) {
                editNote(currentViewingNoteId);
            }
        }

        function togglePinNote(noteId) {
            const noteIndex = notes.findIndex(n => n.id === noteId);
            if (noteIndex !== -1) {
                notes[noteIndex].pinned = !notes[noteIndex].pinned;
                saveNotes();
                renderAllNotesSections();
                
                const message = notes[noteIndex].pinned ? 
                    (currentLanguage === 'ko' ? 'ÎÖ∏Ìä∏Í∞Ä ÏÉÅÎã®Ïóê Í≥†Ï†ïÎêòÏóàÏäµÎãàÎã§' : 'Note pinned to top') :
                    (currentLanguage === 'ko' ? 'ÎÖ∏Ìä∏ Í≥†Ï†ïÏù¥ Ìï¥Ï†úÎêòÏóàÏäµÎãàÎã§' : 'Note unpinned');
                
                showToast(message);
            }
        }
   
        // Analytics section management
        function showAnalyticsSection(sectionName) {
            currentAnalyticsSection = sectionName;
            
            // Update tab states
            document.querySelectorAll('.analytics-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            // event.target ÎåÄÏã† ÏßÅÏ†ë ÏöîÏÜå Ï∞æÍ∏∞
            document.querySelector(`[onclick="showAnalyticsSection('${sectionName}')"]`).classList.add('active');
            
            // Show/hide sections
            document.querySelectorAll('.detail-section, .chart-section').forEach(section => {
                section.classList.remove('active');
            });
            
            if (sectionName === 'detail') {
                document.getElementById('detailSection').classList.add('active');
                setTimeout(async () => await updateBasicCharts(), 100);
            } else if (sectionName === 'charts') {
                document.getElementById('chartSection').classList.add('active');
                setTimeout(async () => await updateAdvancedCharts(), 100);
            }
        }
        
        async function updateBasicCharts() {
            const filteredTrades = getFilteredTradesForAnalytics();

            if (filteredTrades.length === 0) {
                // Clear charts if no data
                ['basicCumulativePLChart', 'basicWinLossChart', 'basicDailyPLChart', 'basicMonthlyChart'].forEach(chartId => {
                    if (basicCharts[chartId]) {
                        basicCharts[chartId].destroy();
                        delete basicCharts[chartId];
                    }
                    // Show "No data" message
                    const canvas = document.getElementById(chartId);
                    if (canvas) {
                        const parent = canvas.parentElement;
                        parent.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 200px; color: #64748b;">No data available</div>';
                    }
                });
                return;
            }

            // Restore canvas elements if they were replaced with "No data" message
            ['basicCumulativePLChart', 'basicWinLossChart', 'basicDailyPLChart', 'basicMonthlyChart'].forEach(chartId => {
                const existing = document.getElementById(chartId);
                if (!existing || existing.tagName !== 'CANVAS') {
                    const parent = document.querySelector(`#${chartId}`);
                    if (parent && parent.parentElement) {
                        parent.parentElement.innerHTML = `<canvas id="${chartId}" class="chart-canvas"></canvas>`;
                    }
                }
            });

            // Cumulative P&L Chart
            // Î®ºÏ†Ä ÏùºÏùº P&LÏùÑ ÏßëÍ≥Ñ
            const dailyPL = {};
            filteredTrades.forEach(trade => {
                if (!dailyPL[trade.date]) {
                    dailyPL[trade.date] = 0;
                }
                dailyPL[trade.date] += trade.pnl;
            });

            // ÎÇ†ÏßúÏàúÏúºÎ°ú Ï†ïÎ†¨ÌïòÍ≥† ÎàÑÏ†Å Í≥ÑÏÇ∞
            const sortedDates = Object.keys(dailyPL).sort();
            const cumulativePL = [];
            let runningTotal = 0;
            
            sortedDates.forEach(date => {
                runningTotal += dailyPL[date];
                cumulativePL.push({
                    x: date,
                    y: runningTotal
                });
            });

            createBasicChart('basicCumulativePLChart', 'line', {
                labels: cumulativePL.map(p => new Date(p.x).toLocaleDateString()),
                datasets: [{
                    label: 'Cumulative P&L',
                    data: cumulativePL.map(p => p.y),
                    borderColor: '#10b981',
                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                    fill: true
                }]
            });

            // Win/Loss Distribution
            const wins = filteredTrades.filter(trade => trade.pnl > 0).length;
            const losses = filteredTrades.filter(trade => trade.pnl < 0).length;

            createBasicChart('basicWinLossChart', 'doughnut', {
                labels: ['Wins', 'Losses'],
                datasets: [{
                    data: [wins, losses],
                    backgroundColor: ['#10b981', '#ef4444']
                }]
            });

            // Daily P&L
            const dailyStats = {};
            filteredTrades.forEach(trade => {
                if (!dailyStats[trade.date]) {
                    dailyStats[trade.date] = 0;
                }
                dailyStats[trade.date] += trade.pnl;
            });

            const dailyData = Object.entries(dailyStats)
                .sort(([a], [b]) => a.localeCompare(b))
                .map(([date, pnl]) => ({
                    x: date,
                    y: pnl
                }));

            createBasicChart('basicDailyPLChart', 'bar', {
                datasets: [{
                    label: 'Daily P&L',
                    data: dailyData,
                    backgroundColor: dailyData.map(d => d.y >= 0 ? '#10b981' : '#ef4444')
                }]
            });

            // Monthly Performance
            const monthlyStats = {};
            filteredTrades.forEach(trade => {
                const month = trade.date.substring(0, 7);
                if (!monthlyStats[month]) {
                    monthlyStats[month] = 0;
                }
                monthlyStats[month] += trade.pnl;
            });

            const monthlyData = Object.entries(monthlyStats)
                .sort(([a], [b]) => a.localeCompare(b));

            createBasicChart('basicMonthlyChart', 'line', {
                labels: monthlyData.map(([month]) => month),
                datasets: [{
                    label: 'Monthly P&L',
                    data: monthlyData.map(([, pnl]) => pnl),
                    borderColor: '#3b82f6',
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    fill: true
                }]
            });
        }
        async function updateAdvancedCharts() {
    const filteredTrades = getFilteredTradesForAnalytics();

    if (filteredTrades.length === 0) {
        // Clear charts if no data
        Object.keys(advancedCharts).forEach(chartId => {
            if (advancedCharts[chartId]) {
                advancedCharts[chartId].destroy();
                delete advancedCharts[chartId];
            }
        });
        
        // Show "No data" messages
        const chartIds = [
            'equityCurveChart', 'drawdownChart', 'symbolPerformanceChart', 'timeDistributionChart',
            'returnDistributionChart', 'volumeAnalysisChart', 'correlationMatrixChart',
            'performanceAttributionChart', 'tradeDurationAnalysisChart',
            'winRateByTimeChart', 'positionSizingAnalysisChart', 'tradingEfficiencyMetricsChart'
        ];
        
        chartIds.forEach(chartId => {
            const canvas = document.getElementById(chartId);
            if (canvas) {
                const parent = canvas.parentElement;
                parent.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 300px; color: #64748b;">No data available</div>';
            }
        });
        return;
    }

    // Restore canvas elements
    const chartIds = [
            'equityCurveChart', 'drawdownChart', 'symbolPerformanceChart', 'timeDistributionChart',
            'returnDistributionChart', 'volumeAnalysisChart', 'correlationMatrixChart',
            'performanceAttributionChart', 'tradeDurationAnalysisChart',
            'winRateByTimeChart', 'positionSizingAnalysisChart', 'tradingEfficiencyMetricsChart'
        ];
    
    chartIds.forEach(chartId => {
        const existing = document.getElementById(chartId);
        if (!existing || existing.tagName !== 'CANVAS') {
            const parent = document.querySelector(`#${chartId}`);
            if (parent && parent.parentElement) {
                parent.parentElement.innerHTML = `<canvas id="${chartId}" class="chart-canvas"></canvas>`;
            }
        }
    });

    const sortedTrades = [...filteredTrades].sort((a, b) => new Date(a.date) - new Date(b.date));
    const uniqueSymbols = [...new Set(filteredTrades.map(trade => trade.symbol))];

    // 1. Equity Curve
            // ÏùºÏùº P&L ÏßëÍ≥Ñ
            const equityDailyPL = {};
            filteredTrades.forEach(trade => {
                if (!equityDailyPL[trade.date]) {
                    equityDailyPL[trade.date] = 0;
                }
                equityDailyPL[trade.date] += trade.pnl;
            });

            // ÎÇ†ÏßúÏàúÏúºÎ°ú Ï†ïÎ†¨ÌïòÍ≥† ÎàÑÏ†Å equity Í≥ÑÏÇ∞
            const equitySortedDates = Object.keys(equityDailyPL).sort();
            const equityData = [];
            let equity = 0;
            
            equitySortedDates.forEach(date => {
                equity += equityDailyPL[date];
                equityData.push({
                    x: date,
                    y: equity
                });
            });

            createAdvancedChart('equityCurveChart', 'line', {
                labels: equityData.map(p => new Date(p.x).toLocaleDateString()),
                datasets: [{
                    label: 'Equity',
                    data: equityData.map(p => p.y),
                    borderColor: '#10b981',
                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                    fill: true
                }]
            });

    // 2. Drawdown Chart
            // ÏùºÏùº P&L ÏßëÍ≥Ñ
            const drawdownDailyPL = {};
            filteredTrades.forEach(trade => {
                if (!drawdownDailyPL[trade.date]) {
                    drawdownDailyPL[trade.date] = 0;
                }
                drawdownDailyPL[trade.date] += trade.pnl;
            });

            // ÎÇ†ÏßúÏàúÏúºÎ°ú Ï†ïÎ†¨ÌïòÍ≥† drawdown Í≥ÑÏÇ∞
            const drawdownSortedDates = Object.keys(drawdownDailyPL).sort();
            const drawdownData = [];
            let peak = 0;
            let currentEquity = 0;

            drawdownSortedDates.forEach(date => {
                currentEquity += drawdownDailyPL[date];
                if (currentEquity > peak) {
                    peak = currentEquity;
                }
                const drawdown = peak > 0 ? ((peak - currentEquity) / Math.abs(peak)) * 100 : 0;
                drawdownData.push({
                    x: date,
                    y: -Math.abs(drawdown)
                });
            });

            createAdvancedChart('drawdownChart', 'line', {
                labels: drawdownData.map(p => new Date(p.x).toLocaleDateString()),
                datasets: [{
                    label: 'Drawdown %',
                    data: drawdownData.map(p => p.y),
                    borderColor: '#ef4444',
                    backgroundColor: 'rgba(239, 68, 68, 0.1)',
                    fill: true
                }]
            });

    // 3. Symbol Performance
    const symbolStats = {};
    filteredTrades.forEach(trade => {
        if (!symbolStats[trade.symbol]) {
            symbolStats[trade.symbol] = 0;
        }
        symbolStats[trade.symbol] += trade.pnl;
    });

    const symbolData = Object.entries(symbolStats)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 10);

    createAdvancedChart('symbolPerformanceChart', 'bar', {
        labels: symbolData.map(([symbol]) => symbol),
        datasets: [{
            label: 'P&L by Symbol',
            data: symbolData.map(([, pnl]) => pnl),
            backgroundColor: symbolData.map(([, pnl]) => pnl >= 0 ? '#10b981' : '#ef4444')
        }]
    });

    // 4. Time Distribution
    const hourStats = {};
    filteredTrades.forEach(trade => {
        if (trade.entryTime) {
            const hour = parseInt(trade.entryTime.split(':')[0]);
            if (!hourStats[hour]) {
                hourStats[hour] = { count: 0, totalPL: 0 };
            }
            hourStats[hour].count++;
            hourStats[hour].totalPL += trade.pnl;
        }
    });

    const hourData = Object.entries(hourStats)
        .sort(([a], [b]) => parseInt(a) - parseInt(b))
        .map(([hour, data]) => ({
            x: parseInt(hour),
            y: data.count
        }));

    createAdvancedChart('timeDistributionChart', 'bar', {
        datasets: [{
            label: 'Trades by Hour',
            data: hourData,
            backgroundColor: '#3b82f6'
        }]
    });

    // 5. Return Distribution
    const returnRanges = {
        '<-5%': 0, '-5% to -2%': 0, '-2% to 0%': 0,
        '0% to 2%': 0, '2% to 5%': 0, '>5%': 0
    };

    filteredTrades.forEach(trade => {
        const returnPct = trade.returnPct;
        if (returnPct < -5) returnRanges['<-5%']++;
        else if (returnPct < -2) returnRanges['-5% to -2%']++;
        else if (returnPct < 0) returnRanges['-2% to 0%']++;
        else if (returnPct < 2) returnRanges['0% to 2%']++;
        else if (returnPct < 5) returnRanges['2% to 5%']++;
        else returnRanges['>5%']++;
    });

    createAdvancedChart('returnDistributionChart', 'bar', {
        labels: Object.keys(returnRanges),
        datasets: [{
            label: 'Trade Count',
            data: Object.values(returnRanges),
            backgroundColor: '#8b5cf6'
        }]
    });

    // 7. Volume Analysis
    const volumeData = filteredTrades.map((trade, index) => ({
        x: index + 1,
        y: trade.amount
    }));

    createAdvancedChart('volumeAnalysisChart', 'scatter', {
        datasets: [{
            label: 'Position Size',
            data: volumeData,
            backgroundColor: '#06b6d4'
        }]
    });

    // 8. Performance Correlation (Volume vs P&L)
    const correlationData = [];
    filteredTrades.forEach((trade, index) => {
        correlationData.push({
            x: trade.amount,
            y: trade.pnl
        });
    });

    createAdvancedChart('correlationMatrixChart', 'scatter', {
        datasets: [{
            label: 'Volume vs P&L',
            data: correlationData,
            backgroundColor: 'rgba(16, 185, 129, 0.6)'
        }]
    });

    // 11. Performance Attribution
    const attributionData = [];
    uniqueSymbols.forEach(symbol => {
        const symbolTrades = filteredTrades.filter(trade => trade.symbol === symbol);
        const totalPL = symbolTrades.reduce((sum, trade) => sum + trade.pnl, 0);
        attributionData.push({
            symbol: symbol,
            pnl: totalPL
        });
    });

    const topContributors = attributionData.sort((a, b) => Math.abs(b.pnl) - Math.abs(a.pnl)).slice(0, 10);

    createAdvancedChart('performanceAttributionChart', 'bar', {
        labels: topContributors.map(item => item.symbol),
        datasets: [{
            label: 'Contribution to P&L',
            data: topContributors.map(item => item.pnl),
            backgroundColor: topContributors.map(item => item.pnl >= 0 ? '#10b981' : '#ef4444')
        }]
    });

    // 12. Trade Duration Analysis
    const durationStats = {};
    filteredTrades.forEach(trade => {
        if (trade.holdingTime) {
            const duration = parseInt(trade.holdingTime.replace('m', ''));
            let range;
            if (duration < 30) range = '0-30m';
            else if (duration < 60) range = '30-60m';
            else if (duration < 120) range = '1-2h';
            else if (duration < 240) range = '2-4h';
            else range = '4h+';
            
            if (!durationStats[range]) {
                durationStats[range] = { count: 0, totalPL: 0 };
            }
            durationStats[range].count++;
            durationStats[range].totalPL += trade.pnl;
        }
    });

    const durationData = Object.entries(durationStats).map(([range, data]) => ({
        label: range,
        avgPL: data.count > 0 ? data.totalPL / data.count : 0
    }));

    createAdvancedChart('tradeDurationAnalysisChart', 'bar', {
        labels: durationData.map(d => d.label),
        datasets: [{
            label: 'Avg P&L by Duration',
            data: durationData.map(d => d.avgPL),
            backgroundColor: '#06b6d4'
        }]
    });

    // 14. Win Rate by Time
            const timeWinRate = {};
            filteredTrades.forEach(trade => {
                if (trade.entryTime) {
                    const hour = parseInt(trade.entryTime.split(':')[0]);
                    if (!timeWinRate[hour]) {
                        timeWinRate[hour] = { wins: 0, total: 0 };
                    }
                    timeWinRate[hour].total++;
                    if (trade.pnl > 0) timeWinRate[hour].wins++;
                }
            });

            const winRateData = Object.entries(timeWinRate)
                .sort(([a], [b]) => parseInt(a) - parseInt(b));

            createAdvancedChart('winRateByTimeChart', 'line', {
                labels: winRateData.map(([hour]) => hour + ':00'),
                datasets: [{
                    label: 'Win Rate by Hour (%)',
                    data: winRateData.map(([, data]) => data.total > 0 ? (data.wins / data.total) * 100 : 0),
                    borderColor: '#10b981',
                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                    fill: true
                }]
            }, {
                scales: {
                    y: {
                        min: 0,
                        max: 100,
                        title: {
                            display: true,
                            text: 'Win Rate (%)',
                            color: '#94a3b8'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Hour of Day',
                            color: '#94a3b8'
                        }
                    }
                }
            });

    // 15. Position Sizing Analysis
    const positionSizes = filteredTrades.map(trade => trade.amount);
    const sizeRanges = {
        '0-1000': 0, '1000-2500': 0, '2500-5000': 0,
        '5000-10000': 0, '10000+': 0
    };

    positionSizes.forEach(size => {
        if (size < 1000) sizeRanges['0-1000']++;
        else if (size < 2500) sizeRanges['1000-2500']++;
        else if (size < 5000) sizeRanges['2500-5000']++;
        else if (size < 10000) sizeRanges['5000-10000']++;
        else sizeRanges['10000+']++;
    });

    createAdvancedChart('positionSizingAnalysisChart', 'doughnut', {
        labels: Object.keys(sizeRanges),
        datasets: [{
            data: Object.values(sizeRanges),
            backgroundColor: ['#3b82f6', '#8b5cf6', '#06b6d4', '#10b981', '#f59e0b']
        }]
    });

    // 16. Trading Efficiency Metrics
    const wins = filteredTrades.filter(trade => trade.pnl > 0);
    const losses = filteredTrades.filter(trade => trade.pnl < 0);
    
    const avgWin = wins.length > 0 ? wins.reduce((sum, trade) => sum + trade.pnl, 0) / wins.length : 0;
    const avgLoss = losses.length > 0 ? Math.abs(losses.reduce((sum, trade) => sum + trade.pnl, 0) / losses.length) : 0;
    const winRate = filteredTrades.length > 0 ? (wins.length / filteredTrades.length) * 100 : 0;
    const profitFactor = avgLoss > 0 ? (avgWin * wins.length) / (avgLoss * losses.length) : 0;

    const efficiencyData = [
        { label: 'Win Rate', value: winRate },
        { label: 'Profit Factor', value: Math.min(profitFactor * 10, 100) }, // Scale for radar
        { label: 'Avg Win/Loss', value: avgLoss > 0 ? Math.min((avgWin / avgLoss) * 10, 100) : 0 }
    ];

    createAdvancedChart('tradingEfficiencyMetricsChart', 'radar', {
        labels: efficiencyData.map(d => d.label),
        datasets: [{
            label: 'Efficiency Metrics',
            data: efficiencyData.map(d => d.value),
            borderColor: '#3b82f6',
            backgroundColor: 'rgba(59, 130, 246, 0.2)',
            fill: true
        }]
    }, {
        scales: {
            r: {
                beginAtZero: true,
                max: 100,
                ticks: { color: '#94a3b8' },
                grid: { color: '#334155' }
            }
        }
    });
}

        // Page initialization
        document.addEventListener('DOMContentLoaded', async function() {
    await waitForChart();
    const savedLanguage = localStorage.getItem('tradingPlatformLanguage');
    if (savedLanguage) {
        currentLanguage = savedLanguage;
        // document.getElementById('languageSelect').value = currentLanguage; // Ïù¥ Ï§Ñ ÏÇ≠Ï†ú
        document.getElementById('settingsLanguageSelect').value = currentLanguage;
    }
            
            // Load daily fees
            const savedFees = localStorage.getItem('tradingPlatformDailyFees');
            if (savedFees) {
                dailyFees = JSON.parse(savedFees);
            }
            
            currentTradingDate = getESTTradingDate(new Date());
            updateCurrentDateDisplay();
            updateLanguage();
            
            loadTrades();
            loadNotes();
            loadPsychologyData();
            updateStats();
            renderCalendar();
            renderAllNotesSections();
            updateAllTradesList();
            updateDetailedAnalytics();
            calculateHoldingTime();
            loadDailyFees();
            
            document.getElementById('tradeForm').addEventListener('submit', handleTradeSubmit);
            document.getElementById('editTradeForm').addEventListener('submit', handleEditTradeSubmit);
            document.getElementById('entryTime').addEventListener('change', calculateHoldingTime);
            document.getElementById('exitTime').addEventListener('change', calculateHoldingTime);
            
            // Dashboard date range listeners
            document.getElementById('dashboardStartDate').addEventListener('change', function() {
                dashboardStartDate = this.value;
                updateStats();
                updateTradesTable(getFilteredDashboardTrades(), 'tradesTableBody');
            });
            
            document.getElementById('dashboardEndDate').addEventListener('change', function() {
                dashboardEndDate = this.value;
                updateStats();
                updateTradesTable(getFilteredDashboardTrades(), 'tradesTableBody');
            });

            // Analytics date range listeners
            document.getElementById('analyticsStartDate').addEventListener('change', function() {
                analyticsStartDate = this.value;
                updateDetailedAnalytics();
            });
            
            document.getElementById('analyticsEndDate').addEventListener('change', function() {
                analyticsEndDate = this.value;
                updateDetailedAnalytics();
            });

            // Trades page date range listeners
            document.getElementById('tradesStartDate').addEventListener('change', function() {
                tradesStartDate = this.value;
                updateAllTradesList();
            });
            
            document.getElementById('tradesEndDate').addEventListener('change', function() {
                tradesEndDate = this.value;
                updateAllTradesList();
            });
            
            document.getElementById('datePickerModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeDatePicker();
                }
            });

            document.getElementById('editTradeModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeEditTradeModal();
                }
            });

            document.getElementById('monthDetailsModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeMonthDetails();
                }
            });

            document.getElementById('weekDetailsModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeWeekDetails();
                }
            });
        });


        // Continue with analytics and other functions...
        function setAnalyticsPeriod(period) {
            analyticsPeriod = period;
            document.querySelectorAll('.filter-controls .filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // event.target ÎåÄÏã† ÏßÅÏ†ë ÏöîÏÜå Ï∞æÍ∏∞
            document.querySelector(`[onclick="setAnalyticsPeriod('${period}')"]`).classList.add('active');
            updateDetailedAnalytics();
        }

        function getFilteredTradesForAnalytics() {
            let filteredTrades = trades;
            
            // Apply custom date range if set
            if (analyticsStartDate || analyticsEndDate) {
                filteredTrades = trades.filter(trade => {
                    const tradeDate = trade.date;
                    if (analyticsStartDate && tradeDate < analyticsStartDate) return false;
                    if (analyticsEndDate && tradeDate > analyticsEndDate) return false;
                    return true;
                });
            } else {
                // Apply period filter
                const now = new Date();
                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                
                switch (analyticsPeriod) {
                    case 'day':
                        const todayStr = formatTradingDate(today);
                        filteredTrades = trades.filter(trade => trade.date === todayStr);
                        break;
                    case 'week':
                        const weekAgo = new Date(today);
                        weekAgo.setDate(weekAgo.getDate() - 7);
                        const weekAgoStr = formatTradingDate(weekAgo);
                        filteredTrades = trades.filter(trade => trade.date >= weekAgoStr);
                        break;
                    case 'month':
                        const monthAgo = new Date(today);
                        monthAgo.setMonth(monthAgo.getMonth() - 1);
                        const monthAgoStr = formatTradingDate(monthAgo);
                        filteredTrades = trades.filter(trade => trade.date >= monthAgoStr);
                        break;
                    default:
                        filteredTrades = trades;
                }
            }
            
            return filteredTrades;
        }

        function updateDetailedAnalytics() {
            const filteredTrades = getFilteredTradesForAnalytics();
            
            if (filteredTrades.length === 0) {
                resetDetailedAnalyticsDisplay();
                return;
            }
            
            // Calculate basic metrics
            const totalPL = filteredTrades.reduce((sum, trade) => sum + trade.pnl, 0);
            const uniqueDatesForFees = [...new Set(filteredTrades.map(trade => trade.date))];
            const totalDailyFees = uniqueDatesForFees.reduce((sum, date) => sum + (dailyFees[date] || 0), 0);
            const netTotalPL = totalPL - totalDailyFees;
            const wins = filteredTrades.filter(trade => trade.pnl > 0);
            const losses = filteredTrades.filter(trade => trade.pnl < 0);
            const winRate = filteredTrades.length > 0 ? (wins.length / filteredTrades.length) * 100 : 0;
            
            const pnls = filteredTrades.map(trade => trade.pnl);
            const largestWin = Math.max(...pnls);
            const largestLoss = Math.min(...pnls);
            
            const totalWins = wins.reduce((sum, trade) => sum + trade.pnl, 0);
            const totalLosses = Math.abs(losses.reduce((sum, trade) => sum + trade.pnl, 0));
            const profitFactor = totalLosses > 0 ? totalWins / totalLosses : 0;
            
            // Update Summary Cards
            document.getElementById('summaryNetProfit').textContent = `$${netTotalPL.toFixed(2)}`;
            document.getElementById('summaryNetProfit').className = `summary-card-value ${netTotalPL >= 0 ? 'positive' : 'negative'}`;
            document.getElementById('summaryTotalTrades').textContent = filteredTrades.length;
            document.getElementById('summaryWinRate').textContent = `${winRate.toFixed(1)}%`;
            document.getElementById('summaryWinRate').className = `summary-card-value ${winRate >= 50 ? 'positive' : 'negative'}`;
            document.getElementById('summaryProfitFactor').textContent = profitFactor.toFixed(2);
            document.getElementById('summaryProfitFactor').className = `summary-card-value ${profitFactor >= 1 ? 'positive' : 'negative'}`;
            document.getElementById('summaryLargestWin').textContent = `$${largestWin.toFixed(2)}`;
            document.getElementById('summaryLargestWin').className = `summary-card-value positive`;
            document.getElementById('summaryLargestLoss').textContent = `$${largestLoss.toFixed(2)}`;
            document.getElementById('summaryLargestLoss').className = `summary-card-value negative`;

            // Update detail cards
            updateTradingPerformanceDetails(filteredTrades, totalPL, totalWins, totalLosses, totalDailyFees);
            updateWinLossStatistics(filteredTrades, wins, losses, winRate);
            updateDailyPerformanceDetails(filteredTrades, uniqueDatesForFees, totalDailyFees);
            updateTimeAnalysisDetails(filteredTrades);
            updateTradingActivityDetails(filteredTrades, uniqueDatesForFees);
            updateStreakAnalysisDetails(filteredTrades);
            updateSymbolPerformanceDetails(filteredTrades);
            updateRiskManagementDetails(filteredTrades);

            // Update basic charts if in detail section
            if (currentAnalyticsSection === 'detail') {
                setTimeout(async () => await updateBasicCharts(), 100);
            }
        }

        function updateTradingPerformanceDetails(filteredTrades, totalPL, totalWins, totalLosses, totalDailyFees) {
            const totalVolume = filteredTrades.reduce((sum, trade) => sum + trade.amount, 0);
            const netTotalPL = totalPL - totalDailyFees;
            const profitFactor = totalLosses > 0 ? totalWins / totalLosses : 0;

            document.getElementById('detailTotalPL').textContent = `$${netTotalPL.toFixed(2)}`;
            document.getElementById('detailTotalPL').className = `detail-value ${netTotalPL >= 0 ? 'positive' : 'negative'}`;
            document.getElementById('detailTotalGain').textContent = `$${totalWins.toFixed(2)}`;
            document.getElementById('detailTotalLoss').textContent = `$${totalLosses.toFixed(2)}`;
            document.getElementById('detailTotalFees').textContent = `$${totalDailyFees.toFixed(2)}`;
            document.getElementById('detailTotalVolume').textContent = `$${totalVolume.toFixed(2)}`;
            document.getElementById('detailProfitFactor').textContent = profitFactor.toFixed(2);
            document.getElementById('detailProfitFactor').className = `detail-value ${profitFactor >= 1 ? 'positive' : 'negative'}`;
        }

        function updateWinLossStatistics(filteredTrades, wins, losses, winRate) {
            const avgWinningTrade = wins.length > 0 ? wins.reduce((sum, trade) => sum + trade.pnl, 0) / wins.length : 0;
            const avgLosingTrade = losses.length > 0 ? losses.reduce((sum, trade) => sum + trade.pnl, 0) / losses.length : 0;
            const pnls = filteredTrades.map(trade => trade.pnl);
            const largestWin = filteredTrades.length > 0 ? Math.max(...pnls) : 0;
            const largestLoss = filteredTrades.length > 0 ? Math.min(...pnls) : 0;

            document.getElementById('detailWinningTrades').textContent = `${wins.length} (${winRate.toFixed(1)}%)`;
            document.getElementById('detailLosingTrades').textContent = `${losses.length} (${(100 - winRate).toFixed(1)}%)`;
            document.getElementById('detailAvgWinningTrade').textContent = `$${avgWinningTrade.toFixed(2)}`;
            document.getElementById('detailAvgLosingTrade').textContent = `$${avgLosingTrade.toFixed(2)}`;
            document.getElementById('detailLargestWin').textContent = `$${largestWin.toFixed(2)}`;
            document.getElementById('detailLargestLoss').textContent = `$${largestLoss.toFixed(2)}`;
        }

        function updateDailyPerformanceDetails(filteredTrades, uniqueDatesForFees, totalDailyFees) {
            // Calculate daily P/L
            const dailyStats = {};
            filteredTrades.forEach(trade => {
                if (!dailyStats[trade.date]) {
                    dailyStats[trade.date] = { tradePL: 0, winDays: 0, lossDays: 0 };
                }
                dailyStats[trade.date].tradePL += trade.pnl;
            });

            // Apply daily fees and determine win/loss days
            const dailyPLsWithFees = [];
            Object.keys(dailyStats).forEach(date => {
                const fee = dailyFees[date] || 0;
                const netDailyPL = dailyStats[date].tradePL - fee;
                dailyPLsWithFees.push(netDailyPL);
                
                if (netDailyPL > 0) dailyStats[date].winDays = 1;
                else if (netDailyPL < 0) dailyStats[date].lossDays = 1;
            });

            const winDays = Object.values(dailyStats).filter(data => data.winDays > 0).length;
            const lossDays = Object.values(dailyStats).filter(data => data.lossDays > 0).length;
            const bestTradingDay = dailyPLsWithFees.length > 0 ? Math.max(...dailyPLsWithFees) : 0;
            // Î™®Îì† ÎÇ†Ïù¥ ÏàòÏùµÏùº ÎïåÎäî ÏµúÏïÖÏùò ÎÇ†ÏùÑ 0ÏúºÎ°ú ÌëúÏãú
            const worstTradingDay = dailyPLsWithFees.length > 0 && dailyPLsWithFees.some(pnl => pnl < 0) ? Math.min(...dailyPLsWithFees) : 0;
            const avgDailyPL = dailyPLsWithFees.length > 0 ? dailyPLsWithFees.reduce((sum, pnl) => sum + pnl, 0) / dailyPLsWithFees.length : 0;
            const avgDailyFees = uniqueDatesForFees.length > 0 ? totalDailyFees / uniqueDatesForFees.length : 0;

            document.getElementById('detailDailyPerWin').textContent = winDays > 0 ? `$${(dailyPLsWithFees.filter(pnl => pnl > 0).reduce((sum, pnl) => sum + pnl, 0) / winDays).toFixed(2)}` : '$0.00';
            document.getElementById('detailDailyPerLoss').textContent = lossDays > 0 ? `$${(dailyPLsWithFees.filter(pnl => pnl < 0).reduce((sum, pnl) => sum + pnl, 0) / lossDays).toFixed(2)}` : '$0.00';
            document.getElementById('detailDailyPerFees').textContent = `$${avgDailyFees.toFixed(2)}`;
            document.getElementById('detailBestTradingDay').textContent = `$${bestTradingDay.toFixed(2)}`;
            document.getElementById('detailWorstTradingDay').textContent = `$${worstTradingDay.toFixed(2)}`;
            document.getElementById('detailAvgDailyPL').textContent = `$${avgDailyPL.toFixed(2)}`;
            document.getElementById('detailAvgDailyPL').className = `detail-value ${avgDailyPL >= 0 ? 'positive' : 'negative'}`;
        }
        
        function updateTimeAnalysisDetails(filteredTrades) {
            // Hold time analysis
            const holdTimes = filteredTrades
                .filter(trade => trade.holdingTime)
                .map(trade => parseInt(trade.holdingTime.replace('m', '')));
            
            const avgHoldTime = holdTimes.length > 0 ? 
                holdTimes.reduce((sum, time) => sum + time, 0) / holdTimes.length : 0;
            const shortestHold = holdTimes.length > 0 ? Math.min(...holdTimes) : 0;
            const longestHold = holdTimes.length > 0 ? Math.max(...holdTimes) : 0;

            // Hour analysis
            const hourStats = {};
            filteredTrades.forEach(trade => {
                if (trade.entryTime) {
                    const hour = parseInt(trade.entryTime.split(':')[0]);
                    if (!hourStats[hour]) {
                        hourStats[hour] = { count: 0, totalPL: 0 };
                    }
                    hourStats[hour].count++;
                    hourStats[hour].totalPL += trade.pnl;
                }
            });

            const bestHour = Object.entries(hourStats)
                .sort((a, b) => b[1].totalPL - a[1].totalPL)[0];
            const worstHour = Object.entries(hourStats)
                .sort((a, b) => a[1].totalPL - b[1].totalPL)[0];

            // Day of week analysis
            const dayStats = {};
            const daysOfWeek = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const daysOfWeekKo = ['ÏùºÏöîÏùº', 'ÏõîÏöîÏùº', 'ÌôîÏöîÏùº', 'ÏàòÏöîÏùº', 'Î™©ÏöîÏùº', 'Í∏àÏöîÏùº', 'ÌÜ†ÏöîÏùº'];

            filteredTrades.forEach(trade => {
                const day = new Date(trade.date).getDay();
                if (!dayStats[day]) {
                    dayStats[day] = { count: 0, totalPL: 0 };
                }
                dayStats[day].count++;
                dayStats[day].totalPL += trade.pnl;
            });

            const bestDayOfWeek = Object.entries(dayStats)
                .sort((a, b) => b[1].totalPL - a[1].totalPL)[0];

            document.getElementById('detailAvgHoldTime').textContent = `${avgHoldTime.toFixed(0)}m`;
            document.getElementById('detailShortestHold').textContent = `${shortestHold}m`;
            document.getElementById('detailLongestHold').textContent = `${longestHold}m`;
            document.getElementById('detailBestHour').textContent = bestHour ? 
                `${bestHour[0]}:00 ($${bestHour[1].totalPL.toFixed(2)})` : '-';
            document.getElementById('detailWorstHour').textContent = worstHour ? 
                `${worstHour[0]}:00 ($${worstHour[1].totalPL.toFixed(2)})` : '-';
            document.getElementById('detailBestDayOfWeek').textContent = bestDayOfWeek ? 
                (currentLanguage === 'ko' ? daysOfWeekKo[bestDayOfWeek[0]] : daysOfWeek[bestDayOfWeek[0]]) : '-';
        }

        function updateTradingActivityDetails(filteredTrades, uniqueDatesForFees) {
            const tradingDays = uniqueDatesForFees.length;
            const avgTradesPerDay = tradingDays > 0 ? filteredTrades.length / tradingDays : 0;
            
            // Calculate trades per day
            const tradesPerDay = {};
            filteredTrades.forEach(trade => {
                tradesPerDay[trade.date] = (tradesPerDay[trade.date] || 0) + 1;
            });
            const maxTradesDay = Object.keys(tradesPerDay).length > 0 ? Math.max(...Object.values(tradesPerDay)) : 0;

            const positions = filteredTrades.map(trade => trade.amount);
            const avgPositionSize = positions.length > 0 ? positions.reduce((sum, pos) => sum + pos, 0) / positions.length : 0;
            const largestPosition = positions.length > 0 ? Math.max(...positions) : 0;
            const smallestPosition = positions.length > 0 ? Math.min(...positions) : 0;

            document.getElementById('detailTradingDays').textContent = tradingDays;
            document.getElementById('detailAvgTradesPerDay').textContent = avgTradesPerDay.toFixed(2);
            document.getElementById('detailMaxTradesDay').textContent = maxTradesDay;
            document.getElementById('detailAvgPositionSize').textContent = `$${avgPositionSize.toFixed(0)}`;
            document.getElementById('detailLargestPosition').textContent = `$${largestPosition.toFixed(0)}`;
            document.getElementById('detailSmallestPosition').textContent = `$${smallestPosition.toFixed(0)}`;
        }

        function updateStreakAnalysisDetails(filteredTrades) {
            let currentStreak = 0;
            let maxWinStreak = 0;
            let maxLossStreak = 0;
            let currentWinStreak = 0;
            let currentLossStreak = 0;
            let winStreaks = [];
            let totalWinStreaks = 0;

            const sortedTrades = [...filteredTrades].sort((a, b) => new Date(a.date) - new Date(b.date));

            sortedTrades.forEach((trade, index) => {
                if (trade.pnl > 0) {
                    if (currentLossStreak > 0) {
                        currentLossStreak = 0;
                    }
                    currentWinStreak++;
                    maxWinStreak = Math.max(maxWinStreak, currentWinStreak);
                    if (index === sortedTrades.length - 1) {
                        currentStreak = currentWinStreak;
                    }
                } else if (trade.pnl < 0) {
                    if (currentWinStreak > 0) {
                        winStreaks.push(currentWinStreak);
                        totalWinStreaks++;
                        currentWinStreak = 0;
                    }
                    currentLossStreak++;
                    maxLossStreak = Math.max(maxLossStreak, currentLossStreak);
                    if (index === sortedTrades.length - 1) {
                        currentStreak = -currentLossStreak;
                    }
                }
            });

            if (currentWinStreak > 0) {
                winStreaks.push(currentWinStreak);
                totalWinStreaks++;
            }

            const avgWinStreak = totalWinStreaks > 0 ? winStreaks.reduce((sum, streak) => sum + streak, 0) / totalWinStreaks : 0;

            // Get current streaks
            const recentTrades = sortedTrades.slice(-10);
            let recentWinStreak = 0;
            let recentLossStreak = 0;
            
            for (let i = recentTrades.length - 1; i >= 0; i--) {
                if (recentTrades[i].pnl > 0) {
                    if (recentLossStreak === 0) recentWinStreak++;
                    else break;
                } else if (recentTrades[i].pnl < 0) {
                    if (recentWinStreak === 0) recentLossStreak++;
                    else break;
                } else break;
            }

            document.getElementById('detailCurrentStreak').textContent = currentStreak;
            document.getElementById('detailCurrentStreak').className = `detail-value ${currentStreak >= 0 ? 'positive' : 'negative'}`;
            document.getElementById('detailMaxWinStreak').textContent = maxWinStreak;
            document.getElementById('detailMaxLossStreak').textContent = maxLossStreak;
            document.getElementById('detailCurrentWinStreak').textContent = recentWinStreak;
            document.getElementById('detailCurrentWinStreak').className = `detail-value ${recentWinStreak > 0 ? 'positive' : 'neutral'}`;
            document.getElementById('detailCurrentLossStreak').textContent = recentLossStreak;
            document.getElementById('detailCurrentLossStreak').className = `detail-value ${recentLossStreak > 0 ? 'negative' : 'neutral'}`;
            document.getElementById('detailAvgWinStreak').textContent = avgWinStreak.toFixed(2);
        }

        function updateSymbolPerformanceDetails(filteredTrades) {
            const symbolStats = {};
            filteredTrades.forEach(trade => {
                if (!symbolStats[trade.symbol]) {
                    symbolStats[trade.symbol] = {
                        count: 0,
                        totalPL: 0,
                        wins: 0,
                        totalReturn: 0
                    };
                }
                symbolStats[trade.symbol].count++;
                symbolStats[trade.symbol].totalPL += trade.pnl;
                symbolStats[trade.symbol].totalReturn += trade.returnPct;
                if (trade.pnl > 0) symbolStats[trade.symbol].wins++;
            });

            const symbolEntries = Object.entries(symbolStats);
            if (symbolEntries.length > 0) {
                const mostProfitable = symbolEntries.sort((a, b) => b[1].totalPL - a[1].totalPL)[0];
                const leastProfitable = symbolEntries.sort((a, b) => a[1].totalPL - b[1].totalPL)[0];
                const mostTraded = symbolEntries.sort((a, b) => b[1].count - a[1].count)[0];
                const bestWinRate = symbolEntries.sort((a, b) => (b[1].wins / b[1].count) - (a[1].wins / a[1].count))[0];
                const bestAvgReturn = symbolEntries.sort((a, b) => (b[1].totalReturn / b[1].count) - (a[1].totalReturn / a[1].count))[0];

                document.getElementById('detailMostProfitableSymbol').textContent = 
                    `${mostProfitable[0]} ($${mostProfitable[1].totalPL.toFixed(2)})`;
                document.getElementById('detailLeastProfitableSymbol').textContent = 
                    `${leastProfitable[0]} ($${leastProfitable[1].totalPL.toFixed(2)})`;
                document.getElementById('detailMostTradedSymbol').textContent = 
                    `${mostTraded[0]} (${mostTraded[1].count} trades)`;
                document.getElementById('detailUniqueSymbols').textContent = symbolEntries.length;
                document.getElementById('detailBestSymbolWinRate').textContent = 
                    `${bestWinRate[0]} (${((bestWinRate[1].wins / bestWinRate[1].count) * 100).toFixed(1)}%)`;
                document.getElementById('detailBestSymbolReturn').textContent = 
                    `${bestAvgReturn[0]} (${(bestAvgReturn[1].totalReturn / bestAvgReturn[1].count).toFixed(2)}%)`;
            } else {
                ['detailMostProfitableSymbol', 'detailLeastProfitableSymbol', 'detailMostTradedSymbol', 
                 'detailBestSymbolWinRate', 'detailBestSymbolReturn'].forEach(id => {
                    document.getElementById(id).textContent = '-';
                });
                document.getElementById('detailUniqueSymbols').textContent = '0';
            }
        }

        function updateRiskManagementDetails(filteredTrades) {
            // Drawdown calculation
            const sortedTrades = [...filteredTrades].sort((a, b) => new Date(a.date) - new Date(b.date));
            let cumulativePL = 0;
            let peak = 0;
            let maxDrawdown = 0;
            let currentDrawdown = 0;

            sortedTrades.forEach((trade, index) => {
                cumulativePL += trade.pnl;
                if (cumulativePL > peak) {
                    peak = cumulativePL;
                }
                const drawdown = peak - cumulativePL;
                if (drawdown > maxDrawdown) {
                    maxDrawdown = drawdown;
                }
                if (index === sortedTrades.length - 1) {
                    currentDrawdown = drawdown;
                }
            });

            // Daily P/L analysis with fees
            const dailyStats = {};
            filteredTrades.forEach(trade => {
                if (!dailyStats[trade.date]) {
                    dailyStats[trade.date] = 0;
                }
                dailyStats[trade.date] += trade.pnl;
            });

            // Apply fees to daily stats
            Object.keys(dailyStats).forEach(date => {
                const fee = dailyFees[date] || 0;
                dailyStats[date] -= fee;
            });

            const dailyPLs = Object.values(dailyStats);
            const maxDailyGain = dailyPLs.length > 0 ? Math.max(...dailyPLs) : 0;
            // Î™®Îì† ÎÇ†Ïù¥ ÏàòÏùµÏùº ÎïåÎäî ÏµúÏïÖÏùò ÎÇ†ÏùÑ 0ÏúºÎ°ú ÌëúÏãú
            const maxDailyLoss = dailyPLs.length > 0 && dailyPLs.some(pnl => pnl < 0) ? Math.min(...dailyPLs) : 0;

            // Recovery factor
            const totalReturn = filteredTrades.reduce((sum, trade) => sum + trade.pnl, 0);
            const recoveryFactor = maxDrawdown > 0 ? totalReturn / maxDrawdown : 0;

            // Risk/Reward ratio (simplified)
            const wins = filteredTrades.filter(trade => trade.pnl > 0);
            const losses = filteredTrades.filter(trade => trade.pnl < 0);
            const avgWin = wins.length > 0 ? wins.reduce((sum, trade) => sum + trade.pnl, 0) / wins.length : 0;
            const avgLoss = losses.length > 0 ? Math.abs(losses.reduce((sum, trade) => sum + trade.pnl, 0) / losses.length) : 0;
            const riskRewardRatio = avgLoss > 0 ? avgWin / avgLoss : 0;

            document.getElementById('detailMaxDrawdown').textContent = `$${maxDrawdown.toFixed(2)}`;
            document.getElementById('detailCurrentDrawdown').textContent = `$${currentDrawdown.toFixed(2)}`;
            document.getElementById('detailCurrentDrawdown').className = `detail-value ${currentDrawdown === 0 ? 'positive' : 'negative'}`;
            document.getElementById('detailRecoveryFactor').textContent = recoveryFactor.toFixed(2);
            document.getElementById('detailRecoveryFactor').className = `detail-value ${recoveryFactor >= 1 ? 'positive' : 'negative'}`;
            document.getElementById('detailMaxDailyGain').textContent = `$${maxDailyGain.toFixed(2)}`;
            document.getElementById('detailMaxDailyLoss').textContent = `$${maxDailyLoss.toFixed(2)}`;
            document.getElementById('detailRiskRewardRatio').textContent = riskRewardRatio.toFixed(2);
            document.getElementById('detailRiskRewardRatio').className = `detail-value ${riskRewardRatio >= 1 ? 'positive' : 'negative'}`;
        }

        function resetDetailedAnalyticsDisplay() {
            // Reset summary cards
            document.getElementById('summaryNetProfit').textContent = '$0.00';
            document.getElementById('summaryNetProfit').className = 'summary-card-value';
            document.getElementById('summaryTotalTrades').textContent = '0';
            document.getElementById('summaryWinRate').textContent = '0%';
            document.getElementById('summaryWinRate').className = 'summary-card-value';
            document.getElementById('summaryProfitFactor').textContent = '0.00';
            document.getElementById('summaryProfitFactor').className = 'summary-card-value';
            document.getElementById('summaryLargestWin').textContent = '$0.00';
            document.getElementById('summaryLargestWin').className = 'summary-card-value';
            document.getElementById('summaryLargestLoss').textContent = '$0.00';
            document.getElementById('summaryLargestLoss').className = 'summary-card-value';

            // Reset all detail values
            const detailElements = [
                'detailTotalPL', 'detailTotalGain', 'detailTotalLoss', 'detailTotalFees', 'detailTotalVolume', 'detailProfitFactor',
                'detailWinningTrades', 'detailLosingTrades', 'detailAvgWinningTrade', 'detailAvgLosingTrade', 'detailLargestWin', 'detailLargestLoss',
                'detailDailyPerWin', 'detailDailyPerLoss', 'detailDailyPerFees', 'detailBestTradingDay', 'detailWorstTradingDay', 'detailAvgDailyPL',
                'detailAvgHoldTime', 'detailShortestHold', 'detailLongestHold', 'detailTradingDays', 'detailAvgTradesPerDay', 'detailMaxTradesDay',
                'detailAvgPositionSize', 'detailLargestPosition', 'detailSmallestPosition', 'detailCurrentStreak', 'detailMaxWinStreak', 'detailMaxLossStreak',
                'detailCurrentWinStreak', 'detailCurrentLossStreak', 'detailAvgWinStreak', 'detailUniqueSymbols', 'detailMaxDrawdown', 'detailCurrentDrawdown',
                'detailRecoveryFactor', 'detailMaxDailyGain', 'detailMaxDailyLoss', 'detailRiskRewardRatio'
            ];

            detailElements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    if (id.includes('Symbol') || id.includes('Hour') || id.includes('Day')) {
                        element.textContent = '-';
                    } else if (id.includes('Trades') && !id.includes('Total') && !id.includes('Avg') && !id.includes('Max')) {
                        element.textContent = '0 (0%)';
                    } else if (id.includes('Time')) {
                        element.textContent = '0m';
                    } else if (id.includes('$') || id.includes('PL') || id.includes('Gain') || id.includes('Loss') || 
                              id.includes('Fees') || id.includes('Volume') || id.includes('Position') || id.includes('Drawdown')) {
                        element.textContent = '$0.00';
                    } else {
                        element.textContent = '0';
                    }
                    element.className = 'detail-value';
                }
            });

            // Reset special text fields
            document.getElementById('detailBestHour').textContent = '-';
            document.getElementById('detailWorstHour').textContent = '-';
            document.getElementById('detailBestDayOfWeek').textContent = '-';
            document.getElementById('detailMostProfitableSymbol').textContent = '-';
            document.getElementById('detailLeastProfitableSymbol').textContent = '-';
            document.getElementById('detailMostTradedSymbol').textContent = '-';
            document.getElementById('detailBestSymbolWinRate').textContent = '-';
            document.getElementById('detailBestSymbolReturn').textContent = '-';
        }

        // Calendar related functions
        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            const year = calendarDate.getFullYear();
            const month = calendarDate.getMonth();
            
            const monthNames = currentLanguage === 'ko' ? 
                ['1Ïõî', '2Ïõî', '3Ïõî', '4Ïõî', '5Ïõî', '6Ïõî', '7Ïõî', '8Ïõî', '9Ïõî', '10Ïõî', '11Ïõî', '12Ïõî'] :
                ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            
            document.getElementById('calendarTitle').textContent = `${monthNames[month]} ${year}`;
            
            const firstDay = new Date(year, month, 1);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            const existingDays = grid.querySelectorAll('.calendar-day, .calendar-week-pnl');
            existingDays.forEach(day => day.remove());
            
            const showWeekPnl = window.innerWidth > 768;
            const header = document.getElementById('weekPnlHeader');
            
            if (showWeekPnl) {
                grid.classList.add('expanded');
                if (header) header.style.display = 'block';
            } else {
                grid.classList.remove('expanded');
                if (header) header.style.display = 'none';
            }
            
            updateCalendarStats();
            
            // Í∏∞Ï°¥ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï†úÍ±∞
            document.removeEventListener('mouseup', endRangeSelection);
            
            for (let week = 0; week < 6; week++) {
                let weekTrades = [];
                let weekPnl = 0;
                
                for (let day = 0; day < 7; day++) {
                    const currentDate = new Date(startDate);
                    currentDate.setDate(startDate.getDate() + (week * 7) + day);
                    
                    const dayElement = document.createElement('div');
                    dayElement.className = 'calendar-day';
                    
                    const estDate = getESTTradingDate(currentDate);
                    const dateString = formatTradingDate(estDate);
                    dayElement.dataset.date = dateString;
                    
                    const isCurrentMonth = currentDate.getMonth() === month;
                    const isToday = currentDate.toDateString() === new Date().toDateString();
                    
                    if (!isCurrentMonth) {
                        dayElement.classList.add('other-month');
                    }
                    
                    if (isToday) {
                        dayElement.classList.add('today');
                    }
                    
                    const dayNumber = document.createElement('div');
                    dayNumber.className = 'calendar-day-number';
                    dayNumber.textContent = estDate.getDate();
                    dayElement.appendChild(dayNumber);
                    
                    const dayTrades = trades.filter(trade => trade.date === dateString);
                    
                    if (dayTrades.length > 0) {
                        const tradePnL = dayTrades.reduce((sum, trade) => sum + trade.pnl, 0);
                        const dailyFee = dailyFees[dateString] || 0;
                        const totalPnL = tradePnL - dailyFee;
                        weekPnl += totalPnL;
                        weekTrades = weekTrades.concat(dayTrades);
                        
                        const pnlElement = document.createElement('div');
                        pnlElement.className = `calendar-day-pnl ${totalPnL > 0 ? 'positive' : totalPnL < 0 ? 'negative' : 'neutral'}`;
                        pnlElement.textContent = `$${totalPnL.toFixed(0)}`;
                        dayElement.appendChild(pnlElement);
                        
                        const tradesElement = document.createElement('div');
                        tradesElement.className = 'calendar-day-trades';
                        const tradeText = currentLanguage === 'ko' ? 'Í±∞Îûò' : 'trade';
                        tradesElement.textContent = `${dayTrades.length} ${tradeText}${dayTrades.length !== 1 && currentLanguage !== 'ko' ? 's' : ''}`;
                        dayElement.appendChild(tradesElement);
                    }
                    
                    dayElement.addEventListener('click', function(e) {
                        e.stopPropagation();
                        selectCalendarDay(dateString, dayTrades);
                    });
                    
                    dayElement.addEventListener('mousedown', function(e) {
                        e.preventDefault();
                        startRangeSelection(dateString);
                    });
                    
                    dayElement.addEventListener('mouseenter', function() {
                        if (isSelecting) {
                            updateRangeSelection(dateString);
                        }
                    });
                    
                    grid.appendChild(dayElement);
                }
                
                if (showWeekPnl) {
                    const weekPnlElement = document.createElement('div');
                    weekPnlElement.className = 'calendar-week-pnl';
                    
                    if (weekTrades.length > 0) {
                        weekPnlElement.onclick = () => showWeekDetails(week + 1, weekTrades, weekPnl);
                        
                        const weekPnlValue = document.createElement('div');
                        weekPnlValue.className = `week-pnl-value ${weekPnl > 0 ? 'positive' : weekPnl < 0 ? 'negative' : 'neutral'}`;
                        weekPnlValue.textContent = `$${weekPnl.toFixed(0)}`;
                        weekPnlElement.appendChild(weekPnlValue);
                        
                        const weekTradesCount = document.createElement('div');
                        weekTradesCount.className = 'week-trades-count';
                        const tradeText = currentLanguage === 'ko' ? 'Í±∞Îûò' : 'trades';
                        weekTradesCount.textContent = `${weekTrades.length} ${tradeText}`;
                        weekPnlElement.appendChild(weekTradesCount);
                    }
                    
                    grid.appendChild(weekPnlElement);
                }
            }
            
            // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑàÎ•º Ìïú Î≤àÎßå Îì±Î°ù
            document.addEventListener('mouseup', endRangeSelection);
            
            renderAnnualHeatmap();
        }

        function selectCalendarDay(dateString, dayTrades) {
            selectedCalendarDay = dateString;
            
            document.querySelectorAll('.calendar-day').forEach(day => {
                day.classList.remove('selected');
            });
            
            const selectedDay = document.querySelector(`[data-date="${dateString}"]`);
            if (selectedDay) {
                selectedDay.classList.add('selected');
            }
            
            showDayDetails(dateString, dayTrades);
        }

        function showDayDetails(dateString, dayTrades) {
            const dayDetails = document.getElementById('dayDetails');
            const dayDetailsTitle = document.getElementById('dayDetailsTitle');
            const dayTradesList = document.getElementById('dayTradesList');
            
            const date = new Date(dateString);
            const formattedDate = date.toLocaleDateString(currentLanguage === 'ko' ? 'ko-KR' : 'en-US', {
                month: 'short',
                day: 'numeric',
                year: 'numeric'
            });
            
            dayDetailsTitle.textContent = formattedDate;
            
            if (dayTrades.length === 0) {
                dayTradesList.innerHTML = `
                    <div class="empty-state">
                        <div style="color: #64748b; font-size: 12px;">
                            ${currentLanguage === 'ko' ? 'Ïù¥ ÎÇ† Í±∞ÎûòÍ∞Ä ÏóÜÏäµÎãàÎã§' : 'No trades on this day'}
                        </div>
                    </div>
                `;
            } else {
                // Ìã∞Ïª§Î≥ÑÎ°ú Í±∞ÎûòÎ•º ÏßëÍ≥Ñ
                const tickerStats = {};
                
                dayTrades.forEach(trade => {
                    const symbol = trade.symbol;
                    if (!tickerStats[symbol]) {
                        tickerStats[symbol] = {
                            totalShares: 0,
                            totalCost: 0,
                            totalPnL: 0,
                            tradeCount: 0
                        };
                    }
                    
                    const shares = trade.shares || (trade.amount && trade.buyPrice ? Math.round(trade.amount / trade.buyPrice) : 0);
                    tickerStats[symbol].totalShares += shares;
                    tickerStats[symbol].totalCost += shares * trade.buyPrice;
                    tickerStats[symbol].totalPnL += trade.pnl;
                    tickerStats[symbol].tradeCount++;
                });
                
                // Ìã∞Ïª§Î≥Ñ Ï†ïÎ≥¥Î•º P/L ÏàúÏúºÎ°ú Ï†ïÎ†¨
                const sortedTickers = Object.entries(tickerStats)
                    .sort((a, b) => b[1].totalPnL - a[1].totalPnL);
                
                dayTradesList.innerHTML = sortedTickers.map(([symbol, stats]) => {
                    const avgCostBasis = stats.totalCost / stats.totalShares;
                    return `
                        <div class="day-trade-item">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                <span class="trade-symbol">${symbol}</span>
                                <span class="trade-pnl ${stats.totalPnL >= 0 ? 'positive' : 'negative'}">$${stats.totalPnL.toFixed(2)}</span>
                            </div>
                            <div style="font-size: 11px; color: #64748b;">
                                ${currentLanguage === 'ko' ? 'Cost Basis' : 'Cost Basis'}: $${avgCostBasis.toFixed(2)} | ${stats.tradeCount} ${currentLanguage === 'ko' ? 'Í±∞Îûò' : 'trade'}${stats.tradeCount !== 1 && currentLanguage !== 'ko' ? 's' : ''}
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            dayDetails.style.display = 'block';
        }

        function startRangeSelection(dateString) {
            isSelecting = true;
            calendarStartDate = dateString;
            calendarEndDate = dateString;
            updateRangeVisual();
        }

        function updateRangeSelection(dateString) {
            if (isSelecting) {
                calendarEndDate = dateString;
                updateRangeVisual();
            }
        }

        function endRangeSelection() {
            if (isSelecting) {
                isSelecting = false;
                updateCalendarStats();
            }
        }

        function updateRangeVisual() {
            document.querySelectorAll('.calendar-day').forEach(day => {
                day.classList.remove('range-start', 'range-end', 'in-range');
            });
            
            if (calendarStartDate && calendarEndDate) {
                const start = new Date(calendarStartDate);
                const end = new Date(calendarEndDate);
                
                const actualStart = start <= end ? start : end;
                const actualEnd = start <= end ? end : start;
                
                document.querySelectorAll('.calendar-day').forEach(day => {
                    const dayDate = new Date(day.dataset.date);
                    
                    if (dayDate.getTime() === actualStart.getTime()) {
                        day.classList.add('range-start');
                    } else if (dayDate.getTime() === actualEnd.getTime()) {
                        day.classList.add('range-end');
                    } else if (dayDate > actualStart && dayDate < actualEnd) {
                        day.classList.add('in-range');
                    }
                });
            }
        }

        function changeMonth(direction) {
            calendarDate.setMonth(calendarDate.getMonth() + direction);
            renderCalendar();
        }

        function clearCalendarRange() {
            calendarStartDate = null;
            calendarEndDate = null;
            selectedCalendarDay = null;
            selectedWeekPnl = null;
            
            document.querySelectorAll('.calendar-day').forEach(day => {
                day.classList.remove('selected', 'range-start', 'range-end', 'in-range');
            });
            
            document.querySelectorAll('.calendar-week-pnl').forEach(weekEl => {
                weekEl.classList.remove('selected');
            });
            
            document.getElementById('dayDetails').style.display = 'none';
            updateCalendarStats();
        }

        function updateCalendarStats() {
            let filteredTrades = trades;
            let periodLabel = currentLanguage === 'ko' ? 'ÌòÑÏû¨ Ïõî' : 'Current Month';
            let showBestWorst = false;
            
            if (calendarStartDate && calendarEndDate) {
                const start = new Date(calendarStartDate);
                const end = new Date(calendarEndDate);
                const actualStart = start <= end ? start : end;
                const actualEnd = start <= end ? end : start;
                
                filteredTrades = trades.filter(trade => {
                    const tradeDate = new Date(trade.date);
                    return tradeDate >= actualStart && tradeDate <= actualEnd;
                });
                
                const startStr = actualStart.toLocaleDateString(currentLanguage === 'ko' ? 'ko-KR' : 'en-US', { month: 'short', day: 'numeric' });
                const endStr = actualEnd.toLocaleDateString(currentLanguage === 'ko' ? 'ko-KR' : 'en-US', { month: 'short', day: 'numeric' });
                periodLabel = `${startStr} - ${endStr}`;
                showBestWorst = true; // Î≤îÏúÑÏÑ†ÌÉùÏùº ÎïåÎßå ÏµúÍ≥†/ÏµúÏïÖÏùò ÎÇ† ÌëúÏãú
            } else {
                const year = calendarDate.getFullYear();
                const month = calendarDate.getMonth();
                const monthStr = `${year}-${String(month + 1).padStart(2, '0')}`;
                filteredTrades = trades.filter(trade => trade.date.startsWith(monthStr));
                
                const monthNames = currentLanguage === 'ko' ? 
                    ['1Ïõî', '2Ïõî', '3Ïõî', '4Ïõî', '5Ïõî', '6Ïõî', '7Ïõî', '8Ïõî', '9Ïõî', '10Ïõî', '11Ïõî', '12Ïõî'] :
                    ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
                periodLabel = `${monthNames[month]} ${year}`;
            }
            
            const totalTrades = filteredTrades.length;
            const tradePL = filteredTrades.reduce((sum, trade) => sum + trade.pnl, 0);
            
            const uniqueDatesInPeriod = [...new Set(filteredTrades.map(trade => trade.date))];
            const totalFeesInPeriod = uniqueDatesInPeriod.reduce((sum, date) => sum + (dailyFees[date] || 0), 0);
            const totalPL = tradePL - totalFeesInPeriod;
            
            const dailyStats = {};
            filteredTrades.forEach(trade => {
                if (!dailyStats[trade.date]) {
                    dailyStats[trade.date] = 0;
                }
                dailyStats[trade.date] += trade.pnl;
            });
            
            Object.keys(dailyStats).forEach(date => {
                dailyStats[date] -= (dailyFees[date] || 0);
            });
            
            const dailyPLs = Object.values(dailyStats);
            const avgDaily = dailyPLs.length > 0 ? dailyPLs.reduce((sum, pnl) => sum + pnl, 0) / dailyPLs.length : 0;
            
            document.getElementById('calendarPeriodLabel').textContent = periodLabel;
            document.getElementById('calendarTotalTrades').textContent = totalTrades;
            
            document.getElementById('calendarTotalPL').textContent = `$${totalPL.toFixed(2)}`;
            document.getElementById('calendarTotalPL').className = `calendar-stat-value ${totalPL >= 0 ? 'positive' : 'negative'}`;
            
            document.getElementById('calendarAvgDaily').textContent = `$${avgDaily.toFixed(2)}`;
            document.getElementById('calendarAvgDaily').className = `calendar-stat-value ${avgDaily >= 0 ? 'positive' : 'negative'}`;
            
            if (showBestWorst && dailyPLs.length > 0) {
                const bestDay = Math.max(...dailyPLs);
                const worstDay = dailyPLs.some(pnl => pnl < 0) ? Math.min(...dailyPLs) : Math.min(...dailyPLs);
                
                document.getElementById('calendarBestDay').textContent = `$${bestDay.toFixed(2)}`;
                // Î™®Îì† ÎÇ†Ïù¥ ÏàòÏùµÏùº ÎïåÎäî ÏµúÏïÖÏùò ÎÇ†ÏùÑ ÌëúÏãúÌïòÏßÄ ÏïäÏùå
                if (dailyPLs.some(pnl => pnl < 0)) {
                    document.getElementById('calendarWorstDay').textContent = `$${worstDay.toFixed(2)}`;
                } else {
                    document.getElementById('calendarWorstDay').textContent = '$0.00';
                }
            } else {
                document.getElementById('calendarBestDay').textContent = '-';
                document.getElementById('calendarWorstDay').textContent = '-';
            }
        }
        

        
        function toggleCustomRisk() {
    document.querySelectorAll('.risk-preset-btn').forEach(btn => {
        btn.classList.remove('active');
        btn.style.background = '#374151';
        btn.style.borderColor = '#4b5563';
        btn.style.color = '#e4e4e7';
    });
    
    event.target.classList.add('active');
    event.target.style.background = '#3b82f6';
    event.target.style.borderColor = '#3b82f6';
    event.target.style.color = 'white';
    
    const customInput = document.getElementById('customRiskInput');
    customInput.style.display = 'flex';
    document.getElementById('customRiskValue').focus();
}

function applyCustomRisk() {
    const customValue = parseFloat(document.getElementById('customRiskValue').value);
    if (customValue && customValue > 0 && customValue <= 100) {
        document.getElementById('riskPercentage').value = customValue;
        calculateRiskPosition();
    }
}

        // Psychology functions
        function savePsychologyData() {
            const currentDate = formatTradingDate(currentTradingDate);
            
            // ÏïàÏ†ÑÌïú ÏöîÏÜå Ï†ëÍ∑ºÏùÑ ÏúÑÌïú Ìó¨Ìçº Ìï®Ïàò
            const getElementValue = (id, defaultValue = 0) => {
                const element = document.getElementById(id);
                return element ? (parseFloat(element.value) || defaultValue) : defaultValue;
            };
            
            const getElementStringValue = (id, defaultValue = '') => {
                const element = document.getElementById(id);
                return element ? (element.value || defaultValue) : defaultValue;
            };
            
            const data = {
                date: currentDate,
                timestamp: new Date().toISOString(),
                
                // Biological data
                sleepHours: getElementValue('sleepHours'),
                
                // Time & environment
                startTime: getElementStringValue('startTime', '09:30'),
                endTime: getElementStringValue('endTime'),
                environmentType: getElementStringValue('environmentType', 'home'),
                
                // Economic pressure
                accountBalance: getElementValue('accountBalance'),
                dailyTarget: getElementValue('dailyTarget'),
                maxDailyLoss: getElementValue('maxDailyLoss'),
                
                // Emotional state
                stressLevel: getElementValue('stressLevel', 3),
                confidenceLevel: getElementValue('confidenceLevel', 3),
                focusLevel: getElementValue('focusLevel', 3)
            };
            
            psychologyData[currentDate] = data;
            localStorage.setItem('tradingPlatformPsychologyData', JSON.stringify(psychologyData));
            
            updatePsychologyMetrics();
            generatePsychologyInsights();
            showToast(currentLanguage === 'ko' ? 'Ïã¨Î¶¨ Îç∞Ïù¥ÌÑ∞Í∞Ä Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§' : 'Psychology data saved');
        }
        
        function resetPsychologyData() {
            const confirmMessage = currentLanguage === 'ko' ? 
                'Ïã¨Î¶¨ Îç∞Ïù¥ÌÑ∞Î•º Ï¥àÍ∏∞ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå?' : 
                'Are you sure you want to reset psychology data?';
            
            if (confirm(confirmMessage)) {
                // Î™®Îì† ÏûÖÎ†• ÌïÑÎìú Ï¥àÍ∏∞Ìôî
                document.getElementById('sleepHours').value = '';
                document.getElementById('startTime').value = '09:30';
                document.getElementById('endTime').value = '';
                document.getElementById('environmentType').value = 'home-quiet';
                document.getElementById('accountBalance').value = '';
                document.getElementById('dailyTarget').value = '';
                document.getElementById('maxDailyLoss').value = '';
                document.getElementById('stressLevel').value = '3';
                document.getElementById('confidenceLevel').value = '3';
                document.getElementById('focusLevel').value = '3';
                
                showToast(currentLanguage === 'ko' ? 'Ïã¨Î¶¨ Îç∞Ïù¥ÌÑ∞Í∞Ä Ï¥àÍ∏∞ÌôîÎêòÏóàÏäµÎãàÎã§' : 'Psychology data has been reset');
            }
        }
        
        function updatePsychologyMetrics() {
            const currentDate = formatTradingDate(currentTradingDate);
            const todayData = psychologyData[currentDate];
            
            if (!todayData) {
                resetPsychologyMetrics();
                // generatePsychologyInsights Ìò∏Ï∂ú Ï†Ñ ÏöîÏÜå Ï°¥Ïû¨ ÌôïÏù∏
                if (document.getElementById('psychologyInsightsList')) {
                    generatePsychologyInsights();
                }
                return;
            }
            
            // Calculate Sleep Factor (0-25 points)
            const sleepFactor = calculateSleepFactor(todayData.sleepHours, todayData.stressLevel, todayData.focusLevel);
            updateMetricCard('sleepFactorCard', 'sleepFactor', 'sleepFactorStatus', sleepFactor, 25);
            
            // Calculate Stress Factor (0-25 points)
            const stressFactor = calculateStressFactor(todayData.sleepHours, todayData.stressLevel, todayData.focusLevel);
            updateMetricCard('stressFactorCard', 'stressFactorScore', 'stressFactorStatus', stressFactor, 25);
            
            // Calculate Discipline Factor (0-25 points)
            const disciplineFactor = calculateDisciplineFactor();
            updateMetricCard('disciplineFactorCard', 'disciplineFactorScore', 'disciplineFactorStatus', disciplineFactor, 25);
            
            // Calculate Consistency Factor (0-25 points)
            const consistencyFactor = calculateConsistencyFactor();
            updateMetricCard('consistencyFactorCard', 'consistencyFactorScore', 'consistencyFactorStatus', consistencyFactor, 25);
            
            // Calculate Daily Psychology Score (0-100)
            const dailyScore = sleepFactor + stressFactor + disciplineFactor + consistencyFactor;
            updateMetricCard('totalScoreCard', 'totalPsychScore', 'totalScoreStatus', dailyScore, 100);

            // generatePsychologyInsights Ìò∏Ï∂ú Ï†Ñ ÏöîÏÜå Ï°¥Ïû¨ ÌôïÏù∏
            if (document.getElementById('psychologyInsightsList')) {
                generatePsychologyInsights();
            }
        }

        function calculateSleepQualityFactor(sleepHours, sleepQuality) {
            if (!sleepHours) return 0;
            
            let baseScore = Math.min(sleepHours >= 7 ? 20 : (sleepHours * 20 / 7), 20);
            let qualityBonus = (sleepQuality - 3) * 1.25;
            
            return Math.max(0, Math.min(25, baseScore + qualityBonus));
        }

        function calculatePressureIndex(pressureLevel, accountBalance, dailyTarget) {
            let baseScore = 25;
            
            // Pressure penalty
            baseScore -= (pressureLevel - 3) * 5;
            
            // Target vs balance ratio check
            if (accountBalance && dailyTarget) {
                const targetRatio = dailyTarget / accountBalance;
                if (targetRatio > 0.05) { // More than 5% daily target
                    baseScore -= 8;
                } else if (targetRatio > 0.03) { // More than 3% daily target
                    baseScore -= 4;
                }
            }
            
            return Math.max(0, Math.min(25, baseScore));
        }

        function calculateEmotionalReadiness(mood, confidence) {
            let baseScore = 15;
            
            // Mood adjustment (-6 to +6)
            baseScore += (mood - 3) * 3;
            
            // Confidence adjustment (-4 to +4)
            baseScore += (confidence - 3) * 2;
            
            return Math.max(0, Math.min(25, baseScore));
        }

        function updateMetricCard(cardId, valueId, statusId, value, maxValue) {
            const card = document.getElementById(cardId);
            const valueElement = document.getElementById(valueId);
            const statusElement = document.getElementById(statusId);
            
            if (!valueElement || !statusElement) return;
            
            valueElement.textContent = Math.round(value);
            
            const percentage = (value / maxValue) * 100;
            let status, cardClass;
            
            if (percentage >= 80) {
                status = currentLanguage === 'ko' ? 'ÏµúÏ†Å' : 'Optimal';
                cardClass = 'good';
            } else if (percentage >= 60) {
                status = currentLanguage === 'ko' ? 'ÏñëÌò∏' : 'Good';
                cardClass = 'good';
            } else if (percentage >= 40) {
                status = currentLanguage === 'ko' ? 'Î≥¥ÌÜµ' : 'Fair';
                cardClass = 'warning';
            } else if (percentage >= 20) {
                status = currentLanguage === 'ko' ? 'Ï£ºÏùò' : 'Poor';
                cardClass = 'warning';
            } else {
                status = currentLanguage === 'ko' ? 'ÏúÑÌóò' : 'Critical';
                cardClass = 'danger';
            }
            
            statusElement.textContent = status;
            if (card) {
                card.className = `psychology-metric-card ${cardClass}`;
            }
        }

        function calculateStressFactor(sleepHours, stressLevel, focusLevel) {
            let baseScore = 25;
            
            // ÏàòÎ©¥ Î∂ÄÏ°± Ïãú Ïä§Ìä∏Î†àÏä§ Ï¶ùÍ∞Ä
            if (sleepHours < 6) {
                baseScore -= 8;
            } else if (sleepHours < 7) {
                baseScore -= 4;
            }
            
            // Ïä§Ìä∏Î†àÏä§ Î†àÎ≤® ÌéòÎÑêÌã∞
            baseScore -= (stressLevel - 3) * 4;
            
            // ÏßëÏ§ëÎ†• Ï°∞Ï†ï
            if (focusLevel <= 2) {
                baseScore -= 5; // ÎÇÆÏùÄ ÏßëÏ§ëÎ†•
            } else if (focusLevel >= 4) {
                baseScore += 3; // ÎÜíÏùÄ ÏßëÏ§ëÎ†•
            }
            
            return Math.max(0, Math.min(25, baseScore));
        }

        function generatePsychologyInsights() {
            const currentDate = formatTradingDate(currentTradingDate);
            const todayData = psychologyData[currentDate];
            const insightsList = document.getElementById('psychologyInsightsList');
            
            // ÏöîÏÜåÍ∞Ä Ï°¥Ïû¨ÌïòÏßÄ ÏïäÎäî Í≤ΩÏö∞ Ï≤òÎ¶¨
            if (!insightsList) {
                console.warn('psychologyInsightsList element not found');
                return;
            }
            
            if (!todayData) {
                insightsList.innerHTML = `
                    <div class="psychology-insight-item">
                        <div class="psychology-insight-text">${currentLanguage === 'ko' ? 
                            'Ïã¨Î¶¨ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§. Ïò§ÎäòÏùò Îç∞Ïù¥ÌÑ∞Î•º ÏûÖÎ†•ÌïòÏó¨ Ïù∏ÏÇ¨Ïù¥Ìä∏Î•º Î∞õÏïÑÎ≥¥ÏÑ∏Ïöî.' : 
                            'No psychology data available. Fill in today\'s data to get insights.'}</div>
                    </div>
                `;
                return;
            }
            
            const insights = [];
            
            // Sleep insights
            if (todayData.sleepHours < 6) {
                insights.push({
                    type: 'danger',
                    text: currentLanguage === 'ko' ? 
                        `ÏàòÎ©¥ Î∂ÄÏ°± Í≤ΩÍ≥†: ${todayData.sleepHours}ÏãúÍ∞Ñ ÏàòÎ©¥ÏùÄ Í±∞Îûò ÏÑ±Í≥ºÏóê Î∂ÄÏ†ïÏ†Å ÏòÅÌñ•ÏùÑ Ï§Ñ Ïàò ÏûàÏäµÎãàÎã§. 7-8ÏãúÍ∞Ñ ÏàòÎ©¥ÏùÑ Í∂åÏû•Ìï©ÎãàÎã§.` :
                        `Sleep Warning: ${todayData.sleepHours} hours of sleep may negatively impact trading performance. 7-8 hours recommended.`
                });
            } else if (todayData.sleepHours >= 7 && todayData.sleepHours <= 8) {
                insights.push({
                    type: 'good',
                    text: currentLanguage === 'ko' ? 
                        'ÏàòÎ©¥ ÏÉÅÌÉú ÏñëÌò∏: Ï∂©Î∂ÑÌïú ÏàòÎ©¥ÏúºÎ°ú ÏµúÏ†ÅÏùò Í±∞Îûò Ï§ÄÎπÑÍ∞Ä ÎêòÏóàÏäµÎãàÎã§.' :
                        'Sleep Status Good: Adequate sleep prepares you for optimal trading.'
                });
            }
            
            // Stress and focus insights
            if (todayData.stressLevel >= 4 && todayData.focusLevel <= 2) {
                insights.push({
                    type: 'danger',
                    text: currentLanguage === 'ko' ? 
                        'Í≥†Ïä§Ìä∏Î†àÏä§ + Ï†ÄÏßëÏ§ë ÏÉÅÌÉú: Í∞êÏ†ïÏ†Å ÏùòÏÇ¨Í≤∞Ï†ï ÏúÑÌóòÏù¥ ÎÜíÏäµÎãàÎã§. Ìè¨ÏßÄÏÖò ÌÅ¨Í∏∞Î•º Ï§ÑÏù¥Í≥† Ìú¥ÏãùÏùÑ Í≥†Î†§ÌïòÏÑ∏Ïöî.' :
                        'High Stress + Low Focus: High risk of emotional decisions. Consider reducing position size and taking breaks.'
                });
            }
            
            // Environment insights
            if (todayData.environmentType === 'cafe' || todayData.environmentType === 'home-noisy') {
                insights.push({
                    type: 'warning',
                    text: currentLanguage === 'ko' ? 
                        'Í±∞Îûò ÌôòÍ≤Ω Ï£ºÏùò: ÏÜåÏùåÏù¥ ÏûàÎäî ÌôòÍ≤ΩÏùÄ ÏßëÏ§ëÎ†•ÏùÑ Ï†ÄÌï¥Ìï† Ïàò ÏûàÏäµÎãàÎã§. Ï°∞Ïö©Ìïú ÌôòÍ≤ΩÏùÑ Ï∞æÏïÑÎ≥¥ÏÑ∏Ïöî.' :
                        'Trading Environment Warning: Noisy environments may impair focus. Consider finding a quieter space.'
                });
            }
            
            // Focus and confidence insights
            if (todayData.focusLevel <= 2 && todayData.confidenceLevel <= 2) {
                insights.push({
                    type: 'danger',
                    text: currentLanguage === 'ko' ? 
                        'ÏßëÏ§ëÎ†• Î∞è ÏûêÏã†Í∞ê Î∂ÄÏ°±: Ïò§ÎäòÏùÄ Í±∞ÎûòÎ•º ÌîºÌïòÍ±∞ÎÇò Îß§Ïö∞ ÏûëÏùÄ Ìè¨ÏßÄÏÖòÎßå Í≥†Î†§ÌïòÏÑ∏Ïöî.' :
                        'Low Focus & Confidence: Consider avoiding trading today or using very small positions only.'
                });
            }
            
            // Good condition insights
            const sleepScore = calculateSleepFactor(todayData.sleepHours);
            const stressScore = calculateStressFactor(todayData.sleepHours, todayData.stressLevel, todayData.focusLevel);
            const totalConditionScore = sleepScore + stressScore;
            
            if (totalConditionScore >= 40) {
                insights.push({
                    type: 'good',
                    text: currentLanguage === 'ko' ? 
                        'ÏñëÌò∏Ìïú Í±∞Îûò Ï°∞Í±¥: Ïã¨Î¶¨Ï†Å ÏöîÏù∏Ïù¥ ÏñëÌò∏Ìï©ÎãàÎã§. Í≥ÑÌöçÎêú Ï†ÑÎûµÏùÑ ÏûêÏã† ÏûàÍ≤å Ïã§ÌñâÌïòÏÑ∏Ïöî.' :
                        'Good Trading Conditions: Psychological factors are favorable. Execute your planned strategy with confidence.'
                });
            }
            
            // Default insight if no specific insights
            if (insights.length === 0) {
                insights.push({
                    type: 'good',
                    text: currentLanguage === 'ko' ? 
                        'Ïã¨Î¶¨Ï†Å Ï§ÄÎπÑ ÏÉÅÌÉú Î≥¥ÌÜµ: ÌäπÎ≥ÑÌïú Ï£ºÏùòÏÇ¨Ìï≠ÏùÄ ÏóÜÏäµÎãàÎã§. Í≥ÑÌöçÎêú Í±∞Îûò Ï†ÑÎûµÏùÑ Îî∞Î•¥ÏÑ∏Ïöî.' :
                        'Psychological Readiness Fair: No specific warnings. Follow your planned trading strategy.'
                });
            }
            
            // Render insights
            insightsList.innerHTML = insights.map(insight => `
                <div class="psychology-insight-item ${insight.type === 'danger' ? 'danger' : insight.type === 'warning' ? 'warning' : ''}">
                    <div class="psychology-insight-text">${insight.text}</div>
                </div>
            `).join('');
        }

        // Enhanced Psychology System Functions
        function showPsychologySection(section) {
            try {
                // ÌÉ≠ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
                document.querySelectorAll('.psychology-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                event.target.classList.add('active');
                
                // ÏÑπÏÖò ÌëúÏãú/Ïà®Í∏∞Í∏∞
                document.querySelectorAll('.psychology-section').forEach(sec => {
                    sec.classList.remove('active');
                });
                
                // ÏÑπÏÖò ID Îß§Ìïë
                let targetSectionId;
                switch(section) {
                    case 'input':
                        targetSectionId = 'psychologyInputSection';
                        break;
                    case 'metrics':
                        targetSectionId = 'psychologyMetricsSection';
                        break;
                    case 'bias-analysis':
                        targetSectionId = 'psychologyBiasSection';
                        break;
                    case 'patterns':
                        targetSectionId = 'psychologyPatternsSection';
                        break;
                    default:
                        targetSectionId = 'psychologyInputSection';
                }
                
                const targetSection = document.getElementById(targetSectionId);
                if (targetSection) {
                    targetSection.classList.add('active');
                }
                
                // Ìï¥Îãπ ÏÑπÏÖòÏùò Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏
                if (section === 'metrics') {
                    updatePsychologyMetrics();
                } else if (section === 'bias-analysis') {
                    updateBiasAnalysis();
                } else if (section === 'patterns') {
                    updatePatternInsights();
                }

                if (section === 'input') {
                    setTimeout(() => {
                        updateVisualCards();
                    }, 100);
                }
            } catch (error) {
                console.error('Error showing psychology section:', error);
            }
        }

        function calculateDailyScore() {
            const currentDate = formatTradingDate(currentTradingDate);
            const todayData = psychologyData[currentDate];
            
            if (!todayData) {
                alert(currentLanguage === 'ko' ? 'Î®ºÏ†Ä Ïã¨Î¶¨ Îç∞Ïù¥ÌÑ∞Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' : 'Please input psychology data first.');
                return;
            }
            
            // ÏàòÎ©¥ ÏöîÏù∏ Í≥ÑÏÇ∞ (25Ï†ê ÎßåÏ†ê)
            const sleepFactor = calculateSleepFactor(todayData.sleepHours);
            
            // Ïä§Ìä∏Î†àÏä§ ÏöîÏù∏ Í≥ÑÏÇ∞ (25Ï†ê ÎßåÏ†ê)
            const stressFactor = calculateStressFactor(todayData.sleepHours, todayData.stressLevel, todayData.focusLevel);
            
            // Í∑úÏú® ÏöîÏù∏ Í≥ÑÏÇ∞ (25Ï†ê ÎßåÏ†ê) - Í±∞Îûò Îç∞Ïù¥ÌÑ∞ Í∏∞Î∞ò
            const disciplineFactor = calculateDisciplineFactor();
            
            // ÏùºÍ¥ÄÏÑ± ÏöîÏù∏ Í≥ÑÏÇ∞ (25Ï†ê ÎßåÏ†ê) - Í±∞Îûò Îç∞Ïù¥ÌÑ∞ Í∏∞Î∞ò
            const consistencyFactor = calculateConsistencyFactor();
            
            // Ï¥ùÏ†ê Í≥ÑÏÇ∞
            const totalScore = sleepFactor + stressFactor + disciplineFactor + consistencyFactor;
            
            // UI ÏóÖÎç∞Ïù¥Ìä∏
            updateScoreCard('sleepFactorCard', 'sleepFactorScore', 'sleepFactorStatus', sleepFactor, 25);
            updateScoreCard('stressFactorCard', 'stressFactorScore', 'stressFactorStatus', stressFactor, 25);
            updateScoreCard('disciplineFactorCard', 'disciplineFactorScore', 'disciplineFactorStatus', disciplineFactor, 25);
            updateScoreCard('consistencyFactorCard', 'consistencyFactorScore', 'consistencyFactorStatus', consistencyFactor, 25);
            updateScoreCard('totalScoreCard', 'totalPsychScore', 'totalScoreStatus', totalScore, 100);
            
            showToast(currentLanguage === 'ko' ? 'ÏùºÏùº Ïã¨Î¶¨ Ï†êÏàòÍ∞Ä Í≥ÑÏÇ∞ÎêòÏóàÏäµÎãàÎã§' : 'Daily psychology score calculated');
        }

        function calculateSleepFactor(sleepHours) {
            if (!sleepHours) return 0;
            
            // 7-8ÏãúÍ∞ÑÏù¥ ÏµúÏ†Å
            if (sleepHours >= 7 && sleepHours <= 8) {
                return 25;
            } else if (sleepHours >= 6 && sleepHours < 7) {
                return 20;
            } else if (sleepHours >= 5 && sleepHours < 6) {
                return 15;
            } else if (sleepHours > 8 && sleepHours <= 9) {
                return 20;
            } else if (sleepHours > 9) {
                return 15;
            } else {
                return 5; // 5ÏãúÍ∞Ñ ÎØ∏Îßå
            }
        }

        function calculateDisciplineFactor() {
            // ÏµúÍ∑º 30Í±∞ÎûòÏùò Í∑úÏú® Ï§ÄÏàòÎèÑ Î∂ÑÏÑù
            const recentTrades = trades.slice(-30);
            if (recentTrades.length === 0) return 15; // Í∏∞Î≥∏Í∞í
            
            // ÏÜêÏ†àÎß§ Ïã§ÌñâÎ•† Í∞ÄÏ†ï (Ïã§Ï†úÎ°úÎäî Í±∞Îûò Îç∞Ïù¥ÌÑ∞ÏóêÏÑú Í≥ÑÏÇ∞)
            let disciplineScore = 25;
            
            // Ìè¨ÏßÄÏÖò ÌÅ¨Í∏∞ ÏùºÍ¥ÄÏÑ± Í≤ÄÏÇ¨
            const positionSizes = recentTrades.map(trade => trade.amount);
            const avgPosition = positionSizes.reduce((sum, size) => sum + size, 0) / positionSizes.length;
            const deviation = Math.sqrt(positionSizes.reduce((sum, size) => sum + Math.pow(size - avgPosition, 2), 0) / positionSizes.length) / avgPosition;
            
            if (deviation > 0.5) disciplineScore -= 10;
            else if (deviation > 0.3) disciplineScore -= 5;
            
            return Math.max(0, Math.min(25, disciplineScore));
        }

        function calculateConsistencyFactor() {
            const recentTrades = trades.slice(-20);
            if (recentTrades.length === 0) return 15; // Í∏∞Î≥∏Í∞í
            
            let consistencyScore = 25;
            
            // Í±∞Îûò ÏãúÍ∞Ñ ÏùºÍ¥ÄÏÑ±
            const tradeTimes = recentTrades.filter(trade => trade.entryTime).map(trade => {
                const [hour] = trade.entryTime.split(':').map(Number);
                return hour;
            });
            
            if (tradeTimes.length > 0) {
                const timeDeviation = calculateStandardDeviation(tradeTimes);
                if (timeDeviation > 3) consistencyScore -= 8;
                else if (timeDeviation > 2) consistencyScore -= 4;
            }
            
            return Math.max(0, Math.min(25, consistencyScore));
        }

        function updateScoreCard(cardId, scoreId, statusId, score, maxScore) {
            const card = document.getElementById(cardId);
            const scoreElement = document.getElementById(scoreId);
            const statusElement = document.getElementById(statusId);
            
            if (scoreElement) {
                scoreElement.textContent = `${Math.round(score)}/${maxScore}`;
            }
            
            const percentage = (score / maxScore) * 100;
            let status, cardClass;
            
            if (percentage >= 90) {
                status = currentLanguage === 'ko' ? 'ÏµúÏ†Å' : 'Optimal';
                cardClass = 'good';
            } else if (percentage >= 75) {
                status = currentLanguage === 'ko' ? 'Ïö∞Ïàò' : 'Excellent';
                cardClass = 'good';
            } else if (percentage >= 60) {
                status = currentLanguage === 'ko' ? 'ÏñëÌò∏' : 'Good';
                cardClass = 'good';
            } else if (percentage >= 40) {
                status = currentLanguage === 'ko' ? 'Î≥¥ÌÜµ' : 'Fair';
                cardClass = 'warning';
            } else if (percentage >= 20) {
                status = currentLanguage === 'ko' ? 'Ï£ºÏùò' : 'Poor';
                cardClass = 'warning';
            } else {
                status = currentLanguage === 'ko' ? 'ÏúÑÌóò' : 'Critical';
                cardClass = 'danger';
            }
            
            if (statusElement) {
                statusElement.textContent = status;
            }
            
            if (card) {
                card.className = `psychology-metric-card ${cardClass}`;
                card.style.borderColor = cardClass === 'good' ? '#10b981' : 
                                        cardClass === 'warning' ? '#f59e0b' : '#ef4444';
            }
        }

        function updateBiasAnalysis() {
            // Í≥ºÏã† Ìé∏Ìñ• Î∂ÑÏÑù
            calculateOverconfidenceBias();
            
            // ÏÜêÏã§ ÌöåÌîº Î∂ÑÏÑù
            calculateLossAversionBias();
            
            // ÏïµÏª§ÎßÅ Ìé∏Ìñ• Î∂ÑÏÑù
            calculateAnchoringBias();

            // Ï†ÑÏ≤¥ Ìé∏Ìñ• ÏúÑÌóòÎèÑ Í≥ÑÏÇ∞
            calculateOverallBiasRisk();
        }

        function calculateOverallBiasRisk() {
            // Í∞Å Ìé∏Ìñ•Ïùò ÏúÑÌóòÎèÑÎ•º 0-100 Ï†êÏàòÎ°ú Î≥ÄÌôò
            let overconfidenceScore = 0;
            let lossAversionScore = 0;
            let anchoringScore = 0;
            
            // Í≥ºÏã† Ìé∏Ìñ• Ï†êÏàò Í≥ÑÏÇ∞
            const calibrationError = parseFloat(document.getElementById('calibrationError').textContent) || 0;
            const overtradingIndex = Math.abs(parseFloat(document.getElementById('overtradingIndex').textContent)) || 0;
            const positionDeviation = parseFloat(document.getElementById('positionDeviation').textContent) || 0;
            
            overconfidenceScore = Math.min(100, (calibrationError * 2) + (overtradingIndex * 0.5) + (positionDeviation * 100));
            
            // ÏÜêÏã§ ÌöåÌîº Ï†êÏàò Í≥ÑÏÇ∞
            const dispositionRatio = parseFloat(document.getElementById('dispositionRatio').textContent) || 1;
            lossAversionScore = Math.min(100, Math.max(0, (dispositionRatio - 1) * 50));
            
            // ÏïµÏª§ÎßÅ Ï†êÏàò Í≥ÑÏÇ∞
            const roundNumberBias = parseFloat(document.getElementById('roundNumberBias').textContent) || 0;
            anchoringScore = Math.min(100, roundNumberBias * 1.5);
            
            // Ï†ÑÏ≤¥ Ï†êÏàò Í≥ÑÏÇ∞
            const overallScore = (overconfidenceScore + lossAversionScore + anchoringScore) / 3;
            
            // ÏúÑÌóòÎèÑ Î†àÎ≤® Í≤∞Ï†ï
            let riskLevel, riskColor;
            if (overallScore < 20) {
                riskLevel = currentLanguage === 'ko' ? 'ÎÇÆÏùå' : 'Low';
                riskColor = '#10b981';
            } else if (overallScore < 50) {
                riskLevel = currentLanguage === 'ko' ? 'Î≥¥ÌÜµ' : 'Medium';
                riskColor = '#f59e0b';
            } else {
                riskLevel = currentLanguage === 'ko' ? 'ÎÜíÏùå' : 'High';
                riskColor = '#ef4444';
            }
            
            // UI ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('overallBiasRisk').textContent = riskLevel;
            document.getElementById('overallBiasRisk').style.color = riskColor;
            document.getElementById('overallBiasScore').textContent = `Score: ${overallScore.toFixed(0)}/100`;
            
            // Ï°∞Ïπò ÌïÑÏöî Ïó¨Î∂Ä
            let actionNeeded, actionDetails;
            if (overallScore > 70) {
                actionNeeded = currentLanguage === 'ko' ? 'Ï¶âÏãú Ï°∞Ïπò' : 'Immediate Action';
                actionDetails = currentLanguage === 'ko' ? 'Ìé∏Ìñ• ÏúÑÌóò ÎÜíÏùå' : 'High bias risk';
            } else if (overallScore > 40) {
                actionNeeded = currentLanguage === 'ko' ? 'Ï£ºÏùò ÌïÑÏöî' : 'Caution Needed';
                actionDetails = currentLanguage === 'ko' ? 'ÏùºÎ∂Ä Ìé∏Ìñ• Í∞êÏßÄ' : 'Some bias detected';
            } else {
                actionNeeded = currentLanguage === 'ko' ? 'ÏóÜÏùå' : 'None';
                actionDetails = currentLanguage === 'ko' ? 'Î™®Îì† ÏßÄÌëú Ï†ïÏÉÅ' : 'All metrics normal';
            }
            
            document.getElementById('actionNeeded').textContent = actionNeeded;
            document.getElementById('actionNeeded').style.color = overallScore > 70 ? '#ef4444' : overallScore > 40 ? '#f59e0b' : '#10b981';
            document.getElementById('actionDetails').textContent = actionDetails;

            }
        
        function calculateOverconfidenceBias() {
            const recentTrades = trades.slice(-50);
            if (recentTrades.length === 0) return;
            
            // Ï∫òÎ¶¨Î∏åÎ†àÏù¥ÏÖò ÏóêÎü¨ Í≥ÑÏÇ∞ (ÏòàÏ∏° ÎåÄÎπÑ Ïã§Ï†ú)
            const currentDate = formatTradingDate(currentTradingDate);
            const todayData = psychologyData[currentDate];
            
            if (todayData && todayData.predictedWinRate) {
                const actualWinRate = (recentTrades.filter(t => t.pnl > 0).length / recentTrades.length) * 100;
                const calibrationError = Math.abs(todayData.predictedWinRate - actualWinRate);
                
                document.getElementById('calibrationError').textContent = `${calibrationError.toFixed(1)}%`;
                document.getElementById('calibrationErrorBar').style.width = `${Math.min(calibrationError * 5, 100)}%`;
                document.getElementById('calibrationErrorBar').style.backgroundColor = calibrationError > 20 ? '#ef4444' : calibrationError > 10 ? '#f59e0b' : '#10b981';
            }
            
            // Í≥ºÎèÑÍ±∞Îûò ÏßÄÏàò
            if (todayData && todayData.plannedTrades) {
                const actualTrades = recentTrades.filter(t => t.date === currentDate).length;
                const overtradingIndex = ((actualTrades - todayData.plannedTrades) / todayData.plannedTrades) * 100;
                
                document.getElementById('overtradingIndex').textContent = `${overtradingIndex.toFixed(0)}%`;
                document.getElementById('overtradingBar').style.width = `${Math.min(Math.abs(overtradingIndex), 100)}%`;
                document.getElementById('overtradingBar').style.backgroundColor = Math.abs(overtradingIndex) > 50 ? '#ef4444' : '#f59e0b';
            }
            
            // Ìè¨ÏßÄÏÖò ÌÅ¨Í∏∞ Ìé∏Ï∞®
            const positionSizes = recentTrades.map(trade => trade.amount);
            if (positionSizes.length > 0) {
                const avgPosition = positionSizes.reduce((sum, size) => sum + size, 0) / positionSizes.length;
                const deviation = calculateStandardDeviation(positionSizes) / avgPosition;
                
                document.getElementById('positionDeviation').textContent = deviation.toFixed(2);
                document.getElementById('positionDeviationBar').style.width = `${Math.min(deviation * 200, 100)}%`;
                document.getElementById('positionDeviationBar').style.backgroundColor = deviation > 0.3 ? '#ef4444' : '#3b82f6';
            }
        }

        function calculateLossAversionBias() {
            const recentTrades = trades.slice(-50);
            if (recentTrades.length === 0) return;
            
            const winningTrades = recentTrades.filter(t => t.pnl > 0);
            const losingTrades = recentTrades.filter(t => t.pnl < 0);
            
            // Ï≤òÎ∂Ñ Ìö®Í≥º ÎπÑÏú® (ÏÜêÏã§ Í±∞Îûò Î≥¥Ïú† ÏãúÍ∞Ñ / ÏàòÏùµ Í±∞Îûò Î≥¥Ïú† ÏãúÍ∞Ñ)
            const winningHoldTimes = winningTrades.filter(t => t.holdingTime).map(t => parseInt(t.holdingTime.replace('m', '')));
            const losingHoldTimes = losingTrades.filter(t => t.holdingTime).map(t => parseInt(t.holdingTime.replace('m', '')));
            
            if (winningHoldTimes.length > 0 && losingHoldTimes.length > 0) {
                const avgWinHold = winningHoldTimes.reduce((sum, time) => sum + time, 0) / winningHoldTimes.length;
                const avgLossHold = losingHoldTimes.reduce((sum, time) => sum + time, 0) / losingHoldTimes.length;
                const dispositionRatio = avgLossHold / avgWinHold;
                
                document.getElementById('dispositionRatio').textContent = dispositionRatio.toFixed(2);
                document.getElementById('dispositionBar').style.width = `${Math.min(dispositionRatio * 25, 100)}%`;
                document.getElementById('dispositionBar').style.backgroundColor = dispositionRatio > 2.0 ? '#ef4444' : '#10b981';
            }
        }

        function calculateAnchoringBias() {
            // ÏïµÏª§ÎßÅ Ìé∏Ìñ• Î∂ÑÏÑù (Í∞ÑÎã®Ìïú Î≤ÑÏ†Ñ)
            const recentTrades = trades.slice(-30);
            if (recentTrades.length === 0) return;
            
            // ÎùºÏö¥Îìú ÎÑòÎ≤Ñ ÏùòÏ°¥ÎèÑ (Îã®ÏàúÌôîÎêú Í≥ÑÏÇ∞)
            const roundNumberTrades = recentTrades.filter(trade => {
                const buyPrice = trade.buyPrice;
                const sellPrice = trade.sellPrice;
                return (buyPrice % 1 === 0) || (sellPrice % 1 === 0);
            });
            
            const roundNumberBias = (roundNumberTrades.length / recentTrades.length) * 100;
            
            document.getElementById('roundNumberBias').textContent = `${roundNumberBias.toFixed(0)}%`;
            document.getElementById('roundNumberBar').style.width = `${roundNumberBias}%`;
            document.getElementById('roundNumberBar').style.backgroundColor = roundNumberBias > 40 ? '#ef4444' : '#f59e0b';
        }

        function updatePatternInsights() {
            analyzeTimeBasedPerformance();
            analyzeConsecutiveTradesPattern();
            generateAIInsights();
        }

        function analyzeTimeBasedPerformance() {
            const hourlyPerformance = {};
            
            trades.forEach(trade => {
                if (trade.entryTime) {
                    const hour = parseInt(trade.entryTime.split(':')[0]);
                    if (!hourlyPerformance[hour]) {
                        hourlyPerformance[hour] = { wins: 0, total: 0, totalPnL: 0 };
                    }
                    hourlyPerformance[hour].total++;
                    hourlyPerformance[hour].totalPnL += trade.pnl;
                    if (trade.pnl > 0) hourlyPerformance[hour].wins++;
                }
            });
            
            // ÏµúÍ≥†/ÏµúÏïÖ ÏãúÍ∞ÑÎåÄ Ï∞æÍ∏∞
            let bestHour = null, worstHour = null;
            let bestWinRate = 0, worstWinRate = 100;
            
            Object.entries(hourlyPerformance).forEach(([hour, data]) => {
                if (data.total >= 3) { // ÏµúÏÜå 3Í±∞Îûò Ïù¥ÏÉÅ
                    const winRate = (data.wins / data.total) * 100;
                    if (winRate > bestWinRate) {
                        bestWinRate = winRate;
                        bestHour = hour;
                    }
                    if (winRate < worstWinRate) {
                        worstWinRate = winRate;
                        worstHour = hour;
                    }
                }
            });
            
            if (bestHour) {
                document.getElementById('bestTradingHour').textContent = `${bestHour}:00`;
                document.getElementById('bestHourPerformance').textContent = `Win Rate: ${bestWinRate.toFixed(0)}%`;
            }
            
            if (worstHour) {
                document.getElementById('worstTradingHour').textContent = `${worstHour}:00`;
                document.getElementById('worstHourPerformance').textContent = `Win Rate: ${worstWinRate.toFixed(0)}%`;
            }
        }

        function analyzeConsecutiveTradesPattern() {
            // Ïó∞ÏÜç Í±∞Îûò Ìå®ÌÑ¥ Î∂ÑÏÑù
            const sortedTrades = [...trades].sort((a, b) => new Date(a.date + ' ' + (a.entryTime || '00:00')) - new Date(b.date + ' ' + (b.entryTime || '00:00')));
            
            const patterns = {
                after1Loss: [], after2Losses: [], after3Losses: [],
                after1Win: [], after2Wins: [], after3Wins: []
            };
            
            for (let i = 1; i < sortedTrades.length; i++) {
                const current = sortedTrades[i];
                const prev1 = sortedTrades[i-1];
                
                if (prev1.pnl < 0) {
                    patterns.after1Loss.push(current.pnl > 0 ? 1 : 0);
                    
                    if (i >= 2 && sortedTrades[i-2].pnl < 0) {
                        patterns.after2Losses.push(current.pnl > 0 ? 1 : 0);
                        
                        if (i >= 3 && sortedTrades[i-3].pnl < 0) {
                            patterns.after3Losses.push(current.pnl > 0 ? 1 : 0);
                        }
                    }
                } else if (prev1.pnl > 0) {
                    patterns.after1Win.push(current.pnl > 0 ? 1 : 0);
                    
                    if (i >= 2 && sortedTrades[i-2].pnl > 0) {
                        patterns.after2Wins.push(current.pnl > 0 ? 1 : 0);
                        
                        if (i >= 3 && sortedTrades[i-3].pnl > 0) {
                            patterns.after3Wins.push(current.pnl > 0 ? 1 : 0);
                        }
                    }
                }
            }
            
            // Ìå®ÌÑ¥ Í≤∞Í≥º ÏóÖÎç∞Ïù¥Ìä∏
            Object.entries(patterns).forEach(([key, values]) => {
                if (values.length > 0) {
                    const winRate = (values.reduce((sum, val) => sum + val, 0) / values.length) * 100;
                    const elementId = key.charAt(0).toLowerCase() + key.slice(1);
                    const element = document.getElementById(elementId);
                    if (element) {
                        element.textContent = `${winRate.toFixed(0)}%`;
                        element.style.color = winRate >= 50 ? '#10b981' : '#ef4444';
                    }
                }
            });
        }

        function generateAIInsights() {
            const insights = [];
            const currentDate = formatTradingDate(currentTradingDate);
            const todayData = psychologyData[currentDate];
            
            // ÏàòÎ©¥Í≥º ÏÑ±Í≥º ÏÉÅÍ¥ÄÍ¥ÄÍ≥Ñ Î∂ÑÏÑù
            const sleepPerformance = analyzeSleepPerformance();
            if (sleepPerformance.correlation !== null) {
                if (sleepPerformance.correlation > 0.3) {
                    insights.push({
                        type: 'good',
                        text: currentLanguage === 'ko' ? 
                            `ÏàòÎ©¥ ÏãúÍ∞ÑÍ≥º Í±∞Îûò ÏÑ±Í≥º Í∞Ñ Í∞ïÌïú ÏñëÏùò ÏÉÅÍ¥ÄÍ¥ÄÍ≥Ñ Î∞úÍ≤¨ (${(sleepPerformance.correlation * 100).toFixed(0)}%). Ï∂©Î∂ÑÌïú ÏàòÎ©¥Ïù¥ ÏÑ±Í≥º Ìñ•ÏÉÅÏóê ÎèÑÏõÄÎê©ÎãàÎã§.` :
                            `Strong positive correlation found between sleep and trading performance (${(sleepPerformance.correlation * 100).toFixed(0)}%). Adequate sleep helps improve performance.`
                    });
                } else if (sleepPerformance.correlation < -0.3) {
                    insights.push({
                        type: 'warning',
                        text: currentLanguage === 'ko' ? 
                            `ÏàòÎ©¥ ÏãúÍ∞ÑÍ≥º Í±∞Îûò ÏÑ±Í≥º Í∞Ñ ÏùåÏùò ÏÉÅÍ¥ÄÍ¥ÄÍ≥Ñ Î∞úÍ≤¨. Í≥ºÎèÑÌïú ÏàòÎ©¥Ïù¥ÎÇò ÏàòÎ©¥ Ìå®ÌÑ¥ÏùÑ Ïû¨Í≤ÄÌÜ†Ìï¥Î≥¥ÏÑ∏Ïöî.` :
                            `Negative correlation found between sleep and trading performance. Consider reviewing your sleep patterns.`
                    });
                }
            }
            
            // Í≥ºÎèÑÍ±∞Îûò Ìå®ÌÑ¥ Í∞êÏßÄ
            const recentOvertrading = detectOvertrading();
            if (recentOvertrading > 30) {
                insights.push({
                    type: 'warning',
                    text: currentLanguage === 'ko' ? 
                        `ÏµúÍ∑º Í≥ÑÌöç ÎåÄÎπÑ ${recentOvertrading.toFixed(0)}% Í≥ºÎèÑÍ±∞Îûò Í∞êÏßÄ. Í±∞Îûò ÎπàÎèÑÎ•º Ï§ÑÏù¥Í≥† ÌíàÏßàÏóê ÏßëÏ§ëÌïòÏÑ∏Ïöî.` :
                        `Recent overtrading detected: ${recentOvertrading.toFixed(0)}% above planned trades. Focus on quality over quantity.`
                });
            }
            
            // ÏãúÍ∞ÑÎåÄÎ≥Ñ ÏµúÏ†ÅÌôî Ï†úÏïà
            const timeOptimization = getTimeOptimization();
            if (timeOptimization) {
                insights.push({
                    type: 'good',
                    text: currentLanguage === 'ko' ? 
                        `ÏµúÏ†Å Í±∞Îûò ÏãúÍ∞ÑÎåÄ: ${timeOptimization.bestHour}:00-${timeOptimization.bestHour + 1}:00 (ÏäπÎ•† ${timeOptimization.winRate.toFixed(0)}%)` :
                        `Optimal trading time: ${timeOptimization.bestHour}:00-${timeOptimization.bestHour + 1}:00 (${timeOptimization.winRate.toFixed(0)}% win rate)`
                });
            }
            
            // Ïó∞ÏÜç ÏÜêÏã§ ÌõÑ Ï£ºÏùòÏÇ¨Ìï≠
            const consecutiveLossPattern = getConsecutiveLossPattern();
            if (consecutiveLossPattern && consecutiveLossPattern.after3Losses < 40) {
                insights.push({
                    type: 'danger',
                    text: currentLanguage === 'ko' ? 
                        `3Ïó∞ÏÜç ÏÜêÏã§ ÌõÑ ÏäπÎ•†Ïù¥ ${consecutiveLossPattern.after3Losses.toFixed(0)}%Î°ú Í∏âÍ∞ê. Ïó∞ÏÜç ÏÜêÏã§ Ïãú Í±∞Îûò Ï§ëÎã®ÏùÑ Í≥†Î†§ÌïòÏÑ∏Ïöî.` :
                        `Win rate drops to ${consecutiveLossPattern.after3Losses.toFixed(0)}% after 3 consecutive losses. Consider taking a break.`
                });
            }
            
            // Í∏∞Î≥∏ Î©îÏãúÏßÄ
            if (insights.length === 0) {
                insights.push({
                    type: 'info',
                    text: currentLanguage === 'ko' ? 
                        'Îçî ÎßéÏùÄ Ïã¨Î¶¨ Îç∞Ïù¥ÌÑ∞ÏôÄ Í±∞Îûò Í∏∞Î°ùÏùÑ ÏàòÏßëÌïòÏó¨ Í∞úÏù∏ÌôîÎêú Ïù∏ÏÇ¨Ïù¥Ìä∏Î•º ÏÉùÏÑ±ÌïòÏÑ∏Ïöî.' :
                        'Collect more psychology data and trading records to generate personalized insights.'
                });
            }
            
            // Ïù∏ÏÇ¨Ïù¥Ìä∏ Î†åÎçîÎßÅ
            const insightsList = document.getElementById('aiInsightsList');
            if (insightsList) {
                insightsList.innerHTML = insights.map(insight => `
                    <div style="background: #0f172a; border-left: 4px solid ${getInsightColor(insight.type)}; padding: 12px 16px; border-radius: 0 6px 6px 0;">
                        <div style="color: #e4e4e7; font-size: 14px; line-height: 1.5;">${insight.text}</div>
                    </div>
                `).join('');
            }
        }

        // Enhanced Psychology System Functions with Visual Cards
        function updateSliderDisplay(sliderId, displayId) {
            const slider = document.getElementById(sliderId);
            const display = document.getElementById(displayId);
            if (slider && display) {
                display.textContent = slider.value;
            }
            updateVisualCards();
        }

        function updateTargetPercentages() {
            const balanceEl = document.getElementById('accountBalance');
            const targetEl = document.getElementById('dailyTarget');
            const maxLossEl = document.getElementById('maxDailyLoss');
            
            const balance = balanceEl ? parseFloat(balanceEl.value) || 0 : 0;
            const target = targetEl ? parseFloat(targetEl.value) || 0 : 0;
            const maxLoss = maxLossEl ? parseFloat(maxLossEl.value) || 0 : 0;
            
            const targetPercentEl = document.getElementById('dailyTargetPercent');
            const lossPercentEl = document.getElementById('maxLossPercent');
            
            if (balance > 0) {
                const targetPercent = (target / balance * 100).toFixed(1);
                const lossPercent = (maxLoss / balance * 100).toFixed(1);
                
                if (targetPercentEl) targetPercentEl.textContent = `${targetPercent}%`;
                if (lossPercentEl) lossPercentEl.textContent = `${lossPercent}%`;
            } else {
                if (targetPercentEl) targetPercentEl.textContent = '0%';
                if (lossPercentEl) lossPercentEl.textContent = '0%';
            }
            updateVisualCards();
        }

        function updateVisualCards() {
            try {
                updateSleepCard();
                updateEnvironmentCard();
                updateEmotionalCard();
                updateRiskCard();
                
                // Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏ (ÎîúÎ†àÏù¥Î•º Ï£ºÏñ¥ DOM ÏóÖÎç∞Ïù¥Ìä∏ ÌõÑ Ïã§Ìñâ)
                setTimeout(() => {
                    createPsychologyChart();
                }, 100);
            } catch (error) {
                console.error('Error updating visual cards:', error);
            }
        }

        function updateSleepCard() {
            try {
                const sleepHoursEl = document.getElementById('sleepHours');
                const sleepHours = sleepHoursEl ? parseFloat(sleepHoursEl.value) || 0 : 0;
                
                const sleepHoursDisplayEl = document.getElementById('sleepHoursDisplay');
                if (sleepHoursDisplayEl) {
                    sleepHoursDisplayEl.textContent = sleepHours;
                }
                
                let quality = 0;
                let status = 'No data';
                
                if (sleepHours > 0) {
                    if (sleepHours >= 7 && sleepHours <= 8) {
                        quality = 100;
                        status = currentLanguage === 'ko' ? 'ÏµúÏ†Å ÏàòÎ©¥ Î≤îÏúÑ' : 'Optimal sleep range';
                    } else if (sleepHours >= 6 && sleepHours < 7) {
                        quality = 75;
                        status = currentLanguage === 'ko' ? 'Ï†ÅÏ†àÌïú ÏàòÎ©¥' : 'Adequate sleep';
                    } else if (sleepHours >= 5 && sleepHours < 6) {
                        quality = 50;
                        status = currentLanguage === 'ko' ? 'ÏµúÏ†ÅÏπò Ïù¥Ìïò' : 'Below optimal';
                    } else if (sleepHours < 5) {
                        quality = 25;
                        status = currentLanguage === 'ko' ? 'ÏàòÎ©¥ Î∂ÄÏ°±' : 'Sleep deprived';
                    } else if (sleepHours > 8) {
                        quality = 60;
                        status = currentLanguage === 'ko' ? 'Í≥ºÏàòÎ©¥ Í∞êÏßÄ' : 'Oversleep detected';
                    }
                }
                
                const sleepQualityBarEl = document.getElementById('sleepQualityBar');
                if (sleepQualityBarEl) {
                    sleepQualityBarEl.style.width = `${quality}%`;
                }
                
                const sleepStatusEl = document.getElementById('sleepStatus');
                if (sleepStatusEl) {
                    sleepStatusEl.textContent = status;
                }
            } catch (error) {
                console.error('Error updating sleep card:', error);
            }
        }

        function updateEnvironmentCard() {
            const envType = document.getElementById('environmentType').value;
            const focusLevel = parseInt(document.getElementById('focusLevel').value) || 3;
            
            const envScores = {
                'home': 85,
                'office': 70,
                'cafe': 50,
                'hotel': 40
            };
            
            const baseScore = envScores[envType] || 50;
            const focusAdjustment = (focusLevel - 3) * 10;
            const totalScore = Math.max(0, Math.min(100, baseScore + focusAdjustment));
            
            document.getElementById('environmentScore').textContent = Math.round(totalScore);
            document.getElementById('environmentTypeDisplay').textContent = envType.charAt(0).toUpperCase() + envType.slice(1);
            
            const circle = document.getElementById('environmentCircle');
            if (circle) {
                const circumference = 157;
                const offset = circumference - (totalScore / 100) * circumference;
                circle.style.strokeDashoffset = offset;
            }
            
            let status = 'Good';
            if (totalScore >= 80) status = 'Excellent';
            else if (totalScore >= 60) status = 'Good';
            else if (totalScore >= 40) status = 'Fair';
            else status = 'Poor';
            
            document.getElementById('environmentStatus').textContent = status;
        }

        function updateEmotionalCard() {
            const stress = parseInt(document.getElementById('stressLevel').value) || 3;
            const confidence = parseInt(document.getElementById('confidenceLevel').value) || 3;
            const focus = parseInt(document.getElementById('focusLevel').value) || 3;
            
            document.getElementById('stressDisplay').textContent = stress;
            document.getElementById('confidenceDisplay').textContent = confidence;
            document.getElementById('focusDisplay').textContent = focus;
            
            const stressScore = (6 - stress) * 20;
            const confidenceScore = confidence * 20;
            const focusScore = focus * 20;
            const averageScore = (stressScore + confidenceScore + focusScore) / 3;
            
            let status = 'Balanced';
            if (averageScore >= 80) status = 'Excellent readiness';
            else if (averageScore >= 60) status = 'Good readiness';
            else if (averageScore >= 40) status = 'Fair readiness';
            else status = 'Poor readiness';
            
            document.getElementById('emotionalStatus').textContent = status;
        }

        function updateRiskCard() {
            const balance = parseFloat(document.getElementById('accountBalance').value) || 0;
            const target = parseFloat(document.getElementById('dailyTarget').value) || 0;
            const maxLoss = parseFloat(document.getElementById('maxDailyLoss').value) || 0;
            
            if (balance > 0) {
                const targetPercent = (target / balance * 100);
                const lossPercent = (maxLoss / balance * 100);
                
                document.getElementById('targetRiskPercent').textContent = `${targetPercent.toFixed(1)}%`;
                document.getElementById('maxLossRiskPercent').textContent = `${lossPercent.toFixed(1)}%`;
                
                document.getElementById('targetRiskBar').style.width = `${Math.min(targetPercent * 10, 100)}%`;
                document.getElementById('maxLossRiskBar').style.width = `${Math.min(lossPercent * 10, 100)}%`;
                
                let status = 'Conservative';
                if (targetPercent > 5 || lossPercent > 10) status = 'High risk';
                else if (targetPercent > 3 || lossPercent > 5) status = 'Moderate risk';
                else if (targetPercent > 1 || lossPercent > 2) status = 'Low risk';
                
                document.getElementById('riskStatus').textContent = status;
            } else {
                document.getElementById('targetRiskPercent').textContent = '0%';
                document.getElementById('maxLossRiskPercent').textContent = '0%';
                document.getElementById('targetRiskBar').style.width = '0%';
                document.getElementById('maxLossRiskBar').style.width = '0%';
                document.getElementById('riskStatus').textContent = 'No data';
            }
        }

        async function createPsychologyChart() {
            try {
                await waitForChart();
                
                const ctx = document.getElementById('psychologyPerformanceChart');
                if (!ctx) {
                    console.warn('Psychology chart canvas not found');
                    return;
                }
                
               // Í∏∞Ï°¥ Ï∞®Ìä∏Í∞Ä ÏûàÎã§Î©¥ ÏïàÏ†ÑÌïòÍ≤å Ï†úÍ±∞
                if (typeof window.psychologyChart !== 'undefined' && window.psychologyChart && typeof window.psychologyChart.destroy === 'function') {
                    try {
                        window.psychologyChart.destroy();
                        window.psychologyChart = null;
                    } catch (error) {
                        console.warn('Chart destruction error:', error);
                    }
                }
                
                const chartData = preparePsychologyChartData();
                
                // Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏúºÎ©¥ Í∏∞Î≥∏ Î©îÏãúÏßÄ ÌëúÏãú
                if (!chartData || (chartData.sleepData.length === 0 && chartData.stressData.length === 0 && chartData.focusData.length === 0)) {
                    const parent = ctx.parentElement;
                    if (parent) {
                        parent.innerHTML = `
                            <div style="display: flex; align-items: center; justify-content: center; height: 300px; color: #64748b; font-size: 14px;">
                                ${currentLanguage === 'ko' ? 'Ïã¨Î¶¨ Îç∞Ïù¥ÌÑ∞ÏôÄ Í±∞Îûò Í∏∞Î°ùÏùÑ ÏàòÏßëÌïòÏó¨ Ï∞®Ìä∏Î•º ÏÉùÏÑ±ÌïòÏÑ∏Ïöî' : 'Collect psychology data and trading records to generate chart'}
                            </div>
                        `;
                    }
                    return;
                }
                
                // Ï∞®Ìä∏ ÏÑ§Ï†ï
                const chartConfig = {
                    type: 'scatter',
                    data: {
                        datasets: []
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            intersect: false,
                            mode: 'point'
                        },
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    color: '#e4e4e7',
                                    usePointStyle: true,
                                    padding: 20
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(15, 23, 42, 0.9)',
                                titleColor: '#e4e4e7',
                                bodyColor: '#e4e4e7',
                                borderColor: '#334155',
                                borderWidth: 1,
                                callbacks: {
                                    title: function(context) {
                                        return context[0].dataset.label;
                                    },
                                    label: function(context) {
                                        const factor = context.dataset.label.includes('Sleep') ? 'hours' : 'level';
                                        return `${context.dataset.label}: ${context.parsed.x} ${factor}, ${context.parsed.y.toFixed(1)}% win rate`;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                type: 'linear',
                                position: 'bottom',
                                title: {
                                    display: true,
                                    text: currentLanguage === 'ko' ? 'Ïã¨Î¶¨ ÏöîÏù∏' : 'Psychology Factor',
                                    color: '#94a3b8'
                                },
                                ticks: { 
                                    color: '#94a3b8',
                                    stepSize: 1
                                },
                                grid: { 
                                    color: '#334155',
                                    drawBorder: false
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: currentLanguage === 'ko' ? 'ÏäπÎ•† (%)' : 'Win Rate (%)',
                                    color: '#94a3b8'
                                },
                                min: 0,
                                max: 100,
                                ticks: { 
                                    color: '#94a3b8',
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                },
                                grid: { 
                                    color: '#334155',
                                    drawBorder: false
                                }
                            }
                        }
                    }
                };
                
                // Îç∞Ïù¥ÌÑ∞ÏÖã Ï∂îÍ∞Ä
                if (chartData.sleepData.length > 0) {
                    chartConfig.data.datasets.push({
                        label: currentLanguage === 'ko' ? 'ÏàòÎ©¥ vs ÏÑ±Í≥º' : 'Sleep vs Performance',
                        data: chartData.sleepData,
                        backgroundColor: 'rgba(16, 185, 129, 0.7)',
                        borderColor: '#10b981',
                        pointRadius: 8,
                        pointHoverRadius: 10,
                        showLine: false
                    });
                }
                
                if (chartData.stressData.length > 0) {
                    chartConfig.data.datasets.push({
                        label: currentLanguage === 'ko' ? 'Ïä§Ìä∏Î†àÏä§ vs ÏÑ±Í≥º' : 'Stress vs Performance',
                        data: chartData.stressData,
                        backgroundColor: 'rgba(239, 68, 68, 0.7)',
                        borderColor: '#ef4444',
                        pointRadius: 8,
                        pointHoverRadius: 10,
                        showLine: false
                    });
                }
                
                if (chartData.focusData.length > 0) {
                    chartConfig.data.datasets.push({
                        label: currentLanguage === 'ko' ? 'ÏßëÏ§ëÎ†• vs ÏÑ±Í≥º' : 'Focus vs Performance',
                        data: chartData.focusData,
                        backgroundColor: 'rgba(59, 130, 246, 0.7)',
                        borderColor: '#3b82f6',
                        pointRadius: 8,
                        pointHoverRadius: 10,
                        showLine: false
                    });
                }
                
                // Ï∞®Ìä∏ ÏÉùÏÑ±
                window.psychologyChart = new Chart(ctx, chartConfig);
                
            } catch (error) {
                console.error('Error creating psychology chart:', error);
                const ctx = document.getElementById('psychologyPerformanceChart');
                if (ctx && ctx.parentElement) {
                    ctx.parentElement.innerHTML = `
                        <div style="display: flex; align-items: center; justify-content: center; height: 300px; color: #ef4444; font-size: 14px;">
                            ${currentLanguage === 'ko' ? 'Ï∞®Ìä∏ ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§' : 'Error creating chart'}
                        </div>
                    `;
                }
            }
        }

        function preparePsychologyChartData() {
            try {
                const sleepData = [];
                const stressData = [];
                const focusData = [];
                
                if (!psychologyData || typeof psychologyData !== 'object') {
                    return { sleepData, stressData, focusData };
                }
                
                Object.entries(psychologyData).forEach(([date, psyData]) => {
                    if (!psyData || typeof psyData !== 'object') return;
                    
                    const dayTrades = trades.filter(trade => trade && trade.date === date);
                    if (dayTrades.length === 0) return;
                    
                    // ÏùºÏùº ÏäπÎ•† Í≥ÑÏÇ∞
                    const winningTrades = dayTrades.filter(trade => trade.pnl > 0);
                    const winRate = dayTrades.length > 0 ? (winningTrades.length / dayTrades.length * 100) : 0;
                    
                    // ÏàòÎ©¥ Îç∞Ïù¥ÌÑ∞
                    if (psyData.sleepHours && typeof psyData.sleepHours === 'number' && psyData.sleepHours > 0) {
                        sleepData.push({ 
                            x: psyData.sleepHours, 
                            y: winRate,
                            date: date 
                        });
                    }
                    
                    // Ïä§Ìä∏Î†àÏä§ Îç∞Ïù¥ÌÑ∞
                    if (psyData.stressLevel && typeof psyData.stressLevel === 'number') {
                        stressData.push({ 
                            x: psyData.stressLevel, 
                            y: winRate,
                            date: date 
                        });
                    }
                    
                    // ÏßëÏ§ëÎ†• Îç∞Ïù¥ÌÑ∞
                    if (psyData.focusLevel && typeof psyData.focusLevel === 'number') {
                        focusData.push({ 
                            x: psyData.focusLevel, 
                            y: winRate,
                            date: date 
                        });
                    }
                });
                
                return { sleepData, stressData, focusData };
                
            } catch (error) {
                console.error('Error preparing psychology chart data:', error);
                return { sleepData: [], stressData: [], focusData: [] };
            }
        }

        function getInsightColor(type) {
            switch(type) {
                case 'good': return '#10b981';
                case 'warning': return '#f59e0b';
                case 'danger': return '#ef4444';
                default: return '#3b82f6';
            }
        }

        function analyzeSleepPerformance() {
            const dataPoints = [];
            
            Object.values(psychologyData).forEach(dayData => {
                if (dayData.sleepHours) {
                    const dayTrades = trades.filter(trade => trade.date === dayData.date);
                    if (dayTrades.length > 0) {
                        const dayPnL = dayTrades.reduce((sum, trade) => sum + trade.pnl, 0);
                        dataPoints.push({ sleep: dayData.sleepHours, performance: dayPnL });
                    }
                }
            });
            
            if (dataPoints.length < 5) return { correlation: null };
            
            // ÌîºÏñ¥Ïä® ÏÉÅÍ¥ÄÍ≥ÑÏàò Í≥ÑÏÇ∞
            const n = dataPoints.length;
            const sumSleep = dataPoints.reduce((sum, point) => sum + point.sleep, 0);
            const sumPerf = dataPoints.reduce((sum, point) => sum + point.performance, 0);
            const sumSleepSq = dataPoints.reduce((sum, point) => sum + point.sleep * point.sleep, 0);
            const sumPerfSq = dataPoints.reduce((sum, point) => sum + point.performance * point.performance, 0);
            const sumSleepPerf = dataPoints.reduce((sum, point) => sum + point.sleep * point.performance, 0);
            
            const numerator = n * sumSleepPerf - sumSleep * sumPerf;
            const denominator = Math.sqrt((n * sumSleepSq - sumSleep * sumSleep) * (n * sumPerfSq - sumPerf * sumPerf));
            
            const correlation = denominator === 0 ? 0 : numerator / denominator;
            
            return { correlation };
        }

        function detectOvertrading() {
            const today = formatTradingDate(currentTradingDate);
            const todayData = psychologyData[today];
            
            if (!todayData || !todayData.plannedTrades) return 0;
            
            const actualTrades = trades.filter(trade => trade.date === today).length;
            return ((actualTrades - todayData.plannedTrades) / todayData.plannedTrades) * 100;
        }

        function getTimeOptimization() {
            const hourlyStats = {};
            
            trades.forEach(trade => {
                if (trade.entryTime) {
                    const hour = parseInt(trade.entryTime.split(':')[0]);
                    if (!hourlyStats[hour]) {
                        hourlyStats[hour] = { wins: 0, total: 0 };
                    }
                    hourlyStats[hour].total++;
                    if (trade.pnl > 0) hourlyStats[hour].wins++;
                }
            });
            
            let bestHour = null;
            let bestWinRate = 0;
            
            Object.entries(hourlyStats).forEach(([hour, stats]) => {
                if (stats.total >= 5) { // ÏµúÏÜå 5Í±∞Îûò
                    const winRate = (stats.wins / stats.total) * 100;
                    if (winRate > bestWinRate) {
                        bestWinRate = winRate;
                        bestHour = parseInt(hour);
                    }
                }
            });
            
            return bestHour ? { bestHour, winRate: bestWinRate } : null;
        }

        function getConsecutiveLossPattern() {
            const sortedTrades = [...trades].sort((a, b) => new Date(a.date + ' ' + (a.entryTime || '00:00')) - new Date(b.date + ' ' + (b.entryTime || '00:00')));
            
            const after3Losses = [];
            
            for (let i = 3; i < sortedTrades.length; i++) {
                if (sortedTrades[i-1].pnl < 0 && sortedTrades[i-2].pnl < 0 && sortedTrades[i-3].pnl < 0) {
                    after3Losses.push(sortedTrades[i].pnl > 0 ? 1 : 0);
                }
            }
            
            if (after3Losses.length === 0) return null;
            
            const winRate = (after3Losses.reduce((sum, val) => sum + val, 0) / after3Losses.length) * 100;
            return { after3Losses: winRate };
        }
        
        // Í∏∞Ï°¥ loadPsychologyData Ìï®Ïàò ÏóÖÎç∞Ïù¥Ìä∏
        function loadPsychologyData() {
            try {
                const saved = localStorage.getItem('tradingPlatformPsychologyData');
                if (saved) {
                    psychologyData = JSON.parse(saved);
                } else {
                    psychologyData = {};
                }
            } catch (error) {
                console.error('Error loading psychology data:', error);
                psychologyData = {};
            }

            const currentDate = formatTradingDate(currentTradingDate);
            const todayData = psychologyData[currentDate];

            if (todayData) {
                // ÏïàÏ†ÑÌïú ÏöîÏÜå ÏóÖÎç∞Ïù¥Ìä∏
                const updateElement = (id, value) => {
                    const element = document.getElementById(id);
                    if (element) element.value = value;
                };

                updateElement('sleepHours', todayData.sleepHours || '');
                updateElement('startTime', todayData.startTime || '09:30');
                updateElement('endTime', todayData.endTime || '');
                updateElement('environmentType', todayData.environmentType || 'home');
                updateElement('accountBalance', todayData.accountBalance || '');
                updateElement('dailyTarget', todayData.dailyTarget || '');
                updateElement('maxDailyLoss', todayData.maxDailyLoss || '');
                updateElement('stressLevel', todayData.stressLevel || 3);
                updateElement('confidenceLevel', todayData.confidenceLevel || 3);
                updateElement('focusLevel', todayData.focusLevel || 3);

                // Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏Îäî ÏïΩÍ∞ÑÏùò ÎîúÎ†àÏù¥ ÌõÑ Ïã§Ìñâ
                setTimeout(() => {
                    updateVisualCards();
                }, 200);
            } else {
                // Í∏∞Î≥∏Í∞íÏúºÎ°ú Ï∞®Ìä∏ ÏÉùÏÑ±
                setTimeout(() => {
                    createPsychologyChart();
                }, 200);
            }
        }
        
        // Annual Heatmap Functions
        // Annual Heatmap Functions
        function renderAnnualHeatmap() {
            const currentYear = calendarDate.getFullYear();
            const heatmapGrid = document.getElementById('annualHeatmapGrid');
            const heatmapTitle = document.getElementById('annualHeatmapTitle');
            
            if (!heatmapGrid || !heatmapTitle) return;
            
            const titleText = currentLanguage === 'ko' ? `${currentYear}ÎÖÑ Í±∞Îûò Í∞úÏöî` : `${currentYear} Trading Overview`;
            heatmapTitle.textContent = titleText;
            heatmapGrid.innerHTML = '';
            
            const monthNames = currentLanguage === 'ko' ? 
                ['1Ïõî', '2Ïõî', '3Ïõî', '4Ïõî', '5Ïõî', '6Ïõî', '7Ïõî', '8Ïõî', '9Ïõî', '10Ïõî', '11Ïõî', '12Ïõî'] :
                ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            
            // Í∑∏Î¶¨ÎìúÎ•º 4x3ÏúºÎ°ú Ïû¨ÏÑ§Ï†ï
            heatmapGrid.style.cssText = `
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 20px;
                margin-bottom: 20px;
            `;
            
            for (let month = 0; month < 12; month++) {
                const monthContainer = document.createElement('div');
                monthContainer.style.cssText = `
                    background: #0f172a;
                    border: 1px solid #334155;
                    border-radius: 8px;
                    padding: 16px;
                    cursor: pointer;
                    transition: all 0.2s ease;
                    min-height: 250px;
                `;
                
                if (month === calendarDate.getMonth() && currentYear === calendarDate.getFullYear()) {
                    monthContainer.style.borderColor = '#3b82f6';
                    monthContainer.style.background = 'rgba(59, 130, 246, 0.1)';
                }
                
                monthContainer.onclick = () => showMonthDetails(currentYear, month);
                
                // Ïõî Ìó§Îçî
                const monthHeader = document.createElement('div');
                monthHeader.style.cssText = `
                    color: #e4e4e7;
                    font-size: 14px;
                    font-weight: 600;
                    text-align: center;
                    margin-bottom: 8px;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                `;
                
                monthHeader.innerHTML = `
                    <span>${monthNames[month]}, ${currentYear}</span>
                    <span style="background: #374151; color: #94a3b8; padding: 2px 6px; border-radius: 4px; font-size: 11px;">Open</span>
                `;
                
                monthContainer.appendChild(monthHeader);
                
                // ÏöîÏùº Ìó§Îçî
                const weekDayHeader = document.createElement('div');
                weekDayHeader.style.cssText = `
                    display: grid;
                    grid-template-columns: repeat(7, 1fr);
                    gap: 2px;
                    margin-bottom: 4px;
                    font-size: 10px;
                    color: #64748b;
                    text-align: center;
                    font-weight: 500;
                `;
                
                const dayAbbrs = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                dayAbbrs.forEach(day => {
                    const dayHeader = document.createElement('div');
                    dayHeader.textContent = day;
                    dayHeader.style.cssText = 'padding: 2px;';
                    weekDayHeader.appendChild(dayHeader);
                });
                
                monthContainer.appendChild(weekDayHeader);
                
                // Îã¨Î†• Í∑∏Î¶¨Îìú
                const miniCalendar = document.createElement('div');
                miniCalendar.style.cssText = `
                    display: grid;
                    grid-template-columns: repeat(7, 1fr);
                    gap: 2px;
                    height: 120px;
                    margin-bottom: 12px;
                `;
                
                const firstDay = new Date(currentYear, month, 1);
                const daysInMonth = new Date(currentYear, month + 1, 0).getDate();
                const startPadding = firstDay.getDay();
                
                let monthPnl = 0;
                let monthTrades = 0;
                
                // Ïù¥Ï†Ñ Îã¨ Îπà ÏÖÄÎì§
                const prevMonth = month === 0 ? 11 : month - 1;
                const prevYear = month === 0 ? currentYear - 1 : currentYear;
                const prevMonthDays = new Date(prevYear, prevMonth + 1, 0).getDate();
                
                for (let i = startPadding - 1; i >= 0; i--) {
                    const dayNum = prevMonthDays - i;
                    const emptyDay = document.createElement('div');
                    emptyDay.style.cssText = `
                        width: 20px;
                        height: 16px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 10px;
                        color: #4b5563;
                        background: transparent;
                    `;
                    emptyDay.textContent = dayNum;
                    miniCalendar.appendChild(emptyDay);
                }
                
                // ÌòÑÏû¨ Îã¨ ÎÇ†ÏßúÎì§
                for (let day = 1; day <= daysInMonth; day++) {
                    const date = new Date(currentYear, month, day);
                    const dateString = formatTradingDate(date);
                    const dayTrades = trades.filter(trade => trade.date === dateString);
                    
                    const dayElement = document.createElement('div');
                    dayElement.style.cssText = `
                        width: 20px;
                        height: 16px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 10px;
                        font-weight: 500;
                        border-radius: 2px;
                        cursor: pointer;
                        transition: all 0.2s ease;
                        background: #334155;
                        color: #94a3b8;
                    `;
                    
                    dayElement.textContent = day;
                    
                    if (dayTrades.length > 0) {
                        const tradePnL = dayTrades.reduce((sum, trade) => sum + trade.pnl, 0);
                        const dailyFee = dailyFees[dateString] || 0;
                        const totalPnL = tradePnL - dailyFee;
                        
                        monthPnl += totalPnL;
                        monthTrades += dayTrades.length;
                        
                        if (totalPnL > 0) {
                            dayElement.style.background = '#10b981';
                            dayElement.style.color = 'white';
                        } else if (totalPnL < 0) {
                            dayElement.style.background = '#ef4444';
                            dayElement.style.color = 'white';
                        } else {
                            dayElement.style.background = '#f59e0b';
                            dayElement.style.color = 'white';
                        }
                        
                        dayElement.title = `${day}Ïùº: $${totalPnL.toFixed(0)} (${dayTrades.length} trades)`;
                    }
                    
                    dayElement.addEventListener('mouseenter', function() {
                        this.style.transform = 'scale(1.1)';
                        this.style.zIndex = '10';
                    });
                    
                    dayElement.addEventListener('mouseleave', function() {
                        this.style.transform = 'scale(1)';
                        this.style.zIndex = '1';
                    });
                    
                    miniCalendar.appendChild(dayElement);
                }
                
                // Îã§Ïùå Îã¨ Îπà ÏÖÄÎì§
                const totalCells = 42; // 6Ï£º * 7Ïùº
                const usedCells = startPadding + daysInMonth;
                const remainingCells = totalCells - usedCells;
                
                for (let day = 1; day <= Math.min(remainingCells, 14); day++) {
                    const emptyDay = document.createElement('div');
                    emptyDay.style.cssText = `
                        width: 20px;
                        height: 16px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 10px;
                        color: #4b5563;
                        background: transparent;
                    `;
                    emptyDay.textContent = day;
                    miniCalendar.appendChild(emptyDay);
                }
                
                monthContainer.appendChild(miniCalendar);
                
                // Ïõî ÌÜµÍ≥Ñ
                const monthStats = document.createElement('div');
                monthStats.style.cssText = `
                    text-align: center;
                    border-top: 1px solid #334155;
                    padding-top: 8px;
                `;
                
                const monthPnlElement = document.createElement('div');
                monthPnlElement.style.cssText = `
                    font-size: 14px;
                    font-weight: 700;
                    margin-bottom: 4px;
                    color: ${monthPnl > 0 ? '#10b981' : monthPnl < 0 ? '#ef4444' : '#64748b'};
                `;
                monthPnlElement.textContent = `$${monthPnl.toFixed(0)}`;
                monthStats.appendChild(monthPnlElement);
                
                const monthTradesElement = document.createElement('div');
                monthTradesElement.style.cssText = `
                    font-size: 11px;
                    color: #64748b;
                `;
                const tradeText = currentLanguage === 'ko' ? 'Í±∞Îûò' : 'trades';
                monthTradesElement.textContent = `${monthTrades} ${tradeText}`;
                monthStats.appendChild(monthTradesElement);
                
                monthContainer.appendChild(monthStats);
                heatmapGrid.appendChild(monthContainer);
            }
        }

        function showMonthDetails(year, month) {
            selectedMonthYear = year;
            selectedMonth = month;
            
            const monthNames = currentLanguage === 'ko' ? 
                ['1Ïõî', '2Ïõî', '3Ïõî', '4Ïõî', '5Ïõî', '6Ïõî', '7Ïõî', '8Ïõî', '9Ïõî', '10Ïõî', '11Ïõî', '12Ïõî'] :
                ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            
            document.getElementById('monthDetailsTitle').textContent = `${monthNames[month]} ${year}`;
            
            const monthStr = `${year}-${String(month + 1).padStart(2, '0')}`;
            const monthTrades = trades.filter(trade => trade.date.startsWith(monthStr));
            
            const tradePnL = monthTrades.reduce((sum, trade) => sum + trade.pnl, 0);
            const uniqueDates = [...new Set(monthTrades.map(trade => trade.date))];
            const totalFees = uniqueDates.reduce((sum, date) => sum + (dailyFees[date] || 0), 0);
            const totalPnL = tradePnL - totalFees;
            
            const wins = monthTrades.filter(trade => trade.pnl > 0);
            const winRate = monthTrades.length > 0 ? (wins.length / monthTrades.length) * 100 : 0;
            
            document.getElementById('monthDetailPnl').textContent = `$${totalPnL.toFixed(2)}`;
            document.getElementById('monthDetailPnl').className = `month-detail-stat-value ${totalPnL >= 0 ? 'positive' : 'negative'}`;
            
            document.getElementById('monthDetailTrades').textContent = monthTrades.length;
            
            document.getElementById('monthDetailWinRate').textContent = `${winRate.toFixed(1)}%`;
            document.getElementById('monthDetailWinRate').className = `month-detail-stat-value ${winRate >= 50 ? 'positive' : 'negative'}`;
            
            document.getElementById('monthDetailsModal').style.display = 'flex';
        }

        function closeMonthDetails() {
            document.getElementById('monthDetailsModal').style.display = 'none';
            selectedMonthYear = null;
            selectedMonth = null;
        }

        function navigateToMonth() {
            if (selectedMonthYear && selectedMonth !== null) {
                calendarDate = new Date(selectedMonthYear, selectedMonth, 1);
                renderCalendar();
                closeMonthDetails();
            }
        }

        // Í∏∞Ï°¥ showWeekDetails Ìï®ÏàòÎ•º ÏôÑÏ†ÑÌûà ÍµêÏ≤¥
        function showWeekDetails(weekNumber, weekTrades, weekPnl) {
            // Í∏∞Ï°¥ ÏÑ†ÌÉùÎêú week P/L Ï¥àÍ∏∞Ìôî
            document.querySelectorAll('.calendar-week-pnl').forEach(weekEl => {
                weekEl.classList.remove('selected');
            });
            
            // ÌòÑÏû¨ ÌÅ¥Î¶≠Ìïú week P/L ÏÑ†ÌÉù ÌëúÏãú
            event.target.closest('.calendar-week-pnl').classList.add('selected');
            selectedWeekPnl = { weekNumber, weekTrades, weekPnl };
            
            const year = calendarDate.getFullYear();
            const month = calendarDate.getMonth();
            const monthNames = currentLanguage === 'ko' ? 
                ['1Ïõî', '2Ïõî', '3Ïõî', '4Ïõî', '5Ïõî', '6Ïõî', '7Ïõî', '8Ïõî', '9Ïõî', '10Ïõî', '11Ïõî', '12Ïõî'] :
                ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            
            // Ï£ºÍ∞Ñ ÌÜµÍ≥Ñ Í≥ÑÏÇ∞
            const wins = weekTrades.filter(trade => trade.pnl > 0);
            const winRate = weekTrades.length > 0 ? (wins.length / weekTrades.length) * 100 : 0;
            
            // ÏùºÎ≥Ñ P/L Í≥ÑÏÇ∞ (ÏàòÏàòÎ£å Ìè¨Ìï®)
            const dailyStats = {};
            weekTrades.forEach(trade => {
                if (!dailyStats[trade.date]) {
                    dailyStats[trade.date] = 0;
                }
                dailyStats[trade.date] += trade.pnl;
            });
            
            // ÏàòÏàòÎ£å Ï†ÅÏö©
            Object.keys(dailyStats).forEach(date => {
                const fee = dailyFees[date] || 0;
                dailyStats[date] -= fee;
            });
            
            const dailyPLs = Object.values(dailyStats);
            const bestDay = dailyPLs.length > 0 ? Math.max(...dailyPLs) : 0;
            const worstDay = dailyPLs.length > 0 && dailyPLs.some(pnl => pnl < 0) ? Math.min(...dailyPLs) : 0;
            
            // Ìã∞Ïª§Î≥Ñ ÌÜµÍ≥Ñ Í≥ÑÏÇ∞
            const tickerStats = {};
            weekTrades.forEach(trade => {
                const symbol = trade.symbol;
                if (!tickerStats[symbol]) {
                    tickerStats[symbol] = {
                        totalShares: 0,
                        totalCost: 0,
                        totalPnL: 0,
                        tradeCount: 0
                    };
                }
                
                const shares = trade.shares || (trade.amount && trade.buyPrice ? Math.round(trade.amount / trade.buyPrice) : 0);
                tickerStats[symbol].totalShares += shares;
                tickerStats[symbol].totalCost += shares * trade.buyPrice;
                tickerStats[symbol].totalPnL += trade.pnl;
                tickerStats[symbol].tradeCount++;
            });
            
            // Ï£ºÍ∞ÑÏöîÏïΩ Ïπ∏ ÏóÖÎç∞Ïù¥Ìä∏
            const weekText = currentLanguage === 'ko' ? 
                `${monthNames[month]} ${weekNumber}Ï£ºÏ∞®` : 
                `Week ${weekNumber} of ${monthNames[month]}`;
                
            document.getElementById('selectedWeekLabel').textContent = weekText;
            document.getElementById('selectedWeekTrades').textContent = weekTrades.length;
            document.getElementById('selectedWeekPnl').textContent = `$${weekPnl.toFixed(2)}`;
            document.getElementById('selectedWeekPnl').className = `weekly-value ${weekPnl >= 0 ? 'positive' : 'negative'}`;
            document.getElementById('selectedWeekWinRate').textContent = `${winRate.toFixed(1)}%`;
            document.getElementById('selectedWeekWinRate').className = `weekly-value ${winRate >= 50 ? 'positive' : 'negative'}`;
            document.getElementById('selectedWeekBestDay').textContent = `$${bestDay.toFixed(2)}`;
            document.getElementById('selectedWeekWorstDay').textContent = worstDay < 0 ? `$${worstDay.toFixed(2)}` : '$0.00';
            
            // Í∏∞Ï°¥ ÏÉÅÏÑ∏ Ï†ïÎ≥¥ Ï†úÍ±∞
            let existingWeekDetails = document.getElementById('weekTickerDetails');
            if (existingWeekDetails) {
                existingWeekDetails.remove();
            }
            
            // Ìã∞Ïª§Î≥Ñ Ï†ïÎ≥¥Î•º P/L ÏàúÏúºÎ°ú Ï†ïÎ†¨
            const sortedTickers = Object.entries(tickerStats)
                .sort((a, b) => b[1].totalPnL - a[1].totalPnL);
            
            if (sortedTickers.length > 0) {
                const weekDetailsDiv = document.createElement('div');
                weekDetailsDiv.id = 'weekTickerDetails';
                weekDetailsDiv.style.cssText = `
                    margin-top: 20px;
                    padding-top: 20px;
                    border-top: 1px solid #334155;
                `;
                
                // ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò Î≥ÄÏàò (6Í∞úÏî©)
                const itemsPerPage = 6;
                const totalPages = Math.ceil(sortedTickers.length / itemsPerPage);
                let currentPage = 1;
                
                const detailsTitle = document.createElement('div');
                detailsTitle.style.cssText = `
                    color: #f8fafc;
                    font-size: 14px;
                    font-weight: 600;
                    margin-bottom: 12px;
                    text-align: center;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                `;
                
                const titleText = currentLanguage === 'ko' ? 'Ï£ºÍ∞Ñ Ìã∞Ïª§ ÏÉÅÏÑ∏' : 'Week Ticker Details';
                
                if (totalPages > 1) {
                    detailsTitle.innerHTML = `
                        <span>${titleText}</span>
                        <div style="display: flex; gap: 4px; align-items: center;">
                            <button id="weekPrevBtn" style="background: #374151; border: 1px solid #4b5563; color: #e4e4e7; padding: 4px 6px; border-radius: 3px; cursor: pointer; font-size: 11px;">‚Äπ</button>
                            <span id="weekPageInfo" style="font-size: 11px; color: #94a3b8; min-width: 30px; text-align: center;">1/${totalPages}</span>
                            <button id="weekNextBtn" style="background: #374151; border: 1px solid #4b5563; color: #e4e4e7; padding: 4px 6px; border-radius: 3px; cursor: pointer; font-size: 11px;">‚Ä∫</button>
                        </div>
                    `;
                } else {
                    detailsTitle.innerHTML = `<span>${titleText}</span>`;
                }
                
                weekDetailsDiv.appendChild(detailsTitle);
                
                const tickerList = document.createElement('div');
                tickerList.id = 'weekTickerList';
                weekDetailsDiv.appendChild(tickerList);
                
                // ÌéòÏù¥ÏßÄ Î†åÎçîÎßÅ Ìï®Ïàò
                function renderWeekPage() {
                    const startIndex = (currentPage - 1) * itemsPerPage;
                    const endIndex = Math.min(startIndex + itemsPerPage, sortedTickers.length);
                    const pageItems = sortedTickers.slice(startIndex, endIndex);
                    
                    tickerList.innerHTML = pageItems.map(([symbol, stats]) => {
                        const avgCostBasis = stats.totalCost / stats.totalShares;
                        return `
                            <div style="background: #0f172a; border: 1px solid #334155; border-radius: 6px; padding: 8px; margin-bottom: 8px; font-size: 12px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                    <span style="font-weight: 600; color: #e4e4e7;">${symbol}</span>
                                    <span style="font-weight: 600;" class="${stats.totalPnL >= 0 ? 'positive' : 'negative'}">$${stats.totalPnL.toFixed(2)}</span>
                                </div>
                                <div style="font-size: 11px; color: #64748b;">
                                    ${currentLanguage === 'ko' ? 'Cost Basis' : 'Cost Basis'}: $${avgCostBasis.toFixed(2)} | ${stats.tradeCount} ${currentLanguage === 'ko' ? 'Í±∞Îûò' : 'trade'}${stats.tradeCount !== 1 && currentLanguage !== 'ko' ? 's' : ''}
                                </div>
                            </div>
                        `;
                    }).join('');
                    
                    if (totalPages > 1) {
                        const pageInfo = document.getElementById('weekPageInfo');
                        const prevBtn = document.getElementById('weekPrevBtn');
                        const nextBtn = document.getElementById('weekNextBtn');
                        
                        if (pageInfo) pageInfo.textContent = `${currentPage}/${totalPages}`;
                        if (prevBtn) prevBtn.style.opacity = currentPage === 1 ? '0.5' : '1';
                        if (nextBtn) nextBtn.style.opacity = currentPage === totalPages ? '0.5' : '1';
                    }
                }
                
                // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä
                if (totalPages > 1) {
                    setTimeout(() => {
                        const prevBtn = document.getElementById('weekPrevBtn');
                        const nextBtn = document.getElementById('weekNextBtn');
                        
                        if (prevBtn) {
                            prevBtn.onclick = () => {
                                if (currentPage > 1) {
                                    currentPage--;
                                    renderWeekPage();
                                }
                            };
                        }
                        
                        if (nextBtn) {
                            nextBtn.onclick = () => {
                                if (currentPage < totalPages) {
                                    currentPage++;
                                    renderWeekPage();
                                }
                            };
                        }
                    }, 50);
                }
                
                renderWeekPage();
                document.getElementById('weeklySummary').parentNode.appendChild(weekDetailsDiv);
            }
            
            // Day details Ïà®Í∏∞Í∏∞
            document.getElementById('dayDetails').style.display = 'none';
        }
        
        function closeWeekDetails() {
            document.getElementById('weekDetailsModal').style.display = 'none';
        }

  </script>
 </body>
</html>
