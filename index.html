<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Trading Platform Pro</title>
  <!-- Ïô∏Î∂Ä CSS ÌååÏùº Ïó∞Í≤∞ -->
  <link rel="stylesheet" href="css/styles.css">
 </head>
 <body>
  <div class="toast-notification" id="toastNotification">
   Data saved successfully!
  </div>
  <button class="mobile-menu-toggle" onclick="toggleSidebar()">
   ‚ò∞
  </button>
  <!-- Date picker modal -->
  <div class="date-picker-modal" id="datePickerModal">
   <div class="date-picker-content">
    <div class="date-picker-title">
     Select Trading Date
    </div>
    <input class="date-picker-input" id="datePickerInput" type="date"/>
    <div class="date-picker-actions">
     <button class="btn btn-secondary" onclick="closeDatePicker()">
      Cancel
     </button>
     <button class="btn btn-primary" onclick="applySelectedDate()">
      Apply
     </button>
    </div>
   </div>
  </div>
  <!-- Edit trade modal -->
  <div class="edit-trade-modal" id="editTradeModal">
   <div class="edit-trade-content">
    <div class="edit-trade-title">
     Edit Trade
    </div>
    <form id="editTradeForm">
     <input id="editTradeId" type="hidden"/>
     <div class="form-grid">
      <div class="form-group">
       <label>
        Symbol
       </label>
       <input id="editSymbol" required="" type="text"/>
      </div>
      <div class="form-group">
       <label>
        Shares
       </label>
       <input id="editShares" required="" type="number"/>
      </div>
      <div class="form-group">
       <label>
        Buy Price
       </label>
       <input id="editBuyPrice" required="" step="0.0001" type="number"/>
      </div>
      <div class="form-group">
       <label>
        Sell Price
       </label>
       <input id="editSellPrice" required="" step="0.0001" type="number"/>
      </div>
      <div class="form-group">
       <label>
        Entry Time
       </label>
       <input id="editEntryTime" type="time"/>
      </div>
      <div class="form-group">
       <label>
        Exit Time
       </label>
       <input id="editExitTime" type="time"/>
      </div>
     </div>
     <div class="edit-trade-actions">
      <button class="btn btn-secondary" onclick="closeEditTradeModal()" type="button">
       Cancel
      </button>
      <button class="btn btn-primary" type="submit">
       Update Trade
      </button>
     </div>
    </form>
   </div>
  </div>
  <!-- Month Details Modal -->
  <div class="month-details-modal" id="monthDetailsModal">
   <div class="month-details-content">
    <div class="month-details-header" id="monthDetailsTitle">
     Month Details
    </div>
    <div class="month-details-stats">
     <div class="month-detail-stat">
      <div class="month-detail-stat-value" id="monthDetailPnl">
       $0.00
      </div>
      <div class="month-detail-stat-label" data-lang="total-pl">
       Total P/L
      </div>
     </div>
     <div class="month-detail-stat">
      <div class="month-detail-stat-value neutral" id="monthDetailTrades">
       0
      </div>
      <div class="month-detail-stat-label" data-lang="total-trades">
       Total Trades
      </div>
     </div>
     <div class="month-detail-stat">
      <div class="month-detail-stat-value" id="monthDetailWinRate">
       0%
      </div>
      <div class="month-detail-stat-label" data-lang="win-rate">
       Win Rate
      </div>
     </div>
    </div>
    <div style="margin-bottom: 16px;">
     <button class="btn btn-primary" data-lang="view-full-month" onclick="navigateToMonth()" style="width: 100%;">
      View Full Month Calendar
     </button>
    </div>
    <div style="display: flex; justify-content: center;">
     <button class="btn btn-secondary" data-lang="close" onclick="closeMonthDetails()">
      Close
     </button>
    </div>
   </div>
  </div>
  <!-- Week Details Modal -->
  <div class="month-details-modal" id="weekDetailsModal">
   <div class="month-details-content">
    <div class="month-details-header" id="weekDetailsTitle">
     Week Details
    </div>
    <div class="month-details-stats">
     <div class="month-detail-stat">
      <div class="month-detail-stat-value" id="weekDetailPnl">
       $0.00
      </div>
      <div class="month-detail-stat-label" data-lang="total-pl">
       Total P/L
      </div>
     </div>
     <div class="month-detail-stat">
      <div class="month-detail-stat-value neutral" id="weekDetailTrades">
       0
      </div>
      <div class="month-detail-stat-label" data-lang="total-trades">
       Total Trades
      </div>
     </div>
     <div class="month-detail-stat">
      <div class="month-detail-stat-value" id="weekDetailWinRate">
       0%
      </div>
      <div class="month-detail-stat-label" data-lang="win-rate">
       Win Rate
      </div>
     </div>
    </div>
    <div style="max-height: 200px; overflow-y: auto; margin-bottom: 16px;">
     <div id="weekTradesList">
     </div>
    </div>
    <div style="display: flex; justify-content: center;">
     <button class="btn btn-secondary" data-lang="close" onclick="closeWeekDetails()">
      Close
     </button>
    </div>
   </div>
  </div>
  <div class="app-container">
   <!-- Sidebar -->
   <nav class="sidebar" id="sidebar">
    <div class="sidebar-header">
     <div class="sidebar-brand">
      <div class="sidebar-title">
       TradingPro
      </div>
      <div class="sidebar-subtitle">
       Advanced Trading Journal
      </div>
     </div>
    </div>
    <div class="nav-menu">
     <button class="nav-item active" onclick="showPage('dashboard')">
      <span class="nav-item-icon">
       üìä
      </span>
      <span data-lang="dashboard">
       Dashboard
      </span>
     </button>
     <button class="nav-item" onclick="showPage('calendar')">
      <span class="nav-item-icon">
       üìÖ
      </span>
      <span data-lang="calendar">
       Calendar View
      </span>
     </button>
     <button class="nav-item" onclick="showPage('analysis')">
      <span class="nav-item-icon">
       üìà
      </span>
      <span data-lang="analytics">
       Analytics
      </span>
     </button>
     <button class="nav-item" onclick="showPage('psychology')">
      <span class="nav-item-icon">
       üß†
      </span>
      <span data-lang="psychology">
       Psychology
      </span>
     </button>
     <button class="nav-item" onclick="showPage('notes')">
      <span class="nav-item-icon">
       üìù
      </span>
      <span data-lang="notes">
       Notes
      </span>
     </button>
     <button class="nav-item" onclick="showPage('trades')">
      <span class="nav-item-icon">
       üìã
      </span>
      <span data-lang="tradelist">
       Trade List
      </span>
     </button>
     <button class="nav-item" onclick="showPage('settings')">
      <span class="nav-item-icon">
       ‚öôÔ∏è
      </span>
      <span data-lang="settings">
       Settings
      </span>
     </button>
    </div>
   </nav>
   <!-- Main content -->
   <main class="main-content" id="mainContent">
    <!-- Dashboard page -->
    <div class="page active" id="dashboard">
     <div class="page-header">
      <div>
       <h1 class="page-title" data-lang="dashboard-title">
        Trading Dashboard
       </h1>
       <p class="page-subtitle" data-lang="dashboard-subtitle">
        Track your trades and performance
       </p>
      </div>
      <div class="page-header-info">
       <div class="date-range-selector">
        <input class="date-range-input" id="dashboardStartDate" type="date"/>
        <span style="color: #64748b;">
         to
        </span>
        <input class="date-range-input" id="dashboardEndDate" type="date"/>
        <button class="btn btn-secondary" onclick="clearDashboardRange()" style="padding: 4px 8px; font-size: 12px;">
         Clear
        </button>
       </div>
       <div class="date-navigation">
        <button class="date-nav-btn" onclick="changeTradingDate(-1)" title="Previous day">
         &larr;
        </button>
        <div class="current-date-display" id="currentDateDisplay" onclick="openDatePicker()">
        </div>
        <button class="date-nav-btn" onclick="changeTradingDate(1)" title="Next day">
         &rarr;
        </button>
       </div>
       <div class="dashboard-tabs">
        <button class="dashboard-tab active" data-lang="trading-record" onclick="showDashboardSection('trading')">
         Í±∞Îûò Í∏∞Î°ù
        </button>
        <button class="dashboard-tab" data-lang="position-calculator" onclick="showDashboardSection('position-calc')">
         Position Calculator
        </button>
       </div>
      </div>
     </div>
     <div class="stats-overview">
      <div class="stat-item">
       <h3 data-lang="total-pl">
        Total P/L
       </h3>
       <div class="stat-value" id="totalPL">
        $0.00
       </div>
       <div class="stat-subtitle" data-lang="net-result">
        Net Result
       </div>
      </div>
      <div class="stat-item">
       <h3 data-lang="trades">
        Trades
       </h3>
       <div class="stat-value neutral" id="totalTrades">
        0
       </div>
       <div class="stat-subtitle" data-lang="total-count">
        Total Count
       </div>
      </div>
      <div class="stat-item">
       <h3 data-lang="win-rate">
        Win Rate
       </h3>
       <div class="stat-value" id="winRate">
        0%
       </div>
       <div class="stat-subtitle" id="winLossCount">
        0W / 0L
       </div>
      </div>
     </div>
     <!-- Position Calculator Section -->
     <div class="position-calculator-section" id="positionCalculatorSection">
      <div class="calculator-main-grid">
       <div class="stats-sidebar">
        <div class="sidebar-title-stats" data-lang="position-analysis">
         Position Analysis
        </div>
        <div class="sidebar-stat">
         <span class="sidebar-stat-label" data-lang="recommended-size">
          Recommended Size
         </span>
         <span class="sidebar-stat-value positive" id="recommendedSize">
          $0
         </span>
        </div>
        <div class="sidebar-stat">
         <span class="sidebar-stat-label" data-lang="account-utilization">
          Account Utilization
         </span>
         <span class="sidebar-stat-value neutral" id="accountUtil">
          0%
         </span>
        </div>
        <div class="sidebar-stat">
         <span class="sidebar-stat-label" data-lang="expected-value">
          Expected Value
         </span>
         <span class="sidebar-stat-value" id="expectedVal">
          $0
         </span>
        </div>
        <div style="margin-top: 20px; padding-top: 16px; border-top: 1px solid #334155;">
         <div class="sidebar-title-stats" data-lang="auto-analysis" style="font-size: 14px;">
          ÏûêÎèô Î∂ÑÏÑù
         </div>
         <div class="sidebar-stat">
          <span class="sidebar-stat-label" data-lang="position-size">
           Ìè¨ÏßÄÏÖò ÌÅ¨Í∏∞
          </span>
          <span class="sidebar-stat-value positive" id="riskPositionSizeSidebar">
           $0
          </span>
         </div>
         <div class="sidebar-stat">
          <span class="sidebar-stat-label" data-lang="shares-quantity">
           Ï£ºÏãù ÏàòÎüâ
          </span>
          <span class="sidebar-stat-value neutral" id="riskSharesQuantitySidebar">
           0
          </span>
         </div>
         <div class="sidebar-stat">
          <span class="sidebar-stat-label" data-lang="risk-per-share">
           Ï£ºÎãπ Î¶¨Ïä§ÌÅ¨
          </span>
          <span class="sidebar-stat-value neutral" id="riskPerShareSidebar">
           $0.00
          </span>
         </div>
         <div class="sidebar-stat">
          <span class="sidebar-stat-label" data-lang="max-loss">
           ÏµúÎåÄ ÏÜêÏã§
          </span>
          <span class="sidebar-stat-value negative" id="riskMaxLossSidebar">
           $0.00
          </span>
         </div>
         <div class="sidebar-stat">
          <span class="sidebar-stat-label" data-lang="position-cost">
           Ìè¨ÏßÄÏÖò ÎπÑÏö©
          </span>
          <span class="sidebar-stat-value neutral" id="riskPositionCostSidebar">
           $0.00
          </span>
         </div>
        </div>
       </div>
       <div class="calculator-container">
        <!-- Calculator Tabs -->
        <div style="display: flex; background: #0f172a; border: 1px solid #334155; border-radius: 8px; overflow: hidden; margin-bottom: 20px;">
         <button class="position-calc-tab active" data-lang="kelly-calculator" onclick="showCalculatorTab('kelly')" style="background: #3b82f6; border: none; color: white; padding: 12px 20px; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.2s ease; border-right: 1px solid #334155; flex: 1;">
          Kelly Calculator
         </button>
         <button class="position-calc-tab" data-lang="risk-calculator" onclick="showCalculatorTab('risk')" style="background: transparent; border: none; color: #94a3b8; padding: 12px 20px; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.2s ease; flex: 1;">
          Risk Calculator
         </button>
        </div>
        <!-- Kelly Calculator Content -->
        <div class="calculator-content" id="kellyCalculator">
         <h2 class="calculator-title" data-lang="kelly-criterion-calculator">
          Kelly Criterion Calculator
         </h2>
         <div class="calc-grid">
          <div class="calc-input-group">
           <label class="calc-label" data-lang="account-balance">
            Í≥ÑÏ¢å ÏûîÍ≥† ($)
           </label>
           <input class="calc-input" id="calcAccountBalance" oninput="calculatePosition()" type="number" value=""/>
          </div>
          <div class="calc-input-group">
           <label class="calc-label" data-lang="win-rate-input">
            ÏäπÎ•† (%)
           </label>
           <input class="calc-input" id="calcWinRate" max="100" min="0" oninput="calculatePosition()" type="number" value=""/>
          </div>
          <div class="calc-input-group">
           <label class="calc-label" data-lang="average-win">
            ÌèâÍ∑† ÏàòÏùµ ($)
           </label>
           <input class="calc-input" id="calcAvgWin" oninput="calculatePosition()" type="number" value=""/>
          </div>
          <div class="calc-input-group">
           <label class="calc-label" data-lang="average-loss">
            ÌèâÍ∑† ÏÜêÏã§ ($)
           </label>
           <input class="calc-input" id="calcAvgLoss" oninput="calculatePosition()" type="number" value=""/>
          </div>
         </div>
         <div class="calc-input-group">
          <button class="btn btn-secondary" data-lang="auto-load-trade-data" onclick="autoLoadTradeData()" style="width: 100%;">
           Auto Load from Trade History
          </button>
         </div>
         <div class="kelly-options">
          <div class="kelly-options-title" data-lang="kelly-strategies">
           Position Sizing Strategy
          </div>
          <div class="kelly-option selected" data-multiplier="0.1" onclick="selectKellyMultiplier(this)">
           <div class="kelly-option-label" data-lang="ultra-safe">
            Ultra Safe
           </div>
           <div class="kelly-option-value">
            10% Kelly
           </div>
          </div>
          <div class="kelly-option" data-multiplier="0.25" onclick="selectKellyMultiplier(this)">
           <div class="kelly-option-label" data-lang="conservative">
            Conservative
           </div>
           <div class="kelly-option-value">
            25% Kelly
           </div>
          </div>
          <div class="kelly-option" data-multiplier="0.5" onclick="selectKellyMultiplier(this)">
           <div class="kelly-option-label" data-lang="moderate">
            Moderate
           </div>
           <div class="kelly-option-value">
            50% Kelly
           </div>
          </div>
         </div>
        </div>
        <!-- Risk Calculator Content -->
        <div class="calculator-content" id="riskCalculator" style="display: none;">
         <h2 class="calculator-title" data-lang="risk-management-calculator">
          Risk Management Calculator
         </h2>
         <div class="calc-grid">
          <div class="calc-input-group">
           <label class="calc-label" data-lang="account-balance">
            Í≥ÑÏ¢å ÏûîÍ≥† ($)
           </label>
           <input class="calc-input" id="riskAccountBalance" oninput="calculateRiskPosition()" type="number" value=""/>
          </div>
          <div class="calc-input-group">
           <label class="calc-label" data-lang="risk-percentage">
            Î¶¨Ïä§ÌÅ¨ ÎπÑÏú® (%)
           </label>
           <input class="calc-input" id="riskPercentage" max="10" min="0.1" oninput="calculateRiskPosition()" step="1" type="number" value=""/>
          </div>
          <div class="calc-input-group">
           <label class="calc-label" data-lang="entry-price">
            ÏßÑÏûÖ Í∞ÄÍ≤© ($)
           </label>
           <input class="calc-input" id="riskEntryPrice" oninput="calculateRiskPosition()" step="0.01" type="number" value=""/>
          </div>
          <div class="calc-input-group">
           <label class="calc-label" data-lang="stop-loss-price">
            ÏÜêÏ†à Í∞ÄÍ≤© ($)
           </label>
           <input class="calc-input" id="riskStopPrice" oninput="calculateRiskPosition()" step="0.01" type="number" value=""/>
          </div>
         </div>
         <div class="risk-preset-section">
          <div class="risk-preset-title">
           Î¶¨Ïä§ÌÅ¨ ÎπÑÏú®
          </div>
          <div class="risk-preset-buttons" style="gap: 4px;">
           <button class="risk-preset-btn" onclick="setRiskPreset(1)" style="background: #374151 !important; border: 1px solid #4b5563 !important; color: #e4e4e7 !important; padding: 8px 16px !important; border-radius: 6px !important; cursor: pointer !important; font-size: 13px !important; font-weight: 500 !important; transition: all 0.2s ease !important; min-width: 60px !important;">
            1%
           </button>
           <button class="risk-preset-btn active" onclick="setRiskPreset(2)" style="background: #3b82f6 !important; border: 1px solid #3b82f6 !important; color: white !important; padding: 8px 16px !important; border-radius: 6px !important; cursor: pointer !important; font-size: 13px !important; font-weight: 500 !important; transition: all 0.2s ease !important; min-width: 60px !important;">
            2%
           </button>
           <button class="risk-preset-btn" onclick="setRiskPreset(3)" style="background: #374151 !important; border: 1px solid #4b5563 !important; color: #e4e4e7 !important; padding: 8px 16px !important; border-radius: 6px !important; cursor: pointer !important; font-size: 13px !important; font-weight: 500 !important; transition: all 0.2s ease !important; min-width: 60px !important;">
            3%
           </button>
           <button class="risk-preset-btn" onclick="setRiskPreset(5)" style="background: #374151 !important; border: 1px solid #4b5563 !important; color: #e4e4e7 !important; padding: 8px 16px !important; border-radius: 6px !important; cursor: pointer !important; font-size: 13px !important; font-weight: 500 !important; transition: all 0.2s ease !important; min-width: 60px !important;">
            5%
           </button>
          </div>
         </div>
         <div class="calc-results">
          <div class="calc-result-item">
           <span class="calc-result-label" data-lang="position-size">
            Position Size
           </span>
           <span class="calc-result-value positive" id="riskPositionSize">
            $0
           </span>
          </div>
          <div class="calc-result-item">
           <span class="calc-result-label" data-lang="shares-quantity">
            Shares Quantity
           </span>
           <span class="calc-result-value neutral" id="riskSharesQuantity">
            0
           </span>
          </div>
          <div class="calc-result-item">
           <span class="calc-result-label" data-lang="risk-per-share">
            Risk per Share
           </span>
           <span class="calc-result-value neutral" id="riskPerShare">
            $0.00
           </span>
          </div>
          <div class="calc-result-item">
           <span class="calc-result-label" data-lang="max-loss">
            Max Loss
           </span>
           <span class="calc-result-value negative" id="riskMaxLoss">
            $0.00
           </span>
          </div>
          <div class="calc-result-item">
           <span class="calc-result-label" data-lang="position-cost">
            Position Cost
           </span>
           <span class="calc-result-value neutral" id="riskPositionCost">
            $0.00
           </span>
          </div>
          <div class="calc-result-item">
           <span class="calc-result-label" data-lang="account-utilization">
            Account Utilization
           </span>
           <span class="calc-result-value neutral" id="riskAccountUtil">
            0.00%
           </span>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <div class="dashboard-grid">
      <div class="trade-entry">
       <h2 data-lang="record-trade">
        Record Trade
       </h2>
       <form id="tradeForm">
        <div class="form-grid">
         <div class="form-group">
          <label data-lang="symbol">
           Symbol
          </label>
          <input id="symbol" placeholder="AAPL" required="" type="text"/>
         </div>
         <div class="form-group">
          <label data-lang="shares">
           Shares
          </label>
          <input id="shares" oninput="calculatePnL()" placeholder="100" required="" type="number"/>
         </div>
         <div class="form-group">
          <label data-lang="buy-price">
           Buy Price
          </label>
          <input id="buyPrice" oninput="calculatePnL()" placeholder="150.25" required="" step="0.0001" type="number"/>
         </div>
         <div class="form-group">
          <label data-lang="sell-price">
           Sell Price
          </label>
          <input id="sellPrice" oninput="calculatePnL()" placeholder="155.50" required="" step="0.0001" type="number"/>
         </div>
         <div class="form-group">
          <label data-lang="return-pct">
           Return %
          </label>
          <input id="returnPct" readonly="" style="background: #0f172a; color: #10b981;" type="text"/>
         </div>
         <div class="form-group">
          <label data-lang="pnl">
           P&amp;L
          </label>
          <input id="pnlDisplay" readonly="" style="background: #0f172a; color: #10b981;" type="text"/>
         </div>
         <div class="form-group">
          <label data-lang="entry-time">
           Entry Time
          </label>
          <div class="time-input-container">
           <input id="entryTime" type="time" value=""/>
           <button class="time-edit-btn" data-lang="edit" onclick="toggleTimeEdit()" type="button">
            Edit
           </button>
          </div>
         </div>
         <div class="form-group">
          <label data-lang="exit-time">
           Exit Time
          </label>
          <input id="exitTime" onchange="calculateHoldingTime()" type="time" value=""/>
         </div>
         <div class="form-group">
          <label data-lang="holding-time">
           Holding Time
          </label>
          <input id="holdingTimeDisplay" readonly="" style="background: #0f172a; color: #64748b;" type="text"/>
         </div>
         <div class="form-group">
          <label data-lang="amount">
           Amount ($)
          </label>
          <input id="amountDisplay" readonly="" style="background: #0f172a; color: #94a3b8;" type="text"/>
         </div>
        </div>
        <div class="form-actions">
         <button class="btn btn-secondary" data-lang="reset" onclick="resetForm()" type="button">
          Reset
         </button>
         <button class="btn btn-primary" data-lang="add-trade" type="submit">
          Add Trade
         </button>
        </div>
       </form>
      </div>
      <div>
       <div class="stats-sidebar">
        <div class="sidebar-title-stats" data-lang="performance">
         Performance
        </div>
        <div class="sidebar-stat">
         <span class="sidebar-stat-label" data-lang="best-trade">
          Best Trade
         </span>
         <span class="sidebar-stat-value positive" id="bestTrade">
          $0.00
         </span>
        </div>
        <div class="sidebar-stat">
         <span class="sidebar-stat-label" data-lang="worst-trade">
          Worst Trade
         </span>
         <span class="sidebar-stat-value negative" id="worstTrade">
          $0.00
         </span>
        </div>
        <div class="sidebar-stat">
         <span class="sidebar-stat-label" data-lang="avg-win">
          Avg Win
         </span>
         <span class="sidebar-stat-value positive" id="avgWin">
          $0.00
         </span>
        </div>
        <div class="sidebar-stat">
         <span class="sidebar-stat-label" data-lang="avg-loss">
          Avg Loss
         </span>
         <span class="sidebar-stat-value negative" id="avgLoss">
          $0.00
         </span>
        </div>
        <div class="sidebar-stat">
         <span class="sidebar-stat-label" data-lang="total-invested">
          Total Invested
         </span>
         <span class="sidebar-stat-value neutral" id="totalVolume">
          $0.00
         </span>
        </div>
        <div class="sidebar-stat">
         <span class="sidebar-stat-label" data-lang="profit-factor">
          Profit Factor
         </span>
         <span class="sidebar-stat-value" id="profitFactorSidebar">
          0.00
         </span>
        </div>
       </div>
       <div class="daily-fees-section">
        <div class="daily-fees-title" data-lang="daily-fees">
         Daily Fees
        </div>
        <input class="daily-fees-input" id="dailyFees" onchange="saveDailyFees()" placeholder="0.00" step="0.01" type="number"/>
       </div>
      </div>
     </div>
     <div class="trades-section">
      <div class="trades-header">
       <h2 data-lang="trade-history">
        Trade History
       </h2>
       <div style="display: flex; gap: 12px; align-items: center;">
        <button class="btn btn-secondary" data-lang="delete-selected" id="deleteSelectedBtn" onclick="deleteSelectedTrades()" style="display: none; background: #dc2626; border-color: #dc2626;">
         Delete Selected
        </button>
        <div class="period-summary" id="periodSummary">
        </div>
       </div>
      </div>
      <table class="trades-table">
       <thead>
        <tr>
         <th style="width: 40px;">
          <input id="selectAllTrades" onchange="toggleAllTrades()" style="accent-color: #3b82f6;" type="checkbox"/>
         </th>
         <th data-lang="date">
          Date
         </th>
         <th data-lang="symbol">
          Symbol
         </th>
         <th data-lang="buy-price">
          Buy Price
         </th>
         <th data-lang="sell-price">
          Sell Price
         </th>
         <th data-lang="shares">
          Shares
         </th>
         <th data-lang="amount">
          Amount
         </th>
         <th data-lang="time">
          Time
         </th>
         <th data-lang="pnl">
          P&amp;L
         </th>
         <th data-lang="return-pct">
          Return %
         </th>
         <th data-lang="actions">
          Actions
         </th>
        </tr>
       </thead>
       <tbody id="tradesTableBody">
        <tr>
         <td colspan="10">
          <div class="empty-state">
           <div class="empty-state-icon">
            üìä
           </div>
           <div data-lang="no-trades">
            No trades recorded yet
           </div>
          </div>
         </td>
        </tr>
       </tbody>
      </table>
     </div>
    </div>
    <!-- Calendar page -->
    <div class="page" id="calendar">
     <div class="page-header">
      <div>
       <h1 class="page-title" data-lang="calendar-title">
        Calendar View
       </h1>
       <p class="page-subtitle" data-lang="calendar-subtitle">
        Visualize your trading performance over time
       </p>
      </div>
     </div>
     <div class="calendar-container">
      <div class="calendar-main-grid">
       <div class="calendar-left">
        <div class="calendar-controls">
         <div class="calendar-nav">
          <button onclick="changeMonth(-1)">
           &larr; Previous
          </button>
          <h2 class="calendar-title" id="calendarTitle">
           January 2024
          </h2>
          <button onclick="changeMonth(1)">
           Next &rarr;
          </button>
         </div>
         <button class="btn btn-secondary" data-lang="clear-selection" onclick="clearCalendarRange()" style="padding: 6px 12px; font-size: 12px;">
          Clear Selection
         </button>
        </div>
        <div class="calendar-selection-info" data-lang="calendar-help" id="calendarSelectionInfo">
         Click and drag on calendar to select date range, or click on a day to see details
        </div>
        <div class="calendar-stats-summary" id="calendarStatsSummary">
         <div class="calendar-stat-item">
          <div class="calendar-stat-label" data-lang="selected-period">
           Selected Period
          </div>
          <div class="calendar-stat-value neutral" id="calendarPeriodLabel">
           Current Month
          </div>
         </div>
         <div class="calendar-stat-item">
          <div class="calendar-stat-label" data-lang="total-trades">
           Total Trades
          </div>
          <div class="calendar-stat-value neutral" id="calendarTotalTrades">
           0
          </div>
         </div>
         <div class="calendar-stat-item">
          <div class="calendar-stat-label" data-lang="total-pl">
           Total P/L
          </div>
          <div class="calendar-stat-value" id="calendarTotalPL">
           $0.00
          </div>
         </div>
         <div class="calendar-stat-item">
          <div class="calendar-stat-label" data-lang="avg-daily-pl">
           Avg Daily P/L
          </div>
          <div class="calendar-stat-value" id="calendarAvgDaily">
           $0.00
          </div>
         </div>
         <div class="calendar-stat-item">
          <div class="calendar-stat-label" data-lang="best-day">
           Best Day
          </div>
          <div class="calendar-stat-value positive" id="calendarBestDay">
           $0.00
          </div>
         </div>
         <div class="calendar-stat-item">
          <div class="calendar-stat-label" data-lang="worst-day">
           Worst Day
          </div>
          <div class="calendar-stat-value negative" id="calendarWorstDay">
           $0.00
          </div>
         </div>
        </div>
        <div class="calendar-grid" id="calendarGrid">
         <div class="calendar-day-header">
          Sun
         </div>
         <div class="calendar-day-header">
          Mon
         </div>
         <div class="calendar-day-header">
          Tue
         </div>
         <div class="calendar-day-header">
          Wed
         </div>
         <div class="calendar-day-header">
          Thu
         </div>
         <div class="calendar-day-header">
          Fri
         </div>
         <div class="calendar-day-header">
          Sat
         </div>
         <div class="calendar-day-header" id="weekPnlHeader" style="display: none;">
          Week P/L
         </div>
        </div>
       </div>
       <!-- Right sidebar -->
       <div class="calendar-sidebar">
        <div class="sidebar-title-calendar" data-lang="weekly-summary">
         Weekly Summary
        </div>
        <div class="weekly-summary" id="weeklySummary">
         <div class="weekly-item">
          <span class="weekly-label" data-lang="selected-week">
           Selected Week
          </span>
          <span class="weekly-value neutral" id="selectedWeekLabel">
           -
          </span>
         </div>
         <div class="weekly-item">
          <span class="weekly-label" data-lang="week-trades">
           Week Trades
          </span>
          <span class="weekly-value neutral" id="selectedWeekTrades">
           0
          </span>
         </div>
         <div class="weekly-item">
          <span class="weekly-label" data-lang="week-pnl">
           Week P/L
          </span>
          <span class="weekly-value" id="selectedWeekPnl">
           $0.00
          </span>
         </div>
         <div class="weekly-item">
          <span class="weekly-label" data-lang="week-win-rate">
           Week Win Rate
          </span>
          <span class="weekly-value" id="selectedWeekWinRate">
           0%
          </span>
         </div>
         <div class="weekly-item">
          <span class="weekly-label" data-lang="week-best-day">
           Best Day
          </span>
          <span class="weekly-value positive" id="selectedWeekBestDay">
           $0.00
          </span>
         </div>
         <div class="weekly-item">
          <span class="weekly-label" data-lang="week-worst-day">
           Worst Day
          </span>
          <span class="weekly-value negative" id="selectedWeekWorstDay">
           $0.00
          </span>
         </div>
        </div>
        <!-- Day details section -->
        <div class="day-details" id="dayDetails" style="display: none;">
         <div class="day-details-title" id="dayDetailsTitle">
          Selected Day
         </div>
         <div id="dayTradesList">
          <!-- Individual trades for selected day -->
         </div>
        </div>
       </div>
      </div>
      <!-- Annual Heatmap moved here - below main calendar -->
      <div class="annual-heatmap-container">
       <div class="annual-heatmap-title" id="annualHeatmapTitle">
        2024 Trading Overview
       </div>
       <div class="annual-heatmap-grid" id="annualHeatmapGrid">
        <!-- Month heatmaps will be generated here -->
       </div>
      </div>
     </div>
    </div>
    <!-- Enhanced Analytics page -->
    <div class="page" id="analysis">
     <div class="analytics-container">
      <div class="analytics-header">
       <div class="analytics-title-section">
        <div class="analytics-tabs">
         <button class="analytics-tab active" data-lang="detail" onclick="showAnalyticsSection('detail')">
          Detail
         </button>
         <button class="analytics-tab" data-lang="charts" onclick="showAnalyticsSection('charts')">
          Charts
         </button>
        </div>
       </div>
       <div class="filter-controls">
        <div class="date-range-selector">
         <input class="date-range-input" id="analyticsStartDate" type="date"/>
         <span style="color: #64748b;">
          to
         </span>
         <input class="date-range-input" id="analyticsEndDate" type="date"/>
         <button class="btn btn-secondary" onclick="clearAnalyticsRange()" style="padding: 4px 8px; font-size: 12px;">
          Clear
         </button>
        </div>
        <button class="filter-btn active" data-lang="all-time" onclick="setAnalyticsPeriod('all')">
         All Time
        </button>
        <button class="filter-btn" data-lang="this-month" onclick="setAnalyticsPeriod('month')">
         This Month
        </button>
        <button class="filter-btn" data-lang="this-week" onclick="setAnalyticsPeriod('week')">
         This Week
        </button>
        <button class="filter-btn" data-lang="today" onclick="setAnalyticsPeriod('day')">
         Today
        </button>
       </div>
      </div>
      <!-- Performance Summary Cards -->
      <div class="performance-summary">
       <div class="performance-summary-title" data-lang="performance-summary">
        Performance Summary
       </div>
       <div class="summary-cards">
        <div class="summary-card">
         <div class="summary-card-value" id="summaryNetProfit">
          $0.00
         </div>
         <div class="summary-card-label" data-lang="net-profit">
          Net Profit
         </div>
        </div>
        <div class="summary-card">
         <div class="summary-card-value neutral" id="summaryTotalTrades">
          0
         </div>
         <div class="summary-card-label" data-lang="total-trades">
          Total Trades
         </div>
        </div>
        <div class="summary-card">
         <div class="summary-card-value" id="summaryWinRate">
          0%
         </div>
         <div class="summary-card-label" data-lang="win-rate">
          Win Rate
         </div>
        </div>
        <div class="summary-card">
         <div class="summary-card-value" id="summaryProfitFactor">
          0.00
         </div>
         <div class="summary-card-label" data-lang="profit-factor">
          Profit Factor
         </div>
        </div>
        <div class="summary-card">
         <div class="summary-card-value" id="summaryLargestWin">
          $0.00
         </div>
         <div class="summary-card-label" data-lang="largest-win">
          Largest Win
         </div>
        </div>
        <div class="summary-card">
         <div class="summary-card-value" id="summaryLargestLoss">
          $0.00
         </div>
         <div class="summary-card-label" data-lang="largest-loss">
          Largest Loss
         </div>
        </div>
       </div>
      </div>
      <!-- Detail Section -->
      <div class="detail-section active" id="detailSection">
       <div class="detail-grid">
        <!-- Trading Performance -->
        <div class="detail-card">
         <div class="detail-card-header" data-lang="trading-performance" onclick="toggleDetailCard(this)">
          Trading Performance
          <span class="collapse-icon">
           ‚ñº
          </span>
         </div>
         <div class="detail-card-content">
          <div class="detail-item">
           <span class="detail-label" data-lang="total-pl">
            Total P&amp;L
           </span>
           <span class="detail-value" id="detailTotalPL">
            $0.00
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="total-gain">
            Total Gain
           </span>
           <span class="detail-value positive" id="detailTotalGain">
            $0.00
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="total-loss">
            Total Loss
           </span>
           <span class="detail-value negative" id="detailTotalLoss">
            $0.00
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="total-fees">
            Total Fees
           </span>
           <span class="detail-value neutral" id="detailTotalFees">
            $0.00
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="total-volume">
            Total Volume
           </span>
           <span class="detail-value neutral" id="detailTotalVolume">
            $0.00
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="profit-factor">
            Profit Factor
           </span>
           <span class="detail-value" id="detailProfitFactor">
            0.00
           </span>
          </div>
         </div>
        </div>
        <!-- Win/Loss Statistics -->
        <div class="detail-card">
         <div class="detail-card-header" data-lang="win-loss-stats" onclick="toggleDetailCard(this)">
          Win/Loss Statistics
          <span class="collapse-icon">
           ‚ñº
          </span>
         </div>
         <div class="detail-card-content">
          <div class="detail-item">
           <span class="detail-label" data-lang="winning-trades">
            Winning Trades
           </span>
           <span class="detail-value positive" id="detailWinningTrades">
            0 (0%)
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="losing-trades">
            Losing Trades
           </span>
           <span class="detail-value negative" id="detailLosingTrades">
            0 (0%)
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="avg-winning-trade">
            Avg Winning Trade
           </span>
           <span class="detail-value positive" id="detailAvgWinningTrade">
            $0.00
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="avg-losing-trade">
            Avg Losing Trade
           </span>
           <span class="detail-value negative" id="detailAvgLosingTrade">
            $0.00
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="largest-win">
            Largest Win
           </span>
           <span class="detail-value positive" id="detailLargestWin">
            $0.00
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="largest-loss">
            Largest Loss
           </span>
           <span class="detail-value negative" id="detailLargestLoss">
            $0.00
           </span>
          </div>
         </div>
        </div>
        <!-- Daily Performance -->
        <div class="detail-card">
         <div class="detail-card-header" data-lang="daily-performance" onclick="toggleDetailCard(this)">
          Daily Performance
          <span class="collapse-icon">
           ‚ñº
          </span>
         </div>
         <div class="detail-card-content">
          <div class="detail-item">
           <span class="detail-label" data-lang="daily-per-win">
            Daily P&amp;L per Win
           </span>
           <span class="detail-value positive" id="detailDailyPerWin">
            $0.00
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="daily-per-loss">
            Daily P&amp;L per Loss
           </span>
           <span class="detail-value negative" id="detailDailyPerLoss">
            $0.00
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="daily-per-fees">
            Daily Fees per Day
           </span>
           <span class="detail-value neutral" id="detailDailyPerFees">
            $0.00
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="best-trading-day">
            Best Trading Day
           </span>
           <span class="detail-value positive" id="detailBestTradingDay">
            $0.00
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="worst-trading-day">
            Worst Trading Day
           </span>
           <span class="detail-value negative" id="detailWorstTradingDay">
            $0.00
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="avg-daily-pl">
            Avg Daily P&amp;L
           </span>
           <span class="detail-value" id="detailAvgDailyPL">
            $0.00
           </span>
          </div>
         </div>
        </div>
        <!-- Time Analysis -->
        <div class="detail-card">
         <div class="detail-card-header" data-lang="time-analysis" onclick="toggleDetailCard(this)">
          Time Analysis
          <span class="collapse-icon">
           ‚ñº
          </span>
         </div>
         <div class="detail-card-content">
          <div class="detail-item">
           <span class="detail-label" data-lang="avg-hold-time">
            Avg Hold Time
           </span>
           <span class="detail-value neutral" id="detailAvgHoldTime">
            0m
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="shortest-hold">
            Shortest Hold
           </span>
           <span class="detail-value neutral" id="detailShortestHold">
            0m
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="longest-hold">
            Longest Hold
           </span>
           <span class="detail-value neutral" id="detailLongestHold">
            0m
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="best-trading-hour">
            Best Trading Hour
           </span>
           <span class="detail-value" id="detailBestHour">
            -
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="worst-trading-hour">
            Worst Trading Hour
           </span>
           <span class="detail-value" id="detailWorstHour">
            -
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="best-day-week">
            Best Day of Week
           </span>
           <span class="detail-value" id="detailBestDayOfWeek">
            -
           </span>
          </div>
         </div>
        </div>
        <!-- Trading Activity -->
        <div class="detail-card">
         <div class="detail-card-header" data-lang="trading-activity" onclick="toggleDetailCard(this)">
          Trading Activity
          <span class="collapse-icon">
           ‚ñº
          </span>
         </div>
         <div class="detail-card-content">
          <div class="detail-item">
           <span class="detail-label" data-lang="trading-days">
            Trading Days
           </span>
           <span class="detail-value neutral" id="detailTradingDays">
            0
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="avg-trades-per-day">
            Avg Trades per Day
           </span>
           <span class="detail-value neutral" id="detailAvgTradesPerDay">
            0.00
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="max-trades-day">
            Max Trades in Day
           </span>
           <span class="detail-value neutral" id="detailMaxTradesDay">
            0
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="avg-position-size">
            Avg Position Size
           </span>
           <span class="detail-value neutral" id="detailAvgPositionSize">
            $0
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="largest-position">
            Largest Position
           </span>
           <span class="detail-value neutral" id="detailLargestPosition">
            $0
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="smallest-position">
            Smallest Position
           </span>
           <span class="detail-value neutral" id="detailSmallestPosition">
            $0
           </span>
          </div>
         </div>
        </div>
        <!-- Streak Analysis -->
        <div class="detail-card">
         <div class="detail-card-header" data-lang="streak-analysis" onclick="toggleDetailCard(this)">
          Streak Analysis
          <span class="collapse-icon">
           ‚ñº
          </span>
         </div>
         <div class="detail-card-content">
          <div class="detail-item">
           <span class="detail-label" data-lang="current-streak">
            Current Streak
           </span>
           <span class="detail-value" id="detailCurrentStreak">
            0
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="max-win-streak">
            Max Win Streak
           </span>
           <span class="detail-value positive" id="detailMaxWinStreak">
            0
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="max-loss-streak">
            Max Loss Streak
           </span>
           <span class="detail-value negative" id="detailMaxLossStreak">
            0
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="current-win-streak">
            Current Win Streak
           </span>
           <span class="detail-value" id="detailCurrentWinStreak">
            0
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="current-loss-streak">
            Current Loss Streak
           </span>
           <span class="detail-value" id="detailCurrentLossStreak">
            0
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="avg-win-streak">
            Avg Win Streak
           </span>
           <span class="detail-value" id="detailAvgWinStreak">
            0.00
           </span>
          </div>
         </div>
        </div>
        <!-- Symbol Performance -->
        <div class="detail-card">
         <div class="detail-card-header" data-lang="symbol-performance" onclick="toggleDetailCard(this)">
          Symbol Performance
          <span class="collapse-icon">
           ‚ñº
          </span>
         </div>
         <div class="detail-card-content">
          <div class="detail-item">
           <span class="detail-label" data-lang="most-profitable-symbol">
            Most Profitable
           </span>
           <span class="detail-value" id="detailMostProfitableSymbol">
            -
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="least-profitable-symbol">
            Least Profitable
           </span>
           <span class="detail-value" id="detailLeastProfitableSymbol">
            -
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="most-traded-symbol">
            Most Traded
           </span>
           <span class="detail-value" id="detailMostTradedSymbol">
            -
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="unique-symbols">
            Unique Symbols
           </span>
           <span class="detail-value neutral" id="detailUniqueSymbols">
            0
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="symbol-win-rate">
            Best Symbol Win Rate
           </span>
           <span class="detail-value" id="detailBestSymbolWinRate">
            0%
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="symbol-avg-return">
            Best Symbol Avg Return
           </span>
           <span class="detail-value" id="detailBestSymbolReturn">
            0%
           </span>
          </div>
         </div>
        </div>
        <!-- Risk Management -->
        <div class="detail-card">
         <div class="detail-card-header" data-lang="risk-management" onclick="toggleDetailCard(this)">
          Risk Management
          <span class="collapse-icon">
           ‚ñº
          </span>
         </div>
         <div class="detail-card-content">
          <div class="detail-item">
           <span class="detail-label" data-lang="max-drawdown">
            Max Drawdown
           </span>
           <span class="detail-value negative" id="detailMaxDrawdown">
            $0.00
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="current-drawdown">
            Current Drawdown
           </span>
           <span class="detail-value" id="detailCurrentDrawdown">
            $0.00
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="recovery-factor">
            Recovery Factor
           </span>
           <span class="detail-value" id="detailRecoveryFactor">
            0.00
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="max-daily-loss">
            Max Daily Loss
           </span>
           <span class="detail-value negative" id="detailMaxDailyLoss">
            $0.00
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="max-daily-gain">
            Max Daily Gain
           </span>
           <span class="detail-value positive" id="detailMaxDailyGain">
            $0.00
           </span>
          </div>
          <div class="detail-item">
           <span class="detail-label" data-lang="risk-reward-ratio">
            Avg Risk/Reward
           </span>
           <span class="detail-value" id="detailRiskRewardRatio">
            0.00
           </span>
          </div>
         </div>
        </div>
       </div>
       <!-- Basic Charts Section in Detail -->
       <div class="basic-charts-section">
        <div class="basic-charts-title" data-lang="basic-charts">
         Basic Performance Charts
        </div>
        <div class="basic-charts-grid">
         <div class="basic-chart-card">
          <div class="basic-chart-header" data-lang="cumulative-pl">
           Cumulative P&amp;L
          </div>
          <div class="basic-chart-content">
           <canvas class="chart-canvas" id="basicCumulativePLChart">
           </canvas>
          </div>
         </div>
         <div class="basic-chart-card">
          <div class="basic-chart-header" data-lang="win-loss-ratio">
           Win/Loss Distribution
          </div>
          <div class="basic-chart-content">
           <canvas class="chart-canvas" id="basicWinLossChart">
           </canvas>
          </div>
         </div>
         <div class="basic-chart-card">
          <div class="basic-chart-header" data-lang="daily-pl">
           Daily P&amp;L
          </div>
          <div class="basic-chart-content">
           <canvas class="chart-canvas" id="basicDailyPLChart">
           </canvas>
          </div>
         </div>
         <div class="basic-chart-card">
          <div class="basic-chart-header" data-lang="monthly-performance">
           Monthly Performance
          </div>
          <div class="basic-chart-content">
           <canvas class="chart-canvas" id="basicMonthlyChart">
           </canvas>
          </div>
         </div>
        </div>
       </div>
      </div>
      <!-- Advanced Charts Section -->
      <div class="chart-section" id="chartSection">
       <div class="advanced-charts-grid">
        <div class="chart-container">
         <div class="chart-header" data-lang="equity-curve">
          Equity Curve
         </div>
         <div class="chart-content">
          <canvas class="chart-canvas" id="equityCurveChart">
          </canvas>
         </div>
        </div>
        <div class="chart-container">
         <div class="chart-header" data-lang="drawdown-chart">
          Drawdown Analysis
         </div>
         <div class="chart-content">
          <canvas class="chart-canvas" id="drawdownChart">
          </canvas>
         </div>
        </div>
        <div class="chart-container">
         <div class="chart-header" data-lang="symbol-performance-chart">
          Symbol Performance
         </div>
         <div class="chart-content">
          <canvas class="chart-canvas" id="symbolPerformanceChart">
          </canvas>
         </div>
        </div>
        <div class="chart-container">
         <div class="chart-header" data-lang="time-distribution">
          Time Distribution
         </div>
         <div class="chart-content">
          <canvas class="chart-canvas" id="timeDistributionChart">
          </canvas>
         </div>
        </div>
        <div class="chart-container">
         <div class="chart-header" data-lang="return-distribution">
          Return Distribution
         </div>
         <div class="chart-content">
          <canvas class="chart-canvas" id="returnDistributionChart">
          </canvas>
         </div>
        </div>
        <div class="chart-container">
         <div class="chart-header" data-lang="volume-analysis">
          Volume Analysis
         </div>
         <div class="chart-content">
          <canvas class="chart-canvas" id="volumeAnalysisChart">
          </canvas>
         </div>
        </div>
        <div class="chart-container">
         <div class="chart-header" data-lang="correlation-matrix">
          Performance Correlation
         </div>
         <div class="chart-content">
          <canvas class="chart-canvas" id="correlationMatrixChart">
          </canvas>
         </div>
        </div>
        <div class="chart-container">
         <div class="chart-header" data-lang="performance-attribution">
          Performance Attribution
         </div>
         <div class="chart-content">
          <canvas class="chart-canvas" id="performanceAttributionChart">
          </canvas>
         </div>
        </div>
        <div class="chart-container">
         <div class="chart-header" data-lang="trade-duration-analysis">
          Trade Duration Analysis
         </div>
         <div class="chart-content">
          <canvas class="chart-canvas" id="tradeDurationAnalysisChart">
          </canvas>
         </div>
        </div>
        <div class="chart-container">
         <div class="chart-header" data-lang="win-rate-by-time">
          Win Rate by Time
         </div>
         <div class="chart-content">
          <canvas class="chart-canvas" id="winRateByTimeChart">
          </canvas>
         </div>
        </div>
        <div class="chart-container">
         <div class="chart-header" data-lang="position-sizing-analysis">
          Position Sizing Analysis
         </div>
         <div class="chart-content">
          <canvas class="chart-canvas" id="positionSizingAnalysisChart">
          </canvas>
         </div>
        </div>
        <div class="chart-container">
         <div class="chart-header" data-lang="trading-efficiency-metrics">
          Trading Efficiency Metrics
         </div>
         <div class="chart-content">
          <canvas class="chart-canvas" id="tradingEfficiencyMetricsChart">
          </canvas>
         </div>
        </div>
       </div>
      </div>
     </div>
    </div>
    <!-- Psychology page -->
    <div class="page" id="psychology">
     <div class="page-header">
      <div>
       <h1 class="page-title" data-lang="psychology-title">
        Trading Psychology Analytics
       </h1>
       <p class="page-subtitle" data-lang="psychology-subtitle">
        Quantified psychological performance analysis
       </p>
      </div>
      <div class="psychology-controls">
       <div class="psychology-tabs">
        <button class="psychology-tab active" data-lang="daily-input" onclick="showPsychologySection('input')">
         Daily Input
        </button>
        <button class="psychology-tab" data-lang="metrics-dashboard" onclick="showPsychologySection('metrics')">
         Metrics Dashboard
        </button>
        <button class="psychology-tab" data-lang="bias-analysis" onclick="showPsychologySection('bias-analysis')">
         Bias Analysis
        </button>
        <button class="psychology-tab" data-lang="pattern-insights" onclick="showPsychologySection('patterns')">
         Pattern Insights
        </button>
       </div>
      </div>
     </div>
     <!-- Daily Input Section -->
     <div class="psychology-section active" id="psychologyInputSection">
      <div class="psychology-container">
       <h2 class="psychology-header" data-lang="daily-data-input">
        Daily Data Input
       </h2>
       <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 24px; margin-bottom: 24px;">
        <!-- Biological Data -->
        <div style="background: #0f172a; border: 1px solid #334155; border-radius: 8px; padding: 20px;">
         <h3 data-lang="biological-data" style="color: #f8fafc; font-size: 16px; margin-bottom: 16px;">
          Biological Data
         </h3>
         <div style="margin-bottom: 16px;">
          <label data-lang="sleep-hours" style="display: block; color: #94a3b8; font-size: 12px; margin-bottom: 4px;">
           Sleep Hours
          </label>
          <input id="sleepHours" max="12" min="0" placeholder="7.5" step="0.5" style="width: 100%; background: #1e293b; border: 1px solid #334155; color: #e4e4e7; padding: 8px 10px; border-radius: 6px;" type="number"/>
         </div>
        </div>
        <!-- Trading Environment -->
        <div style="background: #0f172a; border: 1px solid #334155; border-radius: 8px; padding: 20px;">
         <h3 data-lang="trading-environment" style="color: #f8fafc; font-size: 16px; margin-bottom: 16px;">
          Trading Environment
         </h3>
         <div style="margin-bottom: 16px;">
          <label data-lang="start-time" style="display: block; color: #94a3b8; font-size: 12px; margin-bottom: 4px;">
           Start Time
          </label>
          <input id="startTime" style="width: 100%; background: #1e293b; border: 1px solid #334155; color: #e4e4e7; padding: 8px 10px; border-radius: 6px;" type="time"/>
         </div>
         <div style="margin-bottom: 16px;">
          <label data-lang="end-time" style="display: block; color: #94a3b8; font-size: 12px; margin-bottom: 4px;">
           End Time
          </label>
          <input id="endTime" style="width: 100%; background: #1e293b; border: 1px solid #334155; color: #e4e4e7; padding: 8px 10px; border-radius: 6px;" type="time"/>
         </div>
         <div>
          <label data-lang="environment-type" style="display: block; color: #94a3b8; font-size: 12px; margin-bottom: 4px;">
           Environment Type
          </label>
          <select id="environmentType" style="width: 100%; background: #1e293b; border: 1px solid #334155; color: #e4e4e7; padding: 8px 10px; border-radius: 6px;">
           <option value="home">
            Home
           </option>
           <option value="cafe">
            Cafe
           </option>
           <option value="office">
            Office
           </option>
           <option value="hotel">
            Hotel
           </option>
          </select>
         </div>
        </div>
        <!-- Economic Pressure -->
        <div style="background: #0f172a; border: 1px solid #334155; border-radius: 8px; padding: 20px;">
         <h3 data-lang="economic-pressure" style="color: #f8fafc; font-size: 16px; margin-bottom: 16px;">
          Economic Pressure
         </h3>
         <div style="margin-bottom: 16px;">
          <label data-lang="account-balance" style="display: block; color: #94a3b8; font-size: 12px; margin-bottom: 4px;">
           Account Balance ($)
          </label>
          <input id="accountBalance" min="0" oninput="updateTargetPercentages()" placeholder="10000" style="width: 100%; background: #1e293b; border: 1px solid #334155; color: #e4e4e7; padding: 8px 10px; border-radius: 6px;" type="number"/>
         </div>
         <div style="margin-bottom: 16px;">
          <label data-lang="daily-target" style="display: block; color: #94a3b8; font-size: 12px; margin-bottom: 4px;">
           Daily P&amp;L Target ($)
          </label>
          <div style="display: flex; gap: 8px; align-items: center;">
           <input id="dailyTarget" oninput="updateTargetPercentages()" placeholder="200" style="flex: 1; background: #1e293b; border: 1px solid #334155; color: #e4e4e7; padding: 8px 10px; border-radius: 6px;" type="number"/>
           <span id="dailyTargetPercent" style="color: #64748b; font-size: 12px; min-width: 40px;">
            0%
           </span>
          </div>
         </div>
         <div>
          <label data-lang="max-daily-loss" style="display: block; color: #94a3b8; font-size: 12px; margin-bottom: 4px;">
           Max Daily Loss ($)
          </label>
          <div style="display: flex; gap: 8px; align-items: center;">
           <input id="maxDailyLoss" oninput="updateTargetPercentages()" placeholder="500" style="flex: 1; background: #1e293b; border: 1px solid #334155; color: #e4e4e7; padding: 8px 10px; border-radius: 6px;" type="number"/>
           <span id="maxLossPercent" style="color: #64748b; font-size: 12px; min-width: 40px;">
            0%
           </span>
          </div>
         </div>
        </div>
        <!-- Emotional State -->
        <div style="background: #0f172a; border: 1px solid #334155; border-radius: 8px; padding: 20px;">
         <h3 data-lang="emotional-state" style="color: #f8fafc; font-size: 16px; margin-bottom: 16px;">
          Emotional State
         </h3>
         <div style="margin-bottom: 16px;">
          <label data-lang="stress-level" style="display: block; color: #94a3b8; font-size: 12px; margin-bottom: 4px;">
           Stress Level (1-5)
          </label>
          <input id="stressLevel" max="5" min="1" oninput="updateSliderDisplay('stressLevel', 'stressValue')" style="width: 100%; accent-color: #3b82f6;" type="range" value="3"/>
          <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 4px;">
           <span style="color: #64748b; font-size: 11px;">
            Low
           </span>
           <span id="stressValue" style="color: #e4e4e7; font-size: 12px; font-weight: 600;">
            3
           </span>
           <span style="color: #64748b; font-size: 11px;">
            High
           </span>
          </div>
         </div>
         <div style="margin-bottom: 16px;">
          <label data-lang="confidence-level" style="display: block; color: #94a3b8; font-size: 12px; margin-bottom: 4px;">
           Confidence Level (1-5)
          </label>
          <input id="confidenceLevel" max="5" min="1" oninput="updateSliderDisplay('confidenceLevel', 'confidenceValue')" style="width: 100%; accent-color: #3b82f6;" type="range" value="3"/>
          <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 4px;">
           <span style="color: #64748b; font-size: 11px;">
            Low
           </span>
           <span id="confidenceValue" style="color: #e4e4e7; font-size: 12px; font-weight: 600;">
            3
           </span>
           <span style="color: #64748b; font-size: 11px;">
            High
           </span>
          </div>
         </div>
         <div>
          <label data-lang="focus-level" style="display: block; color: #94a3b8; font-size: 12px; margin-bottom: 4px;">
           Focus Level (1-5)
          </label>
          <input id="focusLevel" max="5" min="1" oninput="updateSliderDisplay('focusLevel', 'focusValue')" style="width: 100%; accent-color: #3b82f6;" type="range" value="3"/>
          <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 4px;">
           <span style="color: #64748b; font-size: 11px;">
            Low
           </span>
           <span id="focusValue" style="color: #e4e4e7; font-size: 12px; font-weight: 600;">
            3
           </span>
           <span style="color: #64748b; font-size: 11px;">
            High
           </span>
          </div>
         </div>
        </div>
       </div>
       <!-- Action Buttons -->
       <div style="display: flex; gap: 12px; justify-content: center; margin-bottom: 24px;">
        <button class="psychology-save-btn" data-lang="save-psychology-data" onclick="savePsychologyData()">
         Save Psychology Data
        </button>
        <button class="psychology-save-btn" data-lang="calculate-score" onclick="calculateDailyScore()" style="background: #3b82f6;">
         Calculate Daily Score
        </button>
        <button class="psychology-save-btn" data-lang="reset-psychology-data" onclick="resetPsychologyData()" style="background: #ef4444;">
         Reset Data
        </button>
       </div>
       <!-- Enhanced Visual Dashboard -->
       <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 32px;">
        <!-- Sleep Performance Card -->
        <div style="background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border: 2px solid #334155; border-radius: 12px; padding: 20px; position: relative; overflow: hidden;">
         <div style="position: absolute; top: -50%; right: -50%; width: 100%; height: 100%; background: radial-gradient(circle, rgba(16, 185, 129, 0.1) 0%, transparent 70%); pointer-events: none;">
         </div>
         <div style="position: relative; z-index: 1;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
           <h3 data-lang="sleep-performance" style="color: #10b981; font-size: 16px; font-weight: 600;">
            Sleep Performance
           </h3>
           <div style="width: 40px; height: 40px; background: rgba(16, 185, 129, 0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
            <span style="font-size: 20px;">
             üõå
            </span>
           </div>
          </div>
          <div style="display: flex; align-items: baseline; gap: 8px; margin-bottom: 8px;">
           <span id="sleepHoursDisplay" style="font-size: 28px; font-weight: 700; color: #e4e4e7;">
            0
           </span>
           <span style="color: #94a3b8; font-size: 14px;">
            hours
           </span>
          </div>
          <div id="sleepQualityIndicator" style="height: 4px; background: #334155; border-radius: 2px; overflow: hidden;">
           <div id="sleepQualityBar" style="height: 100%; background: linear-gradient(90deg, #ef4444, #f59e0b, #10b981); width: 0%; transition: width 0.3s ease;">
           </div>
          </div>
          <div id="sleepStatus" style="color: #94a3b8; font-size: 12px; margin-top: 8px;">
           No data
          </div>
         </div>
        </div>
        <!-- Environment Card -->
        <div style="background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border: 2px solid #334155; border-radius: 12px; padding: 20px; position: relative; overflow: hidden;">
         <div style="position: absolute; top: -50%; right: -50%; width: 100%; height: 100%; background: radial-gradient(circle, rgba(59, 130, 246, 0.1) 0%, transparent 70%); pointer-events: none;">
         </div>
         <div style="position: relative; z-index: 1;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
           <h3 data-lang="environment-score" style="color: #3b82f6; font-size: 16px; font-weight: 600;">
            Environment Score
           </h3>
           <div style="width: 40px; height: 40px; background: rgba(59, 130, 246, 0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
            <span style="font-size: 20px;">
             üè¢
            </span>
           </div>
          </div>
          <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
           <div style="width: 60px; height: 60px; position: relative;">
            <svg style="width: 100%; height: 100%; transform: rotate(-90deg);">
             <circle cx="30" cy="30" fill="none" r="25" stroke="#334155" stroke-width="4">
             </circle>
             <circle cx="30" cy="30" fill="none" id="environmentCircle" r="25" stroke="#3b82f6" stroke-dasharray="157" stroke-dashoffset="157" stroke-width="4" style="transition: stroke-dashoffset 0.5s ease;">
             </circle>
            </svg>
            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
             <span id="environmentScore" style="font-size: 14px; font-weight: 700; color: #e4e4e7;">
              0
             </span>
            </div>
           </div>
           <div>
            <div id="environmentTypeDisplay" style="color: #e4e4e7; font-size: 14px; font-weight: 600;">
             -
            </div>
            <div id="environmentStatus" style="color: #94a3b8; font-size: 12px;">
             No data
            </div>
           </div>
          </div>
         </div>
        </div>
        <!-- Emotional State Card -->
        <div style="background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border: 2px solid #334155; border-radius: 12px; padding: 20px; position: relative; overflow: hidden;">
         <div style="position: absolute; top: -50%; right: -50%; width: 100%; height: 100%; background: radial-gradient(circle, rgba(139, 92, 246, 0.1) 0%, transparent 70%); pointer-events: none;">
         </div>
         <div style="position: relative; z-index: 1;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
           <h3 data-lang="emotional-readiness" style="color: #8b5cf6; font-size: 16px; font-weight: 600;">
            Emotional Readiness
           </h3>
           <div style="width: 40px; height: 40px; background: rgba(139, 92, 246, 0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
            <span style="font-size: 20px;">
             üß†
            </span>
           </div>
          </div>
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 12px;">
           <div style="text-align: center;">
            <div id="stressDisplay" style="font-size: 18px; font-weight: 700; color: #e4e4e7;">
             3
            </div>
            <div style="color: #94a3b8; font-size: 10px;">
             Stress
            </div>
           </div>
           <div style="text-align: center;">
            <div id="confidenceDisplay" style="font-size: 18px; font-weight: 700; color: #e4e4e7;">
             3
            </div>
            <div style="color: #94a3b8; font-size: 10px;">
             Confidence
            </div>
           </div>
           <div style="text-align: center;">
            <div id="focusDisplay" style="font-size: 18px; font-weight: 700; color: #e4e4e7;">
             3
            </div>
            <div style="color: #94a3b8; font-size: 10px;">
             Focus
            </div>
           </div>
          </div>
          <div id="emotionalStatus" style="color: #94a3b8; font-size: 12px; text-align: center;">
           No data
          </div>
         </div>
        </div>
        <!-- Risk Assessment Card -->
        <div style="background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border: 2px solid #334155; border-radius: 12px; padding: 20px; position: relative; overflow: hidden;">
         <div style="position: absolute; top: -50%; right: -50%; width: 100%; height: 100%; background: radial-gradient(circle, rgba(245, 158, 11, 0.1) 0%, transparent 70%); pointer-events: none;">
         </div>
         <div style="position: relative; z-index: 1;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
           <h3 data-lang="risk-assessment" style="color: #f59e0b; font-size: 16px; font-weight: 600;">
            Risk Assessment
           </h3>
           <div style="width: 40px; height: 40px; background: rgba(245, 158, 11, 0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
            <span style="font-size: 20px;">
             ‚ö†Ô∏è
            </span>
           </div>
          </div>
          <div style="margin-bottom: 12px;">
           <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
            <span style="color: #94a3b8; font-size: 12px;">
             Target Risk
            </span>
            <span id="targetRiskPercent" style="color: #e4e4e7; font-size: 12px; font-weight: 600;">
             0%
            </span>
           </div>
           <div style="background: #334155; height: 6px; border-radius: 3px; overflow: hidden;">
            <div id="targetRiskBar" style="height: 100%; background: linear-gradient(90deg, #10b981, #f59e0b, #ef4444); width: 0%; transition: width 0.3s ease;">
            </div>
           </div>
          </div>
          <div style="margin-bottom: 8px;">
           <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
            <span style="color: #94a3b8; font-size: 12px;">
             Max Loss Risk
            </span>
            <span id="maxLossRiskPercent" style="color: #e4e4e7; font-size: 12px; font-weight: 600;">
             0%
            </span>
           </div>
           <div style="background: #334155; height: 6px; border-radius: 3px; overflow: hidden;">
            <div id="maxLossRiskBar" style="height: 100%; background: linear-gradient(90deg, #10b981, #f59e0b, #ef4444); width: 0%; transition: width 0.3s ease;">
            </div>
           </div>
          </div>
          <div id="riskStatus" style="color: #94a3b8; font-size: 12px; text-align: center;">
           No data
          </div>
         </div>
        </div>
       </div>
       <!-- Performance Chart Section -->
       <div style="background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 24px; margin-bottom: 24px;">
        <h3 data-lang="psychology-performance-chart" style="color: #f8fafc; font-size: 18px; font-weight: 600; margin-bottom: 20px; text-align: center;">
         Psychology vs Performance Analysis
        </h3>
        <div style="height: 300px; display: flex; align-items: center; justify-content: center;">
         <canvas id="psychologyPerformanceChart" style="max-width: 100%; max-height: 100%;">
         </canvas>
        </div>
       </div>
      </div>
     </div>
     <!-- Metrics Dashboard Section -->
     <div class="psychology-section" id="psychologyMetricsSection">
      <div class="psychology-container">
       <h2 class="psychology-header" data-lang="psychology-dashboard">
        Psychology Dashboard
       </h2>
       <!-- Daily Psychology Score -->
       <div style="background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 20px; margin-bottom: 24px;">
        <h3 data-lang="daily-psychology-score" style="color: #f8fafc; font-size: 18px; margin-bottom: 16px; text-align: center;">
         Daily Psychology Score
        </h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
         <div id="sleepFactorCard" style="background: #0f172a; border: 2px solid #334155; border-radius: 8px; padding: 16px; text-align: center;">
          <div data-lang="sleep-factor" style="color: #94a3b8; font-size: 12px; margin-bottom: 8px;">
           Sleep Factor
          </div>
          <div id="sleepFactorScore" style="color: #f8fafc; font-size: 24px; font-weight: 700; margin-bottom: 4px;">
           0/25
          </div>
          <div id="sleepFactorStatus" style="color: #64748b; font-size: 11px;">
           No data
          </div>
         </div>
         <div id="stressFactorCard" style="background: #0f172a; border: 2px solid #334155; border-radius: 8px; padding: 16px; text-align: center;">
          <div data-lang="stress-factor" style="color: #94a3b8; font-size: 12px; margin-bottom: 8px;">
           Stress Factor
          </div>
          <div id="stressFactorScore" style="color: #f8fafc; font-size: 24px; font-weight: 700; margin-bottom: 4px;">
           0/25
          </div>
          <div id="stressFactorStatus" style="color: #64748b; font-size: 11px;">
           No data
          </div>
         </div>
         <div id="disciplineFactorCard" style="background: #0f172a; border: 2px solid #334155; border-radius: 8px; padding: 16px; text-align: center;">
          <div data-lang="discipline-factor" style="color: #94a3b8; font-size: 12px; margin-bottom: 8px;">
           Discipline Factor
          </div>
          <div id="disciplineFactorScore" style="color: #f8fafc; font-size: 24px; font-weight: 700; margin-bottom: 4px;">
           0/25
          </div>
          <div id="disciplineFactorStatus" style="color: #64748b; font-size: 11px;">
           No data
          </div>
         </div>
         <div id="consistencyFactorCard" style="background: #0f172a; border: 2px solid #334155; border-radius: 8px; padding: 16px; text-align: center;">
          <div data-lang="consistency-factor" style="color: #94a3b8; font-size: 12px; margin-bottom: 8px;">
           Consistency Factor
          </div>
          <div id="consistencyFactorScore" style="color: #f8fafc; font-size: 24px; font-weight: 700; margin-bottom: 4px;">
           0/25
          </div>
          <div id="consistencyFactorStatus" style="color: #64748b; font-size: 11px;">
           No data
          </div>
         </div>
         <div id="totalScoreCard" style="background: #0f172a; border: 2px solid #3b82f6; border-radius: 8px; padding: 16px; text-align: center;">
          <div data-lang="total-score" style="color: #94a3b8; font-size: 12px; margin-bottom: 8px;">
           Total Score
          </div>
          <div id="totalPsychScore" style="color: #3b82f6; font-size: 28px; font-weight: 700; margin-bottom: 4px;">
           0/100
          </div>
          <div id="totalScoreStatus" style="color: #64748b; font-size: 11px;">
           No data
          </div>
         </div>
        </div>
       </div>
       <!-- Weekly Bias Risk Assessment -->
       <div style="background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 20px; margin-bottom: 24px;">
        <h3 data-lang="weekly-bias-risk" style="color: #f8fafc; font-size: 18px; margin-bottom: 16px; text-align: center;">
         Weekly Bias Risk Assessment
        </h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px;">
         <div id="overconfidenceRiskCard" style="background: #0f172a; border: 2px solid #334155; border-radius: 8px; padding: 16px; text-align: center;">
          <div data-lang="overconfidence-risk" style="color: #94a3b8; font-size: 12px; margin-bottom: 8px;">
           Overconfidence Risk
          </div>
          <div id="overconfidenceRisk" style="color: #f8fafc; font-size: 20px; font-weight: 700; margin-bottom: 4px;">
           Low
          </div>
          <div id="overconfidenceDetails" style="color: #64748b; font-size: 11px;">
           Calibration Error: 0.0%
          </div>
         </div>
         <div id="lossAversionRiskCard" style="background: #0f172a; border: 2px solid #334155; border-radius: 8px; padding: 16px; text-align: center;">
          <div data-lang="loss-aversion-risk" style="color: #94a3b8; font-size: 12px; margin-bottom: 8px;">
           Loss Aversion Risk
          </div>
          <div id="lossAversionRisk" style="color: #f8fafc; font-size: 20px; font-weight: 700; margin-bottom: 4px;">
           Low
          </div>
          <div id="lossAversionDetails" style="color: #64748b; font-size: 11px;">
           Disposition Ratio: 0.0
          </div>
         </div>
         <div id="anchoringRiskCard" style="background: #0f172a; border: 2px solid #334155; border-radius: 8px; padding: 16px; text-align: center;">
          <div data-lang="anchoring-risk" style="color: #94a3b8; font-size: 12px; margin-bottom: 8px;">
           Anchoring Risk
          </div>
          <div id="anchoringRisk" style="color: #f8fafc; font-size: 20px; font-weight: 700; margin-bottom: 4px;">
           Low
          </div>
          <div id="anchoringDetails" style="color: #64748b; font-size: 11px;">
           Entry Price Dependency: 0%
          </div>
         </div>
        </div>
       </div>
       <!-- Performance Correlation -->
       <div style="background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 20px;">
        <h3 data-lang="performance-correlation" style="color: #f8fafc; font-size: 18px; margin-bottom: 16px; text-align: center;">
         Performance Correlation Analysis
        </h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
         <div style="background: #0f172a; border: 1px solid #334155; border-radius: 8px; padding: 16px; text-align: center;">
          <div data-lang="sleep-performance" style="color: #94a3b8; font-size: 12px; margin-bottom: 8px;">
           Sleep vs Performance
          </div>
          <div id="sleepCorrelation" style="color: #f8fafc; font-size: 18px; font-weight: 700;">
           +0.00
          </div>
         </div>
         <div style="background: #0f172a; border: 1px solid #334155; border-radius: 8px; padding: 16px; text-align: center;">
          <div data-lang="caffeine-performance" style="color: #94a3b8; font-size: 12px; margin-bottom: 8px;">
           Caffeine vs Performance
          </div>
          <div id="caffeineCorrelation" style="color: #f8fafc; font-size: 18px; font-weight: 700;">
           +0.00
          </div>
         </div>
         <div style="background: #0f172a; border: 1px solid #334155; border-radius: 8px; padding: 16px; text-align: center;">
          <div data-lang="timing-performance" style="color: #94a3b8; font-size: 12px; margin-bottom: 8px;">
           Timing vs Performance
          </div>
          <div id="timingCorrelation" style="color: #f8fafc; font-size: 18px; font-weight: 700;">
           +0.00
          </div>
         </div>
         <div style="background: #0f172a; border: 1px solid #334155; border-radius: 8px; padding: 16px; text-align: center;">
          <div data-lang="confidence-performance" style="color: #94a3b8; font-size: 12px; margin-bottom: 8px;">
           Confidence vs Performance
          </div>
          <div id="confidenceCorrelation" style="color: #f8fafc; font-size: 18px; font-weight: 700;">
           +0.00
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <!-- Bias Analysis Section -->
     <div class="psychology-section" id="psychologyBiasSection">
      <div class="psychology-container">
       <h2 class="psychology-header" data-lang="bias-analysis-title">
        Quantified Bias Analysis
       </h2>
       <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 24px;">
        <!-- Overconfidence Bias -->
        <div style="background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 20px;">
         <h3 data-lang="overconfidence-bias" style="color: #f8fafc; font-size: 16px; margin-bottom: 16px;">
          Overconfidence Bias
         </h3>
         <div style="margin-bottom: 16px;">
          <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
           <span data-lang="calibration-error" style="color: #94a3b8; font-size: 13px;">
            Calibration Error
           </span>
           <span id="calibrationError" style="color: #e4e4e7; font-size: 13px; font-weight: 600;">
            0.0%
           </span>
          </div>
          <div style="background: #0f172a; height: 6px; border-radius: 3px; overflow: hidden;">
           <div id="calibrationErrorBar" style="height: 100%; background: #10b981; width: 0%; transition: width 0.3s ease;">
           </div>
          </div>
         </div>
         <div style="margin-bottom: 16px;">
          <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
           <span data-lang="overtrading-index" style="color: #94a3b8; font-size: 13px;">
            Overtrading Index
           </span>
           <span id="overtradingIndex" style="color: #e4e4e7; font-size: 13px; font-weight: 600;">
            0%
           </span>
          </div>
          <div style="background: #0f172a; height: 6px; border-radius: 3px; overflow: hidden;">
           <div id="overtradingBar" style="height: 100%; background: #f59e0b; width: 0%; transition: width 0.3s ease;">
           </div>
          </div>
         </div>
         <div>
          <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
           <span data-lang="position-deviation" style="color: #94a3b8; font-size: 13px;">
            Position Size Deviation
           </span>
           <span id="positionDeviation" style="color: #e4e4e7; font-size: 13px; font-weight: 600;">
            0.0
           </span>
          </div>
          <div style="background: #0f172a; height: 6px; border-radius: 3px; overflow: hidden;">
           <div id="positionDeviationBar" style="height: 100%; background: #3b82f6; width: 0%; transition: width 0.3s ease;">
           </div>
          </div>
         </div>
        </div>
        <!-- Loss Aversion -->
        <div style="background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 20px;">
         <h3 data-lang="loss-aversion-bias" style="color: #f8fafc; font-size: 16px; margin-bottom: 16px;">
          Loss Aversion Bias
         </h3>
         <div style="margin-bottom: 16px;">
          <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
           <span data-lang="disposition-ratio" style="color: #94a3b8; font-size: 13px;">
            Disposition Ratio
           </span>
           <span id="dispositionRatio" style="color: #e4e4e7; font-size: 13px; font-weight: 600;">
            1.0
           </span>
          </div>
          <div style="background: #0f172a; height: 6px; border-radius: 3px; overflow: hidden;">
           <div id="dispositionBar" style="height: 100%; background: #ef4444; width: 0%; transition: width 0.3s ease;">
           </div>
          </div>
         </div>
         <div style="margin-bottom: 16px;">
          <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
           <span data-lang="stop-loss-execution" style="color: #94a3b8; font-size: 13px;">
            Stop Loss Execution Rate
           </span>
           <span id="stopLossRate" style="color: #e4e4e7; font-size: 13px; font-weight: 600;">
            0%
           </span>
          </div>
          <div style="background: #0f172a; height: 6px; border-radius: 3px; overflow: hidden;">
           <div id="stopLossBar" style="height: 100%; background: #10b981; width: 0%; transition: width 0.3s ease;">
           </div>
          </div>
         </div>
         <div>
          <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
           <span data-lang="stop-loss-modification" style="color: #94a3b8; font-size: 13px;">
            Stop Loss Modification Rate
           </span>
           <span id="stopLossModRate" style="color: #e4e4e7; font-size: 13px; font-weight: 600;">
            0%
           </span>
          </div>
          <div style="background: #0f172a; height: 6px; border-radius: 3px; overflow: hidden;">
           <div id="stopLossModBar" style="height: 100%; background: #8b5cf6; width: 0%; transition: width 0.3s ease;">
           </div>
          </div>
         </div>
        </div>
        <!-- Anchoring Bias -->
        <div style="background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 20px;">
         <h3 data-lang="anchoring-bias" style="color: #f8fafc; font-size: 16px; margin-bottom: 16px;">
          Anchoring Bias
         </h3>
         <div style="margin-bottom: 16px;">
          <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
           <span data-lang="entry-price-dependency" style="color: #94a3b8; font-size: 13px;">
            Entry Price Dependency
           </span>
           <span id="entryPriceDep" style="color: #e4e4e7; font-size: 13px; font-weight: 600;">
            0%
           </span>
          </div>
          <div style="background: #0f172a; height: 6px; border-radius: 3px; overflow: hidden;">
           <div id="entryPriceBar" style="height: 100%; background: #06b6d4; width: 0%; transition: width 0.3s ease;">
           </div>
          </div>
         </div>
         <div style="margin-bottom: 16px;">
          <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
           <span data-lang="round-number-bias" style="color: #94a3b8; font-size: 13px;">
            Round Number Bias
           </span>
           <span id="roundNumberBias" style="color: #e4e4e7; font-size: 13px; font-weight: 600;">
            0%
           </span>
          </div>
          <div style="background: #0f172a; height: 6px; border-radius: 3px; overflow: hidden;">
           <div id="roundNumberBar" style="height: 100%; background: #f59e0b; width: 0%; transition: width 0.3s ease;">
           </div>
          </div>
         </div>
         <div>
          <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
           <span data-lang="recent-high-anchor" style="color: #94a3b8; font-size: 13px;">
            Recent High Anchor
           </span>
           <span id="recentHighAnchor" style="color: #e4e4e7; font-size: 13px; font-weight: 600;">
            0%
           </span>
          </div>
          <div style="background: #0f172a; height: 6px; border-radius: 3px; overflow: hidden;">
           <div id="recentHighBar" style="height: 100%; background: #ef4444; width: 0%; transition: width 0.3s ease;">
           </div>
          </div>
         </div>
        </div>
       </div>
       <!-- Weekly Risk Summary -->
       <div style="background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 20px; margin-top: 24px;">
        <h3 data-lang="weekly-risk-summary" style="color: #f8fafc; font-size: 16px; margin-bottom: 16px;">
         Weekly Risk Summary
        </h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
         <div style="background: #0f172a; border: 1px solid #334155; border-radius: 8px; padding: 16px; text-align: center;">
          <div data-lang="overall-bias-risk" style="color: #94a3b8; font-size: 12px; margin-bottom: 8px;">
           Overall Bias Risk
          </div>
          <div id="overallBiasRisk" style="color: #f8fafc; font-size: 20px; font-weight: 700; margin-bottom: 4px;">
           Low
          </div>
          <div id="overallBiasScore" style="color: #64748b; font-size: 11px;">
           Score: 0/100
          </div>
         </div>
         <div style="background: #0f172a; border: 1px solid #334155; border-radius: 8px; padding: 16px; text-align: center;">
          <div data-lang="risk-trend" style="color: #94a3b8; font-size: 12px; margin-bottom: 8px;">
           Risk Trend
          </div>
          <div id="riskTrend" style="color: #f8fafc; font-size: 20px; font-weight: 700; margin-bottom: 4px;">
           Stable
          </div>
          <div id="riskTrendDetails" style="color: #64748b; font-size: 11px;">
           Last 7 days
          </div>
         </div>
         <div style="background: #0f172a; border: 1px solid #334155; border-radius: 8px; padding: 16px; text-align: center;">
          <div data-lang="action-needed" style="color: #94a3b8; font-size: 12px; margin-bottom: 8px;">
           Action Needed
          </div>
          <div id="actionNeeded" style="color: #f8fafc; font-size: 20px; font-weight: 700; margin-bottom: 4px;">
           None
          </div>
          <div id="actionDetails" style="color: #64748b; font-size: 11px;">
           All metrics normal
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <!-- Pattern Insights Section -->
     <div class="psychology-section" id="psychologyPatternsSection">
      <div class="psychology-container">
       <h2 class="psychology-header" data-lang="pattern-insights-title">
        Pattern Insights &amp; Recommendations
       </h2>
       <!-- Time-Based Performance -->
       <div style="background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 20px; margin-bottom: 24px;">
        <h3 data-lang="time-based-performance" style="color: #f8fafc; font-size: 16px; margin-bottom: 16px;">
         Time-Based Performance Analysis
        </h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
         <div style="background: #0f172a; border: 1px solid #334155; border-radius: 8px; padding: 16px; text-align: center;">
          <div data-lang="best-trading-hour" style="color: #94a3b8; font-size: 12px; margin-bottom: 8px;">
           Best Trading Hour
          </div>
          <div id="bestTradingHour" style="color: #10b981; font-size: 18px; font-weight: 700; margin-bottom: 4px;">
           --:--
          </div>
          <div id="bestHourPerformance" style="color: #64748b; font-size: 11px;">
           Win Rate: --%
          </div>
         </div>
         <div style="background: #0f172a; border: 1px solid #334155; border-radius: 8px; padding: 16px; text-align: center;">
          <div data-lang="worst-trading-hour" style="color: #94a3b8; font-size: 12px; margin-bottom: 8px;">
           Worst Trading Hour
          </div>
          <div id="worstTradingHour" style="color: #ef4444; font-size: 18px; font-weight: 700; margin-bottom: 4px;">
           --:--
          </div>
          <div id="worstHourPerformance" style="color: #64748b; font-size: 11px;">
           Win Rate: --%
          </div>
         </div>
         <div style="background: #0f172a; border: 1px solid #334155; border-radius: 8px; padding: 16px; text-align: center;">
          <div data-lang="optimal-sleep-range" style="color: #94a3b8; font-size: 12px; margin-bottom: 8px;">
           Optimal Sleep Range
          </div>
          <div id="optimalSleepRange" style="color: #3b82f6; font-size: 18px; font-weight: 700; margin-bottom: 4px;">
           -.- hours
          </div>
          <div id="sleepRangePerformance" style="color: #64748b; font-size: 11px;">
           Avg P&amp;L: $--
          </div>
         </div>
         <div style="background: #0f172a; border: 1px solid #334155; border-radius: 8px; padding: 16px; text-align: center;">
          <div data-lang="delay-impact" style="color: #94a3b8; font-size: 12px; margin-bottom: 8px;">
           Start Delay Impact
          </div>
          <div id="delayImpact" style="color: #f59e0b; font-size: 18px; font-weight: 700; margin-bottom: 4px;">
           --min
          </div>
          <div id="delayPerformance" style="color: #64748b; font-size: 11px;">
           Performance drop: --%
          </div>
         </div>
        </div>
       </div>
       <!-- Consecutive Trades Pattern -->
       <div style="background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 20px; margin-bottom: 24px;">
        <h3 data-lang="consecutive-pattern" style="color: #f8fafc; font-size: 16px; margin-bottom: 16px;">
         Consecutive Trades Pattern
        </h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px;">
         <div style="background: #0f172a; border: 1px solid #334155; border-radius: 8px; padding: 16px;">
          <div data-lang="after-losses" style="color: #94a3b8; font-size: 14px; margin-bottom: 12px;">
           Performance After Losses
          </div>
          <div style="color: #e4e4e7; font-size: 13px; margin-bottom: 8px;">
           After 1 loss:
           <span id="after1Loss" style="font-weight: 600;">
            --%
           </span>
          </div>
          <div style="color: #e4e4e7; font-size: 13px; margin-bottom: 8px;">
           After 2 losses:
           <span id="after2Losses" style="font-weight: 600;">
            --%
           </span>
          </div>
          <div style="color: #e4e4e7; font-size: 13px;">
           After 3+ losses:
           <span id="after3Losses" style="font-weight: 600;">
            --%
           </span>
          </div>
         </div>
         <div style="background: #0f172a; border: 1px solid #334155; border-radius: 8px; padding: 16px;">
          <div data-lang="after-wins" style="color: #94a3b8; font-size: 14px; margin-bottom: 12px;">
           Performance After Wins
          </div>
          <div style="color: #e4e4e7; font-size: 13px; margin-bottom: 8px;">
           After 1 win:
           <span id="after1Win" style="font-weight: 600;">
            --%
           </span>
          </div>
          <div style="color: #e4e4e7; font-size: 13px; margin-bottom: 8px;">
           After 2 wins:
           <span id="after2Wins" style="font-weight: 600;">
            --%
           </span>
          </div>
          <div style="color: #e4e4e7; font-size: 13px;">
           After 3+ wins:
           <span id="after3Wins" style="font-weight: 600;">
            --%
           </span>
          </div>
         </div>
        </div>
       </div>
       <!-- AI-Generated Insights -->
       <div style="background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 20px;">
        <h3 data-lang="ai-insights" style="color: #f8fafc; font-size: 16px; margin-bottom: 16px;">
         AI-Generated Insights
        </h3>
        <div id="aiInsightsList" style="display: grid; gap: 12px;">
         <div style="background: #0f172a; border-left: 4px solid #3b82f6; padding: 12px 16px; border-radius: 0 6px 6px 0;">
          <div data-lang="no-insights" style="color: #e4e4e7; font-size: 14px; line-height: 1.5;">
           Collect more psychology data to generate personalized insights.
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
    </div>
    <!-- Notes page -->
    <div class="page" id="notes">
     <div class="page-header">
      <div>
       <h1 class="page-title" data-lang="notes-title">
        Trading Notes
       </h1>
       <p class="page-subtitle" data-lang="notes-subtitle">
        Document your trading insights and thoughts
       </p>
      </div>
      <div class="notes-controls">
       <button class="btn btn-primary" data-lang="new-note" onclick="showNoteEditor()">
        New Note
       </button>
      </div>
     </div>
     <div class="notes-container">
      <!-- Notes Tabs -->
      <div class="notes-tabs">
       <button class="notes-tab active" data-lang="all-notes" onclick="showNotesSection('all')">
        All
       </button>
       <button class="notes-tab" data-lang="daily-review" onclick="showNotesSection('daily')">
        Daily Review
       </button>
       <button class="notes-tab" data-lang="strategy" onclick="showNotesSection('strategy')">
        Strategy
       </button>
       <button class="notes-tab" data-lang="general" onclick="showNotesSection('general')">
        General
       </button>
      </div>
      <!-- Note Editor -->
      <div class="note-editor" id="noteEditor" style="display: none;">
       <div class="note-formatting-toolbar">
        <button class="formatting-btn" onclick="toggleBold()" title="Bold">
         B
        </button>
        <button class="formatting-btn" onclick="toggleItalic()" title="Italic">
         I
        </button>
        <button class="formatting-btn" onclick="toggleUnderline()" title="Underline">
         U
        </button>
        <select class="font-selector" id="fontSelector" onchange="changeFont()">
         <option value="'Source Code Pro', monospace">
          Source Code Pro
         </option>
         <option value="'JetBrains Mono', monospace">
          JetBrains Mono
         </option>
         <option value="'Inter', sans-serif">
          Inter
         </option>
         <option value="'Georgia', serif">
          Georgia
         </option>
        </select>
        <div class="color-picker">
         <div class="color-option" onmousedown="event.preventDefault(); changeTextColor('#e4e4e7');" style="background-color: #e4e4e7;">
         </div>
         <div class="color-option" onmousedown="event.preventDefault(); changeTextColor('#10b981');" style="background-color: #10b981;">
         </div>
         <div class="color-option" onmousedown="event.preventDefault(); changeTextColor('#ef4444');" style="background-color: #ef4444;">
         </div>
         <div class="color-option" onmousedown="event.preventDefault(); changeTextColor('#3b82f6');" style="background-color: #3b82f6;">
         </div>
         <div class="color-option" onmousedown="event.preventDefault(); changeTextColor('#f59e0b');" style="background-color: #f59e0b;">
         </div>
         <div class="color-option" onmousedown="event.preventDefault(); changeTextColor('#8b5cf6');" style="background-color: #8b5cf6;">
         </div>
        </div>
       </div>
       <input class="note-title-input" data-lang="note-title-placeholder" id="noteTitle" placeholder="Enter note title..." type="text"/>
       <div class="note-content-input" contenteditable="true" data-placeholder="Write your note here..." id="noteContentEditor">
       </div>
       <div class="note-actions">
        <button class="btn btn-secondary" data-lang="cancel" onclick="cancelNote()">
         Cancel
        </button>
        <button class="btn btn-primary" data-lang="save-note" onclick="saveNote()">
         Save Note
        </button>
       </div>
      </div>
      <!-- Note View Mode -->
      <div class="note-view-mode" id="noteViewMode" style="display: none;">
       <div class="note-view-title" id="noteViewTitle">
       </div>
       <div class="note-view-content" id="noteViewContent">
       </div>
       <div class="note-view-actions">
        <button class="btn btn-secondary" data-lang="back" onclick="backToNotesList()">
         Back
        </button>
        <button class="btn btn-primary" data-lang="edit" onclick="editCurrentNote()">
         Edit
        </button>
       </div>
      </div>
      <!-- Notes Sections -->
      <div class="note-section active" id="allNotesSection">
       <div class="notes-list" id="allNotesList">
        <div class="empty-state">
         <div class="empty-state-icon">
          üìù
         </div>
         <div data-lang="no-notes">
          No notes written yet. Click "New Note" to start.
         </div>
        </div>
       </div>
      </div>
      <div class="note-section" id="dailyNotesSection">
       <div class="notes-list" id="dailyNotesList">
        <div class="empty-state">
         <div class="empty-state-icon">
          üìù
         </div>
         <div data-lang="no-daily-notes">
          No daily review notes yet. Click "New Note" to start.
         </div>
        </div>
       </div>
      </div>
      <div class="note-section" id="strategyNotesSection">
       <div class="notes-list" id="strategyNotesList">
        <div class="empty-state">
         <div class="empty-state-icon">
          üìä
         </div>
         <div data-lang="no-strategy-notes">
          No strategy notes yet. Click "New Note" to start.
         </div>
        </div>
       </div>
      </div>
      <div class="note-section" id="generalNotesSection">
       <div class="notes-list" id="generalNotesList">
        <div class="empty-state">
         <div class="empty-state-icon">
          üìÑ
         </div>
         <div data-lang="no-general-notes">
          No general notes yet. Click "New Note" to start.
         </div>
        </div>
       </div>
      </div>
     </div>
    </div>
    <!-- Trade List page -->
    <div class="page" id="trades">
     <div class="page-header">
      <div>
       <h1 class="page-title" data-lang="tradelist-title">
        Trade List
       </h1>
       <p class="page-subtitle" data-lang="tradelist-subtitle">
        Complete list of all your trades
       </p>
      </div>
      <div class="date-range-selector">
       <input class="date-range-input" id="tradesStartDate" type="date"/>
       <span style="color: #64748b;">
        to
       </span>
       <input class="date-range-input" id="tradesEndDate" type="date"/>
       <button class="btn btn-secondary" onclick="clearTradesRange()" style="padding: 4px 8px; font-size: 12px;">
        Clear
       </button>
      </div>
     </div>
     <div class="trades-section">
      <div class="trades-header">
       <h2 data-lang="trade-history">
        Trade History
       </h2>
       <div style="display: flex; gap: 12px; align-items: center;">
        <button class="btn btn-secondary" data-lang="delete-selected" id="deleteSelectedListBtn" onclick="deleteSelectedTradesList()" style="display: none; background: #dc2626; border-color: #dc2626;">
         Delete Selected
        </button>
        <div class="period-summary" id="allTradesSummary">
        </div>
       </div>
      </div>
      <table class="trades-table">
       <thead>
        <tr>
         <th style="width: 40px;">
          <input id="selectAllTradesList" onchange="toggleAllTradesList()" style="accent-color: #3b82f6;" type="checkbox"/>
         </th>
         <th data-lang="date">
          Date
         </th>
         <th data-lang="symbol">
          Symbol
         </th>
         <th data-lang="buy-price">
          Buy Price
         </th>
         <th data-lang="sell-price">
          Sell Price
         </th>
         <th data-lang="shares">
          Shares
         </th>
         <th data-lang="amount">
          Amount
         </th>
         <th data-lang="time">
          Time
         </th>
         <th data-lang="pnl">
          P&amp;L
         </th>
         <th data-lang="return-pct">
          Return %
         </th>
         <th data-lang="actions">
          Actions
         </th>
        </tr>
       </thead>
       <tbody id="allTradesTableBody">
        <tr>
         <td colspan="10">
          <div class="empty-state">
           <div class="empty-state-icon">
            üìä
           </div>
           <div data-lang="no-trades">
            No trades recorded yet
           </div>
          </div>
         </td>
        </tr>
       </tbody>
      </table>
     </div>
    </div>
    <!-- Settings page -->
    <div class="page" id="settings">
     <div class="page-header">
      <div>
       <h1 class="page-title" data-lang="settings-title">
        Settings
       </h1>
       <p class="page-subtitle" data-lang="settings-subtitle">
        Configure your trading journal preferences
       </p>
      </div>
     </div>
     <div class="settings-section">
      <h3 data-lang="general-settings">
       General Settings
      </h3>
      <div class="settings-option">
       <label data-lang="default-language">
        Default Language
       </label>
       <select id="settingsLanguageSelect" onchange="changeLanguageFromSettings()">
        <option value="en">
         English
        </option>
        <option value="ko">
         ÌïúÍµ≠Ïñ¥
        </option>
       </select>
      </div>
     </div>
     <div class="settings-section">
      <h3 data-lang="data-management">
       Data Management
      </h3>
      <button class="settings-btn" data-lang="export-data" onclick="exportData()">
       Export Data
      </button>
      <button class="settings-btn" data-lang="import-data" onclick="importData()">
       Import Data
      </button>
      <input accept=".json" id="importFileInput" onchange="handleFileImport()" style="display: none;" type="file"/>
     </div>
     <div class="settings-section">
      <h3 data-lang="danger-zone">
       Danger Zone
      </h3>
      <button class="settings-btn danger" data-lang="clear-all-data" onclick="clearAllData()">
       
      </button>
     </div>
    </div>
   </main>
  </div>
  <!-- Chart.js ÎùºÏù¥Î∏åÎü¨Î¶¨ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  
  <!-- javaScript ÌååÏùºÎì§ -->
  <script src="js/config.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/trading.js"></script>
  <script src="js/analytics.js"></script>
  <script src="js/psychology.js"></script>
  <script src="js/calendar.js"></script>
  <script src="js/notes.js"></script>
  <script src="js/main.js"></script>

  <script>

        
        // Notes section functions
        function showNotesSection(section) {
            // ÎÖ∏Ìä∏ ÏûëÏÑ±/Ìé∏Ïßë Ï§ëÏù∏ÏßÄ ÌôïÏù∏
    const noteEditor = document.getElementById('noteEditor');
    const isEditing = noteEditor.style.display === 'block';
    
    if (isEditing) {
        const title = document.getElementById('noteTitle').value.trim();
        const content = document.getElementById('noteContentEditor').innerHTML.trim();
        
        if (title || content) {
            const confirmMessage = currentLanguage === 'ko' ? 
                'ÏûëÏÑ± Ï§ëÏù∏ ÎÖ∏Ìä∏Í∞Ä ÏûàÏäµÎãàÎã§. Ï†ÄÏû•ÌïòÏßÄ ÏïäÍ≥† Ïù¥ÎèôÌïòÏãúÍ≤†ÏäµÎãàÍπå?' : 
                'You have unsaved note content. Do you want to leave without saving?';
            
            if (!confirm(confirmMessage)) {
                return;
            }
        }
    }
            
            // Î™®Îì† ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî
            currentNotesSection = section;
            currentViewingNoteId = null;
            editingNoteId = null;
            
            // ÏóêÎîîÌÑ∞ÏôÄ Î∑∞Î™®Îìú Ïà®Í∏∞Í∏∞
            document.getElementById('noteEditor').style.display = 'none';
            document.getElementById('noteViewMode').style.display = 'none';
            
            // ÌÉ≠ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
            document.querySelectorAll('.notes-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Î™®Îì† ÏÑπÏÖò Ïà®Í∏∞Í∏∞
            document.querySelectorAll('.note-section').forEach(noteSection => {
                noteSection.classList.remove('active');
                noteSection.style.display = 'none';
            });
            
            // ÏÑ†ÌÉùÎêú ÏÑπÏÖòÎßå ÌëúÏãú
            const targetSection = document.getElementById(`${section}NotesSection`);
            if (targetSection) {
                targetSection.classList.add('active');
                targetSection.style.display = 'block';
            }
            
            // ÎÖ∏Ìä∏ Î™©Î°ù ÏÉàÎ°úÍ≥†Ïπ®
            setTimeout(() => {
                renderNotesList(section);
            }, 10);
        }

        // Note formatting functions
        function toggleBold() {
            document.execCommand('bold');
            document.querySelector('[onclick="toggleBold()"]').classList.toggle('active');
        }

        function toggleItalic() {
            document.execCommand('italic');
            document.querySelector('[onclick="toggleItalic()"]').classList.toggle('active');
        }

        function toggleUnderline() {
            document.execCommand('underline');
            document.querySelector('[onclick="toggleUnderline()"]').classList.toggle('active');
        }

        function changeFont() {
            const font = document.getElementById('fontSelector').value;
            currentFont = font;
            document.getElementById('noteContentEditor').style.fontFamily = font;
            document.execCommand('fontName', false, font);
        }

        function changeTextColor(color) {
            currentTextColor = color;
            document.querySelectorAll('.color-option').forEach(option => {
                option.classList.remove('active');
            });
            
            // ÏÉâÏÉÅ Îß§Ìïë Í∞ùÏ≤¥Î•º ÏÇ¨Ïö©Ìïú Ïò¨Î∞îÎ•∏ ÌôúÏÑ±Ìôî
            const colorMap = {
                '#e4e4e7': 'rgb(228, 228, 231)',
                '#10b981': 'rgb(16, 185, 129)',
                '#ef4444': 'rgb(239, 68, 68)',
                '#3b82f6': 'rgb(59, 130, 246)',
                '#f59e0b': 'rgb(245, 158, 11)',
                '#8b5cf6': 'rgb(139, 92, 246)'
            };
            
            document.querySelectorAll('.color-option').forEach(option => {
                if (colorMap[color] === option.style.backgroundColor) {
                    option.classList.add('active');
                }
            });

            const selection = window.getSelection();
            
            if (selection.rangeCount > 0 && selection.toString().trim().length > 0) {
                document.execCommand('styleWithCSS', false, true);
                document.execCommand('foreColor', false, color);
                return;
            }
            
            const editor = document.getElementById('noteContentEditor');
            editor.style.color = color;
        }

        // Enhanced Notes functions with categories
        function showNoteEditor() {
    // Í∏∞Ï°¥ ÎÇ¥Ïö©Ïù¥ ÏûàÎäîÏßÄ ÌôïÏù∏
    const noteEditor = document.getElementById('noteEditor');
    const isCurrentlyEditing = noteEditor.style.display === 'block';
    
    if (isCurrentlyEditing) {
        const title = document.getElementById('noteTitle').value.trim();
        const content = document.getElementById('noteContentEditor').innerHTML.trim();
        
        if (title || content) {
            const confirmMessage = currentLanguage === 'ko' ? 
                'ÏûëÏÑ± Ï§ëÏù∏ ÎÖ∏Ìä∏Í∞Ä ÏûàÏäµÎãàÎã§. ÏÉà ÎÖ∏Ìä∏Î•º ÏãúÏûëÌïòÏãúÍ≤†ÏäµÎãàÍπå?' : 
                'You have unsaved content. Start a new note?';
            
            if (!confirm(confirmMessage)) {
                return;
            }
        }
    }

    editingNoteId = null;
    currentFont = "'Inter', sans-serif";
    currentTextColor = '#e4e4e7';
    
    document.getElementById('noteTitle').value = '';
    document.getElementById('noteContentEditor').innerHTML = '';
    document.getElementById('noteContentEditor').style.fontFamily = currentFont;
    document.getElementById('noteContentEditor').style.color = currentTextColor;
    document.getElementById('fontSelector').value = currentFont;
    
    // ÏÉâÏÉÅ ÏòµÏÖò Ï¥àÍ∏∞Ìôî
    document.querySelectorAll('.color-option').forEach(option => {
        option.classList.remove('active');
    });
    const defaultColorOption = document.querySelector('.color-option[style*="228, 228, 231"]');
    if (defaultColorOption) {
        defaultColorOption.classList.add('active');
    }
    
    document.getElementById('noteEditor').style.display = 'block';
    document.getElementById('noteViewMode').style.display = 'none';
    document.querySelectorAll('.note-section').forEach(section => {
        section.style.display = 'none';
    });
    document.getElementById('noteTitle').focus();
}
        
        function editNote(noteId) {
    const note = notes.find(n => n.id === noteId);
    if (note) {
        editingNoteId = noteId;
        currentTextColor = note.textColor || '#e4e4e7';
        currentFont = note.font || "'Inter', sans-serif";
        
        document.getElementById('noteTitle').value = note.title;
        document.getElementById('noteContentEditor').innerHTML = note.content;
        document.getElementById('noteContentEditor').style.fontFamily = currentFont;
        document.getElementById('noteContentEditor').style.color = currentTextColor;
        document.getElementById('fontSelector').value = currentFont;
        
        // ÏÉâÏÉÅ ÏòµÏÖò ÏóÖÎç∞Ïù¥Ìä∏
        document.querySelectorAll('.color-option').forEach(option => {
            option.classList.remove('active');
        });
        
        // ÌòÑÏû¨ ÏÉâÏÉÅÏóê ÎßûÎäî ÏòµÏÖò ÏÑ†ÌÉù
        const colorMap = {
            '#e4e4e7': 'rgb(228, 228, 231)',
            '#10b981': 'rgb(16, 185, 129)',
            '#ef4444': 'rgb(239, 68, 68)',
            '#3b82f6': 'rgb(59, 130, 246)',
            '#f59e0b': 'rgb(245, 158, 11)',
            '#8b5cf6': 'rgb(139, 92, 246)'
        };
        
        document.querySelectorAll('.color-option').forEach(option => {
            if (colorMap[currentTextColor] === option.style.backgroundColor) {
                option.classList.add('active');
            }
        });
        
        document.getElementById('noteEditor').style.display = 'block';
        document.getElementById('noteViewMode').style.display = 'none';
        document.querySelectorAll('.note-section').forEach(section => {
            section.style.display = 'none';
        });
        document.getElementById('noteTitle').focus();
    }
}

        function deleteNote(noteId) {
            if (confirm(currentLanguage === 'ko' ? 'Ïù¥ ÎÖ∏Ìä∏Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?' : 'Are you sure you want to delete this note?')) {
                notes = notes.filter(note => note.id !== noteId);
                saveNotes();
                renderAllNotesSections();
                showToast(currentLanguage === 'ko' ? 'ÎÖ∏Ìä∏Í∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§' : 'Note deleted');
            }
        }

        function saveNote() {
    const title = document.getElementById('noteTitle').value.trim();
    const content = document.getElementById('noteContentEditor').innerHTML.trim();
    
    if (!title || !content) {
        alert(currentLanguage === 'ko' ? 'Ï†úÎ™©Í≥º ÎÇ¥Ïö©ÏùÑ Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.' : 'Please enter both title and content.');
        return;
    }

    const now = new Date();
    
    if (editingNoteId) {
        // Update existing note
        const noteIndex = notes.findIndex(n => n.id === editingNoteId);
        if (noteIndex !== -1) {
            notes[noteIndex] = {
                ...notes[noteIndex],
                title: title,
                content: content,
                font: currentFont,
                textColor: currentTextColor,
                updatedAt: now.toISOString()
            };
        }
    } else {
        // Create new note
        const actualCategory = currentNotesSection === 'all' ? 'general' : currentNotesSection;
        const newNote = {
            id: Date.now(),
            title: title,
            content: content,
            font: currentFont,
            textColor: currentTextColor,
            category: actualCategory,
            pinned: false,
            createdAt: now.toISOString(),
            updatedAt: now.toISOString()
        };
        notes.unshift(newNote);
    }

    saveNotes();
    cancelNote();
    renderAllNotesSections();
    showToast(editingNoteId ? 
        (currentLanguage === 'ko' ? 'ÎÖ∏Ìä∏Í∞Ä ÏóÖÎç∞Ïù¥Ìä∏ÎêòÏóàÏäµÎãàÎã§' : 'Note updated') :
        (currentLanguage === 'ko' ? 'ÎÖ∏Ìä∏Í∞Ä Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§' : 'Note saved')
    );
}

        function cancelNote() {
    editingNoteId = null;
    currentViewingNoteId = null;
    
    document.getElementById('noteEditor').style.display = 'none';
    document.getElementById('noteViewMode').style.display = 'none';
    
    // Î™®Îì† ÏÑπÏÖò Ïà®Í∏∞Í∏∞ ÌõÑ ÌòÑÏû¨ Ïπ¥ÌÖåÍ≥†Î¶¨Îßå ÌëúÏãú
    document.querySelectorAll('.note-section').forEach(section => {
        section.style.display = 'none';
        section.classList.remove('active');
    });
    
    const targetSection = document.getElementById(`${currentNotesSection}NotesSection`);
    if (targetSection) {
        targetSection.style.display = 'block';
        targetSection.classList.add('active');
    }
    
    // ÎÖ∏Ìä∏ Î™©Î°ù ÏÉàÎ°ú Î†åÎçîÎßÅ
    setTimeout(() => {
        renderNotesList(currentNotesSection);
    }, 10);
}

        function renderAllNotesSections() {
            renderNotesList('all');
            renderNotesList('daily');
            renderNotesList('strategy');
            renderNotesList('general');
        }

        function renderNotesList(category) {
    let categoryNotes;
    if (category === 'all') {
        categoryNotes = notes;
    } else {
        categoryNotes = notes.filter(note => note.category === category);
    }
    
    // Í≥†Ï†ïÎêú ÎÖ∏Ìä∏ÏôÄ ÏùºÎ∞ò ÎÖ∏Ìä∏ Î∂ÑÎ¶¨
    const pinnedNotes = categoryNotes.filter(note => note.pinned);
    const regularNotes = categoryNotes.filter(note => !note.pinned);
    
    // Í≥†Ï†ïÎêú ÎÖ∏Ìä∏Îäî ÏóÖÎç∞Ïù¥Ìä∏ ÏãúÍ∞ÑÏàú, ÏùºÎ∞ò ÎÖ∏Ìä∏Îäî ÏÉùÏÑ± ÏãúÍ∞ÑÏàú Ï†ïÎ†¨
    pinnedNotes.sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));
    regularNotes.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
    
    const sortedNotes = [...pinnedNotes, ...regularNotes];
    
    const notesList = document.getElementById(`${category}NotesList`);
    
    if (sortedNotes.length === 0) {
        const emptyMessages = {
            all: currentLanguage === 'ko' ? 'ÏïÑÏßÅ ÏûëÏÑ±Îêú ÎÖ∏Ìä∏Í∞Ä ÏóÜÏäµÎãàÎã§. "ÏÉà ÎÖ∏Ìä∏"Î•º ÌÅ¥Î¶≠ÌïòÏó¨ ÏãúÏûëÌïòÏÑ∏Ïöî.' : 'No notes written yet. Click "New Note" to start.',
            daily: currentLanguage === 'ko' ? 'ÏùºÏùº Î¶¨Î∑∞ ÎÖ∏Ìä∏Í∞Ä ÏïÑÏßÅ ÏóÜÏäµÎãàÎã§. "ÏÉà ÎÖ∏Ìä∏"Î•º ÌÅ¥Î¶≠ÌïòÏó¨ ÏãúÏûëÌïòÏÑ∏Ïöî.' : 'No daily review notes yet. Click "New Note" to start.',
            strategy: currentLanguage === 'ko' ? 'Ï†ÑÎûµ ÎÖ∏Ìä∏Í∞Ä ÏïÑÏßÅ ÏóÜÏäµÎãàÎã§. "ÏÉà ÎÖ∏Ìä∏"Î•º ÌÅ¥Î¶≠ÌïòÏó¨ ÏãúÏûëÌïòÏÑ∏Ïöî.' : 'No strategy notes yet. Click "New Note" to start.',
            general: currentLanguage === 'ko' ? 'ÏùºÎ∞ò ÎÖ∏Ìä∏Í∞Ä ÏïÑÏßÅ ÏóÜÏäµÎãàÎã§. "ÏÉà ÎÖ∏Ìä∏"Î•º ÌÅ¥Î¶≠ÌïòÏó¨ ÏãúÏûëÌïòÏÑ∏Ïöî.' : 'No general notes yet. Click "New Note" to start.'
        };
        
        notesList.innerHTML = `
            <div class="empty-state">
                <div class="empty-state-icon">üìù</div>
                <div>${emptyMessages[category]}</div>
            </div>
        `;
        return;
    }

    notesList.innerHTML = sortedNotes.map(note => {
        const createdDate = new Date(note.createdAt);
        const formattedDate = createdDate.toLocaleDateString(currentLanguage === 'ko' ? 'ko-KR' : 'en-US', {
            year: 'numeric',
            month: 'short',
            day: 'numeric'
        });
        
        const preview = note.content.replace(/<[^>]*>/g, '');
        const previewText = preview.length > 150 ? preview.substring(0, 150) + '...' : preview;

        const categoryLabels = {
            daily: currentLanguage === 'ko' ? 'ÏùºÏùº Î¶¨Î∑∞' : 'Daily Review',
            strategy: currentLanguage === 'ko' ? 'Ï†ÑÎûµ' : 'Strategy',
            general: currentLanguage === 'ko' ? 'ÏùºÎ∞ò' : 'General'
        };

        const pinnedClass = note.pinned ? 'note-item-pinned' : '';
        const pinnedIcon = note.pinned ? 'üìå ' : '';
        const uniqueId = `${note.id}_${category}`;

        return `
            <div class="note-item ${pinnedClass}" onclick="viewNote(${note.id})">
                <div class="note-item-header">
                    <div>
                        <h3 class="note-item-title">${pinnedIcon}${note.title}</h3>
                        ${category === 'all' ? `<div class="note-item-category">${categoryLabels[note.category]}</div>` : ''}
                    </div>
                    <div class="note-item-header-right">
                        <span class="note-item-date">${formattedDate}</span>
                        <button class="pin-btn" onclick="event.stopPropagation(); togglePinNote(${note.id})" title="${note.pinned ? (currentLanguage === 'ko' ? 'Í≥†Ï†ï Ìï¥Ï†ú' : 'Unpin') : (currentLanguage === 'ko' ? 'ÏÉÅÎã® Í≥†Ï†ï' : 'Pin to top')}">${note.pinned ? 'üìå' : 'üìå'}</button>
                    </div>
                </div>
                <div class="note-item-preview" id="preview-${uniqueId}" style="color: ${note.textColor || '#94a3b8'}; font-family: ${note.font || "'Inter', sans-serif"};">${previewText}</div>
                <button class="expand-btn" data-note-id="${note.id}" data-category="${category}" onclick="event.stopPropagation(); toggleNotePreview(this)">${currentLanguage === 'ko' ? 'ÎçîÎ≥¥Í∏∞' : 'Show more'}</button>
                <div class="note-item-actions">
                    <button class="action-btn" onclick="event.stopPropagation(); editNote(${note.id})" title="Edit note">‚úèÔ∏è</button>
                    <button class="action-btn" onclick="event.stopPropagation(); deleteNote(${note.id})" title="Delete note">üóëÔ∏è</button>
                </div>
            </div>
        `;
    }).join('');
}

        function toggleNotePreview(buttonElement) {
    const noteId = parseInt(buttonElement.getAttribute('data-note-id'));
    const category = buttonElement.getAttribute('data-category');
    const uniqueId = `${noteId}_${category}`;
    
    const previewElement = document.getElementById(`preview-${uniqueId}`);
    const note = notes.find(n => n.id === noteId);
    
    if (!previewElement || !note) return;
    
    if (previewElement.classList.contains('expanded')) {
        // Collapse
        const preview = note.content.replace(/<[^>]*>/g, '');
        previewElement.innerHTML = preview.substring(0, 150) + '...';
        previewElement.style.fontFamily = note.font || "'Inter', sans-serif";
        previewElement.style.color = note.textColor || '#94a3b8';
        previewElement.classList.remove('expanded');
        buttonElement.textContent = currentLanguage === 'ko' ? 'ÎçîÎ≥¥Í∏∞' : 'Show more';
    } else {
        // Expand
        previewElement.innerHTML = note.content;
        previewElement.style.fontFamily = note.font || "'Inter', sans-serif";
        previewElement.style.color = note.textColor || '#94a3b8';
        previewElement.classList.add('expanded');
        buttonElement.textContent = currentLanguage === 'ko' ? 'Ï†ëÍ∏∞' : 'Show less';
    }
}

        function viewNote(noteId) {
            const note = notes.find(n => n.id === noteId);
            if (!note) return;
            
            currentViewingNoteId = noteId;
            
            document.getElementById('noteViewTitle').textContent = note.title;
            document.getElementById('noteViewContent').innerHTML = note.content;
            
            // Ìè∞Ìä∏ÏôÄ ÏÉâÏÉÅ Ï†ÅÏö©
            const viewContent = document.getElementById('noteViewContent');
            viewContent.style.fontFamily = note.font || "'Inter', sans-serif";
            viewContent.style.color = note.textColor || '#e4e4e7';
            
            // Show view mode, hide other sections
            document.getElementById('noteViewMode').style.display = 'block';
            document.getElementById('noteEditor').style.display = 'none';
            document.querySelectorAll('.note-section').forEach(section => {
                section.style.display = 'none';
            });
        }

        function backToNotesList() {
            currentViewingNoteId = null;
            editingNoteId = null;
            
            document.getElementById('noteViewMode').style.display = 'none';
            document.getElementById('noteEditor').style.display = 'none';
            
            // Î™®Îì† ÏÑπÏÖò Ïà®Í∏∞Í∏∞
            document.querySelectorAll('.note-section').forEach(section => {
                section.style.display = 'none';
                section.classList.remove('active');
            });
            
            // ÌòÑÏû¨ Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÑπÏÖòÎßå ÌëúÏãú
            const targetSection = document.getElementById(`${currentNotesSection}NotesSection`);
            if (targetSection) {
                targetSection.style.display = 'block';
                targetSection.classList.add('active');
            }
        }
        
        function editCurrentNote() {
            if (currentViewingNoteId) {
                editNote(currentViewingNoteId);
            }
        }

        function togglePinNote(noteId) {
            const noteIndex = notes.findIndex(n => n.id === noteId);
            if (noteIndex !== -1) {
                notes[noteIndex].pinned = !notes[noteIndex].pinned;
                saveNotes();
                renderAllNotesSections();
                
                const message = notes[noteIndex].pinned ? 
                    (currentLanguage === 'ko' ? 'ÎÖ∏Ìä∏Í∞Ä ÏÉÅÎã®Ïóê Í≥†Ï†ïÎêòÏóàÏäµÎãàÎã§' : 'Note pinned to top') :
                    (currentLanguage === 'ko' ? 'ÎÖ∏Ìä∏ Í≥†Ï†ïÏù¥ Ìï¥Ï†úÎêòÏóàÏäµÎãàÎã§' : 'Note unpinned');
                
                showToast(message);
            }
        }
   


        // Page initialization
        document.addEventListener('DOMContentLoaded', async function() {
    await waitForChart();
    const savedLanguage = localStorage.getItem('tradingPlatformLanguage');
    if (savedLanguage) {
        currentLanguage = savedLanguage;
        // document.getElementById('languageSelect').value = currentLanguage; // Ïù¥ Ï§Ñ ÏÇ≠Ï†ú
        document.getElementById('settingsLanguageSelect').value = currentLanguage;
    }
            
            // Load daily fees
            const savedFees = localStorage.getItem('tradingPlatformDailyFees');
            if (savedFees) {
                dailyFees = JSON.parse(savedFees);
            }
            
            currentTradingDate = getESTTradingDate(new Date());
            updateCurrentDateDisplay();
            updateLanguage();
            
            loadTrades();
            loadNotes();
            loadPsychologyData();
            updateStats();
            renderCalendar();
            renderAllNotesSections();
            updateAllTradesList();
            updateDetailedAnalytics();
            calculateHoldingTime();
            loadDailyFees();
            
            document.getElementById('tradeForm').addEventListener('submit', handleTradeSubmit);
            document.getElementById('editTradeForm').addEventListener('submit', handleEditTradeSubmit);
            document.getElementById('entryTime').addEventListener('change', calculateHoldingTime);
            document.getElementById('exitTime').addEventListener('change', calculateHoldingTime);
            
            // Dashboard date range listeners
            document.getElementById('dashboardStartDate').addEventListener('change', function() {
                dashboardStartDate = this.value;
                updateStats();
                updateTradesTable(getFilteredDashboardTrades(), 'tradesTableBody');
            });
            
            document.getElementById('dashboardEndDate').addEventListener('change', function() {
                dashboardEndDate = this.value;
                updateStats();
                updateTradesTable(getFilteredDashboardTrades(), 'tradesTableBody');
            });

            // Analytics date range listeners
            document.getElementById('analyticsStartDate').addEventListener('change', function() {
                analyticsStartDate = this.value;
                updateDetailedAnalytics();
            });
            
            document.getElementById('analyticsEndDate').addEventListener('change', function() {
                analyticsEndDate = this.value;
                updateDetailedAnalytics();
            });

            // Trades page date range listeners
            document.getElementById('tradesStartDate').addEventListener('change', function() {
                tradesStartDate = this.value;
                updateAllTradesList();
            });
            
            document.getElementById('tradesEndDate').addEventListener('change', function() {
                tradesEndDate = this.value;
                updateAllTradesList();
            });
            
            document.getElementById('datePickerModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeDatePicker();
                }
            });

            document.getElementById('editTradeModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeEditTradeModal();
                }
            });

            document.getElementById('monthDetailsModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeMonthDetails();
                }
            });

            document.getElementById('weekDetailsModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeWeekDetails();
                }
            });
        });

        // Calendar related functions
        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            const year = calendarDate.getFullYear();
            const month = calendarDate.getMonth();
            
            const monthNames = currentLanguage === 'ko' ? 
                ['1Ïõî', '2Ïõî', '3Ïõî', '4Ïõî', '5Ïõî', '6Ïõî', '7Ïõî', '8Ïõî', '9Ïõî', '10Ïõî', '11Ïõî', '12Ïõî'] :
                ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            
            document.getElementById('calendarTitle').textContent = `${monthNames[month]} ${year}`;
            
            const firstDay = new Date(year, month, 1);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            const existingDays = grid.querySelectorAll('.calendar-day, .calendar-week-pnl');
            existingDays.forEach(day => day.remove());
            
            const showWeekPnl = window.innerWidth > 768;
            const header = document.getElementById('weekPnlHeader');
            
            if (showWeekPnl) {
                grid.classList.add('expanded');
                if (header) header.style.display = 'block';
            } else {
                grid.classList.remove('expanded');
                if (header) header.style.display = 'none';
            }
            
            updateCalendarStats();
            
            // Í∏∞Ï°¥ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï†úÍ±∞
            document.removeEventListener('mouseup', endRangeSelection);
            
            for (let week = 0; week < 6; week++) {
                let weekTrades = [];
                let weekPnl = 0;
                
                for (let day = 0; day < 7; day++) {
                    const currentDate = new Date(startDate);
                    currentDate.setDate(startDate.getDate() + (week * 7) + day);
                    
                    const dayElement = document.createElement('div');
                    dayElement.className = 'calendar-day';
                    
                    const estDate = getESTTradingDate(currentDate);
                    const dateString = formatTradingDate(estDate);
                    dayElement.dataset.date = dateString;
                    
                    const isCurrentMonth = currentDate.getMonth() === month;
                    const isToday = currentDate.toDateString() === new Date().toDateString();
                    
                    if (!isCurrentMonth) {
                        dayElement.classList.add('other-month');
                    }
                    
                    if (isToday) {
                        dayElement.classList.add('today');
                    }
                    
                    const dayNumber = document.createElement('div');
                    dayNumber.className = 'calendar-day-number';
                    dayNumber.textContent = estDate.getDate();
                    dayElement.appendChild(dayNumber);
                    
                    const dayTrades = trades.filter(trade => trade.date === dateString);
                    
                    if (dayTrades.length > 0) {
                        const tradePnL = dayTrades.reduce((sum, trade) => sum + trade.pnl, 0);
                        const dailyFee = dailyFees[dateString] || 0;
                        const totalPnL = tradePnL - dailyFee;
                        weekPnl += totalPnL;
                        weekTrades = weekTrades.concat(dayTrades);
                        
                        const pnlElement = document.createElement('div');
                        pnlElement.className = `calendar-day-pnl ${totalPnL > 0 ? 'positive' : totalPnL < 0 ? 'negative' : 'neutral'}`;
                        pnlElement.textContent = `$${totalPnL.toFixed(0)}`;
                        dayElement.appendChild(pnlElement);
                        
                        const tradesElement = document.createElement('div');
                        tradesElement.className = 'calendar-day-trades';
                        const tradeText = currentLanguage === 'ko' ? 'Í±∞Îûò' : 'trade';
                        tradesElement.textContent = `${dayTrades.length} ${tradeText}${dayTrades.length !== 1 && currentLanguage !== 'ko' ? 's' : ''}`;
                        dayElement.appendChild(tradesElement);
                    }
                    
                    dayElement.addEventListener('click', function(e) {
                        e.stopPropagation();
                        selectCalendarDay(dateString, dayTrades);
                    });
                    
                    dayElement.addEventListener('mousedown', function(e) {
                        e.preventDefault();
                        startRangeSelection(dateString);
                    });
                    
                    dayElement.addEventListener('mouseenter', function() {
                        if (isSelecting) {
                            updateRangeSelection(dateString);
                        }
                    });
                    
                    grid.appendChild(dayElement);
                }
                
                if (showWeekPnl) {
                    const weekPnlElement = document.createElement('div');
                    weekPnlElement.className = 'calendar-week-pnl';
                    
                    if (weekTrades.length > 0) {
                        weekPnlElement.onclick = () => showWeekDetails(week + 1, weekTrades, weekPnl);
                        
                        const weekPnlValue = document.createElement('div');
                        weekPnlValue.className = `week-pnl-value ${weekPnl > 0 ? 'positive' : weekPnl < 0 ? 'negative' : 'neutral'}`;
                        weekPnlValue.textContent = `$${weekPnl.toFixed(0)}`;
                        weekPnlElement.appendChild(weekPnlValue);
                        
                        const weekTradesCount = document.createElement('div');
                        weekTradesCount.className = 'week-trades-count';
                        const tradeText = currentLanguage === 'ko' ? 'Í±∞Îûò' : 'trades';
                        weekTradesCount.textContent = `${weekTrades.length} ${tradeText}`;
                        weekPnlElement.appendChild(weekTradesCount);
                    }
                    
                    grid.appendChild(weekPnlElement);
                }
            }
            
            // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑàÎ•º Ìïú Î≤àÎßå Îì±Î°ù
            document.addEventListener('mouseup', endRangeSelection);
            
            renderAnnualHeatmap();
        }

        function selectCalendarDay(dateString, dayTrades) {
            selectedCalendarDay = dateString;
            
            document.querySelectorAll('.calendar-day').forEach(day => {
                day.classList.remove('selected');
            });
            
            const selectedDay = document.querySelector(`[data-date="${dateString}"]`);
            if (selectedDay) {
                selectedDay.classList.add('selected');
            }
            
            showDayDetails(dateString, dayTrades);
        }

        function showDayDetails(dateString, dayTrades) {
            const dayDetails = document.getElementById('dayDetails');
            const dayDetailsTitle = document.getElementById('dayDetailsTitle');
            const dayTradesList = document.getElementById('dayTradesList');
            
            const date = new Date(dateString);
            const formattedDate = date.toLocaleDateString(currentLanguage === 'ko' ? 'ko-KR' : 'en-US', {
                month: 'short',
                day: 'numeric',
                year: 'numeric'
            });
            
            dayDetailsTitle.textContent = formattedDate;
            
            if (dayTrades.length === 0) {
                dayTradesList.innerHTML = `
                    <div class="empty-state">
                        <div style="color: #64748b; font-size: 12px;">
                            ${currentLanguage === 'ko' ? 'Ïù¥ ÎÇ† Í±∞ÎûòÍ∞Ä ÏóÜÏäµÎãàÎã§' : 'No trades on this day'}
                        </div>
                    </div>
                `;
            } else {
                // Ìã∞Ïª§Î≥ÑÎ°ú Í±∞ÎûòÎ•º ÏßëÍ≥Ñ
                const tickerStats = {};
                
                dayTrades.forEach(trade => {
                    const symbol = trade.symbol;
                    if (!tickerStats[symbol]) {
                        tickerStats[symbol] = {
                            totalShares: 0,
                            totalCost: 0,
                            totalPnL: 0,
                            tradeCount: 0
                        };
                    }
                    
                    const shares = trade.shares || (trade.amount && trade.buyPrice ? Math.round(trade.amount / trade.buyPrice) : 0);
                    tickerStats[symbol].totalShares += shares;
                    tickerStats[symbol].totalCost += shares * trade.buyPrice;
                    tickerStats[symbol].totalPnL += trade.pnl;
                    tickerStats[symbol].tradeCount++;
                });
                
                // Ìã∞Ïª§Î≥Ñ Ï†ïÎ≥¥Î•º P/L ÏàúÏúºÎ°ú Ï†ïÎ†¨
                const sortedTickers = Object.entries(tickerStats)
                    .sort((a, b) => b[1].totalPnL - a[1].totalPnL);
                
                dayTradesList.innerHTML = sortedTickers.map(([symbol, stats]) => {
                    const avgCostBasis = stats.totalCost / stats.totalShares;
                    return `
                        <div class="day-trade-item">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                <span class="trade-symbol">${symbol}</span>
                                <span class="trade-pnl ${stats.totalPnL >= 0 ? 'positive' : 'negative'}">$${stats.totalPnL.toFixed(2)}</span>
                            </div>
                            <div style="font-size: 11px; color: #64748b;">
                                ${currentLanguage === 'ko' ? 'Cost Basis' : 'Cost Basis'}: $${avgCostBasis.toFixed(2)} | ${stats.tradeCount} ${currentLanguage === 'ko' ? 'Í±∞Îûò' : 'trade'}${stats.tradeCount !== 1 && currentLanguage !== 'ko' ? 's' : ''}
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            dayDetails.style.display = 'block';
        }

        function startRangeSelection(dateString) {
            isSelecting = true;
            calendarStartDate = dateString;
            calendarEndDate = dateString;
            updateRangeVisual();
        }

        function updateRangeSelection(dateString) {
            if (isSelecting) {
                calendarEndDate = dateString;
                updateRangeVisual();
            }
        }

        function endRangeSelection() {
            if (isSelecting) {
                isSelecting = false;
                updateCalendarStats();
            }
        }

        function updateRangeVisual() {
            document.querySelectorAll('.calendar-day').forEach(day => {
                day.classList.remove('range-start', 'range-end', 'in-range');
            });
            
            if (calendarStartDate && calendarEndDate) {
                const start = new Date(calendarStartDate);
                const end = new Date(calendarEndDate);
                
                const actualStart = start <= end ? start : end;
                const actualEnd = start <= end ? end : start;
                
                document.querySelectorAll('.calendar-day').forEach(day => {
                    const dayDate = new Date(day.dataset.date);
                    
                    if (dayDate.getTime() === actualStart.getTime()) {
                        day.classList.add('range-start');
                    } else if (dayDate.getTime() === actualEnd.getTime()) {
                        day.classList.add('range-end');
                    } else if (dayDate > actualStart && dayDate < actualEnd) {
                        day.classList.add('in-range');
                    }
                });
            }
        }

        function changeMonth(direction) {
            calendarDate.setMonth(calendarDate.getMonth() + direction);
            renderCalendar();
        }

        function clearCalendarRange() {
            calendarStartDate = null;
            calendarEndDate = null;
            selectedCalendarDay = null;
            selectedWeekPnl = null;
            
            document.querySelectorAll('.calendar-day').forEach(day => {
                day.classList.remove('selected', 'range-start', 'range-end', 'in-range');
            });
            
            document.querySelectorAll('.calendar-week-pnl').forEach(weekEl => {
                weekEl.classList.remove('selected');
            });
            
            document.getElementById('dayDetails').style.display = 'none';
            updateCalendarStats();
        }

        function updateCalendarStats() {
            let filteredTrades = trades;
            let periodLabel = currentLanguage === 'ko' ? 'ÌòÑÏû¨ Ïõî' : 'Current Month';
            let showBestWorst = false;
            
            if (calendarStartDate && calendarEndDate) {
                const start = new Date(calendarStartDate);
                const end = new Date(calendarEndDate);
                const actualStart = start <= end ? start : end;
                const actualEnd = start <= end ? end : start;
                
                filteredTrades = trades.filter(trade => {
                    const tradeDate = new Date(trade.date);
                    return tradeDate >= actualStart && tradeDate <= actualEnd;
                });
                
                const startStr = actualStart.toLocaleDateString(currentLanguage === 'ko' ? 'ko-KR' : 'en-US', { month: 'short', day: 'numeric' });
                const endStr = actualEnd.toLocaleDateString(currentLanguage === 'ko' ? 'ko-KR' : 'en-US', { month: 'short', day: 'numeric' });
                periodLabel = `${startStr} - ${endStr}`;
                showBestWorst = true; // Î≤îÏúÑÏÑ†ÌÉùÏùº ÎïåÎßå ÏµúÍ≥†/ÏµúÏïÖÏùò ÎÇ† ÌëúÏãú
            } else {
                const year = calendarDate.getFullYear();
                const month = calendarDate.getMonth();
                const monthStr = `${year}-${String(month + 1).padStart(2, '0')}`;
                filteredTrades = trades.filter(trade => trade.date.startsWith(monthStr));
                
                const monthNames = currentLanguage === 'ko' ? 
                    ['1Ïõî', '2Ïõî', '3Ïõî', '4Ïõî', '5Ïõî', '6Ïõî', '7Ïõî', '8Ïõî', '9Ïõî', '10Ïõî', '11Ïõî', '12Ïõî'] :
                    ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
                periodLabel = `${monthNames[month]} ${year}`;
            }
            
            const totalTrades = filteredTrades.length;
            const tradePL = filteredTrades.reduce((sum, trade) => sum + trade.pnl, 0);
            
            const uniqueDatesInPeriod = [...new Set(filteredTrades.map(trade => trade.date))];
            const totalFeesInPeriod = uniqueDatesInPeriod.reduce((sum, date) => sum + (dailyFees[date] || 0), 0);
            const totalPL = tradePL - totalFeesInPeriod;
            
            const dailyStats = {};
            filteredTrades.forEach(trade => {
                if (!dailyStats[trade.date]) {
                    dailyStats[trade.date] = 0;
                }
                dailyStats[trade.date] += trade.pnl;
            });
            
            Object.keys(dailyStats).forEach(date => {
                dailyStats[date] -= (dailyFees[date] || 0);
            });
            
            const dailyPLs = Object.values(dailyStats);
            const avgDaily = dailyPLs.length > 0 ? dailyPLs.reduce((sum, pnl) => sum + pnl, 0) / dailyPLs.length : 0;
            
            document.getElementById('calendarPeriodLabel').textContent = periodLabel;
            document.getElementById('calendarTotalTrades').textContent = totalTrades;
            
            document.getElementById('calendarTotalPL').textContent = `$${totalPL.toFixed(2)}`;
            document.getElementById('calendarTotalPL').className = `calendar-stat-value ${totalPL >= 0 ? 'positive' : 'negative'}`;
            
            document.getElementById('calendarAvgDaily').textContent = `$${avgDaily.toFixed(2)}`;
            document.getElementById('calendarAvgDaily').className = `calendar-stat-value ${avgDaily >= 0 ? 'positive' : 'negative'}`;
            
            if (showBestWorst && dailyPLs.length > 0) {
                const bestDay = Math.max(...dailyPLs);
                const worstDay = dailyPLs.some(pnl => pnl < 0) ? Math.min(...dailyPLs) : Math.min(...dailyPLs);
                
                document.getElementById('calendarBestDay').textContent = `$${bestDay.toFixed(2)}`;
                // Î™®Îì† ÎÇ†Ïù¥ ÏàòÏùµÏùº ÎïåÎäî ÏµúÏïÖÏùò ÎÇ†ÏùÑ ÌëúÏãúÌïòÏßÄ ÏïäÏùå
                if (dailyPLs.some(pnl => pnl < 0)) {
                    document.getElementById('calendarWorstDay').textContent = `$${worstDay.toFixed(2)}`;
                } else {
                    document.getElementById('calendarWorstDay').textContent = '$0.00';
                }
            } else {
                document.getElementById('calendarBestDay').textContent = '-';
                document.getElementById('calendarWorstDay').textContent = '-';
            }
        }
        

        
        function toggleCustomRisk() {
    document.querySelectorAll('.risk-preset-btn').forEach(btn => {
        btn.classList.remove('active');
        btn.style.background = '#374151';
        btn.style.borderColor = '#4b5563';
        btn.style.color = '#e4e4e7';
    });
    
    event.target.classList.add('active');
    event.target.style.background = '#3b82f6';
    event.target.style.borderColor = '#3b82f6';
    event.target.style.color = 'white';
    
    const customInput = document.getElementById('customRiskInput');
    customInput.style.display = 'flex';
    document.getElementById('customRiskValue').focus();
}

function applyCustomRisk() {
    const customValue = parseFloat(document.getElementById('customRiskValue').value);
    if (customValue && customValue > 0 && customValue <= 100) {
        document.getElementById('riskPercentage').value = customValue;
        calculateRiskPosition();
    }
}
        
        // Annual Heatmap Functions
        // Annual Heatmap Functions
        function renderAnnualHeatmap() {
            const currentYear = calendarDate.getFullYear();
            const heatmapGrid = document.getElementById('annualHeatmapGrid');
            const heatmapTitle = document.getElementById('annualHeatmapTitle');
            
            if (!heatmapGrid || !heatmapTitle) return;
            
            const titleText = currentLanguage === 'ko' ? `${currentYear}ÎÖÑ Í±∞Îûò Í∞úÏöî` : `${currentYear} Trading Overview`;
            heatmapTitle.textContent = titleText;
            heatmapGrid.innerHTML = '';
            
            const monthNames = currentLanguage === 'ko' ? 
                ['1Ïõî', '2Ïõî', '3Ïõî', '4Ïõî', '5Ïõî', '6Ïõî', '7Ïõî', '8Ïõî', '9Ïõî', '10Ïõî', '11Ïõî', '12Ïõî'] :
                ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            
            // Í∑∏Î¶¨ÎìúÎ•º 4x3ÏúºÎ°ú Ïû¨ÏÑ§Ï†ï
            heatmapGrid.style.cssText = `
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 20px;
                margin-bottom: 20px;
            `;
            
            for (let month = 0; month < 12; month++) {
                const monthContainer = document.createElement('div');
                monthContainer.style.cssText = `
                    background: #0f172a;
                    border: 1px solid #334155;
                    border-radius: 8px;
                    padding: 16px;
                    cursor: pointer;
                    transition: all 0.2s ease;
                    min-height: 250px;
                `;
                
                if (month === calendarDate.getMonth() && currentYear === calendarDate.getFullYear()) {
                    monthContainer.style.borderColor = '#3b82f6';
                    monthContainer.style.background = 'rgba(59, 130, 246, 0.1)';
                }
                
                monthContainer.onclick = () => showMonthDetails(currentYear, month);
                
                // Ïõî Ìó§Îçî
                const monthHeader = document.createElement('div');
                monthHeader.style.cssText = `
                    color: #e4e4e7;
                    font-size: 14px;
                    font-weight: 600;
                    text-align: center;
                    margin-bottom: 8px;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                `;
                
                monthHeader.innerHTML = `
                    <span>${monthNames[month]}, ${currentYear}</span>
                    <span style="background: #374151; color: #94a3b8; padding: 2px 6px; border-radius: 4px; font-size: 11px;">Open</span>
                `;
                
                monthContainer.appendChild(monthHeader);
                
                // ÏöîÏùº Ìó§Îçî
                const weekDayHeader = document.createElement('div');
                weekDayHeader.style.cssText = `
                    display: grid;
                    grid-template-columns: repeat(7, 1fr);
                    gap: 2px;
                    margin-bottom: 4px;
                    font-size: 10px;
                    color: #64748b;
                    text-align: center;
                    font-weight: 500;
                `;
                
                const dayAbbrs = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                dayAbbrs.forEach(day => {
                    const dayHeader = document.createElement('div');
                    dayHeader.textContent = day;
                    dayHeader.style.cssText = 'padding: 2px;';
                    weekDayHeader.appendChild(dayHeader);
                });
                
                monthContainer.appendChild(weekDayHeader);
                
                // Îã¨Î†• Í∑∏Î¶¨Îìú
                const miniCalendar = document.createElement('div');
                miniCalendar.style.cssText = `
                    display: grid;
                    grid-template-columns: repeat(7, 1fr);
                    gap: 2px;
                    height: 120px;
                    margin-bottom: 12px;
                `;
                
                const firstDay = new Date(currentYear, month, 1);
                const daysInMonth = new Date(currentYear, month + 1, 0).getDate();
                const startPadding = firstDay.getDay();
                
                let monthPnl = 0;
                let monthTrades = 0;
                
                // Ïù¥Ï†Ñ Îã¨ Îπà ÏÖÄÎì§
                const prevMonth = month === 0 ? 11 : month - 1;
                const prevYear = month === 0 ? currentYear - 1 : currentYear;
                const prevMonthDays = new Date(prevYear, prevMonth + 1, 0).getDate();
                
                for (let i = startPadding - 1; i >= 0; i--) {
                    const dayNum = prevMonthDays - i;
                    const emptyDay = document.createElement('div');
                    emptyDay.style.cssText = `
                        width: 20px;
                        height: 16px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 10px;
                        color: #4b5563;
                        background: transparent;
                    `;
                    emptyDay.textContent = dayNum;
                    miniCalendar.appendChild(emptyDay);
                }
                
                // ÌòÑÏû¨ Îã¨ ÎÇ†ÏßúÎì§
                for (let day = 1; day <= daysInMonth; day++) {
                    const date = new Date(currentYear, month, day);
                    const dateString = formatTradingDate(date);
                    const dayTrades = trades.filter(trade => trade.date === dateString);
                    
                    const dayElement = document.createElement('div');
                    dayElement.style.cssText = `
                        width: 20px;
                        height: 16px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 10px;
                        font-weight: 500;
                        border-radius: 2px;
                        cursor: pointer;
                        transition: all 0.2s ease;
                        background: #334155;
                        color: #94a3b8;
                    `;
                    
                    dayElement.textContent = day;
                    
                    if (dayTrades.length > 0) {
                        const tradePnL = dayTrades.reduce((sum, trade) => sum + trade.pnl, 0);
                        const dailyFee = dailyFees[dateString] || 0;
                        const totalPnL = tradePnL - dailyFee;
                        
                        monthPnl += totalPnL;
                        monthTrades += dayTrades.length;
                        
                        if (totalPnL > 0) {
                            dayElement.style.background = '#10b981';
                            dayElement.style.color = 'white';
                        } else if (totalPnL < 0) {
                            dayElement.style.background = '#ef4444';
                            dayElement.style.color = 'white';
                        } else {
                            dayElement.style.background = '#f59e0b';
                            dayElement.style.color = 'white';
                        }
                        
                        dayElement.title = `${day}Ïùº: $${totalPnL.toFixed(0)} (${dayTrades.length} trades)`;
                    }
                    
                    dayElement.addEventListener('mouseenter', function() {
                        this.style.transform = 'scale(1.1)';
                        this.style.zIndex = '10';
                    });
                    
                    dayElement.addEventListener('mouseleave', function() {
                        this.style.transform = 'scale(1)';
                        this.style.zIndex = '1';
                    });
                    
                    miniCalendar.appendChild(dayElement);
                }
                
                // Îã§Ïùå Îã¨ Îπà ÏÖÄÎì§
                const totalCells = 42; // 6Ï£º * 7Ïùº
                const usedCells = startPadding + daysInMonth;
                const remainingCells = totalCells - usedCells;
                
                for (let day = 1; day <= Math.min(remainingCells, 14); day++) {
                    const emptyDay = document.createElement('div');
                    emptyDay.style.cssText = `
                        width: 20px;
                        height: 16px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 10px;
                        color: #4b5563;
                        background: transparent;
                    `;
                    emptyDay.textContent = day;
                    miniCalendar.appendChild(emptyDay);
                }
                
                monthContainer.appendChild(miniCalendar);
                
                // Ïõî ÌÜµÍ≥Ñ
                const monthStats = document.createElement('div');
                monthStats.style.cssText = `
                    text-align: center;
                    border-top: 1px solid #334155;
                    padding-top: 8px;
                `;
                
                const monthPnlElement = document.createElement('div');
                monthPnlElement.style.cssText = `
                    font-size: 14px;
                    font-weight: 700;
                    margin-bottom: 4px;
                    color: ${monthPnl > 0 ? '#10b981' : monthPnl < 0 ? '#ef4444' : '#64748b'};
                `;
                monthPnlElement.textContent = `$${monthPnl.toFixed(0)}`;
                monthStats.appendChild(monthPnlElement);
                
                const monthTradesElement = document.createElement('div');
                monthTradesElement.style.cssText = `
                    font-size: 11px;
                    color: #64748b;
                `;
                const tradeText = currentLanguage === 'ko' ? 'Í±∞Îûò' : 'trades';
                monthTradesElement.textContent = `${monthTrades} ${tradeText}`;
                monthStats.appendChild(monthTradesElement);
                
                monthContainer.appendChild(monthStats);
                heatmapGrid.appendChild(monthContainer);
            }
        }

        function showMonthDetails(year, month) {
            selectedMonthYear = year;
            selectedMonth = month;
            
            const monthNames = currentLanguage === 'ko' ? 
                ['1Ïõî', '2Ïõî', '3Ïõî', '4Ïõî', '5Ïõî', '6Ïõî', '7Ïõî', '8Ïõî', '9Ïõî', '10Ïõî', '11Ïõî', '12Ïõî'] :
                ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            
            document.getElementById('monthDetailsTitle').textContent = `${monthNames[month]} ${year}`;
            
            const monthStr = `${year}-${String(month + 1).padStart(2, '0')}`;
            const monthTrades = trades.filter(trade => trade.date.startsWith(monthStr));
            
            const tradePnL = monthTrades.reduce((sum, trade) => sum + trade.pnl, 0);
            const uniqueDates = [...new Set(monthTrades.map(trade => trade.date))];
            const totalFees = uniqueDates.reduce((sum, date) => sum + (dailyFees[date] || 0), 0);
            const totalPnL = tradePnL - totalFees;
            
            const wins = monthTrades.filter(trade => trade.pnl > 0);
            const winRate = monthTrades.length > 0 ? (wins.length / monthTrades.length) * 100 : 0;
            
            document.getElementById('monthDetailPnl').textContent = `$${totalPnL.toFixed(2)}`;
            document.getElementById('monthDetailPnl').className = `month-detail-stat-value ${totalPnL >= 0 ? 'positive' : 'negative'}`;
            
            document.getElementById('monthDetailTrades').textContent = monthTrades.length;
            
            document.getElementById('monthDetailWinRate').textContent = `${winRate.toFixed(1)}%`;
            document.getElementById('monthDetailWinRate').className = `month-detail-stat-value ${winRate >= 50 ? 'positive' : 'negative'}`;
            
            document.getElementById('monthDetailsModal').style.display = 'flex';
        }

        function closeMonthDetails() {
            document.getElementById('monthDetailsModal').style.display = 'none';
            selectedMonthYear = null;
            selectedMonth = null;
        }

        function navigateToMonth() {
            if (selectedMonthYear && selectedMonth !== null) {
                calendarDate = new Date(selectedMonthYear, selectedMonth, 1);
                renderCalendar();
                closeMonthDetails();
            }
        }

        // Í∏∞Ï°¥ showWeekDetails Ìï®ÏàòÎ•º ÏôÑÏ†ÑÌûà ÍµêÏ≤¥
        function showWeekDetails(weekNumber, weekTrades, weekPnl) {
            // Í∏∞Ï°¥ ÏÑ†ÌÉùÎêú week P/L Ï¥àÍ∏∞Ìôî
            document.querySelectorAll('.calendar-week-pnl').forEach(weekEl => {
                weekEl.classList.remove('selected');
            });
            
            // ÌòÑÏû¨ ÌÅ¥Î¶≠Ìïú week P/L ÏÑ†ÌÉù ÌëúÏãú
            event.target.closest('.calendar-week-pnl').classList.add('selected');
            selectedWeekPnl = { weekNumber, weekTrades, weekPnl };
            
            const year = calendarDate.getFullYear();
            const month = calendarDate.getMonth();
            const monthNames = currentLanguage === 'ko' ? 
                ['1Ïõî', '2Ïõî', '3Ïõî', '4Ïõî', '5Ïõî', '6Ïõî', '7Ïõî', '8Ïõî', '9Ïõî', '10Ïõî', '11Ïõî', '12Ïõî'] :
                ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            
            // Ï£ºÍ∞Ñ ÌÜµÍ≥Ñ Í≥ÑÏÇ∞
            const wins = weekTrades.filter(trade => trade.pnl > 0);
            const winRate = weekTrades.length > 0 ? (wins.length / weekTrades.length) * 100 : 0;
            
            // ÏùºÎ≥Ñ P/L Í≥ÑÏÇ∞ (ÏàòÏàòÎ£å Ìè¨Ìï®)
            const dailyStats = {};
            weekTrades.forEach(trade => {
                if (!dailyStats[trade.date]) {
                    dailyStats[trade.date] = 0;
                }
                dailyStats[trade.date] += trade.pnl;
            });
            
            // ÏàòÏàòÎ£å Ï†ÅÏö©
            Object.keys(dailyStats).forEach(date => {
                const fee = dailyFees[date] || 0;
                dailyStats[date] -= fee;
            });
            
            const dailyPLs = Object.values(dailyStats);
            const bestDay = dailyPLs.length > 0 ? Math.max(...dailyPLs) : 0;
            const worstDay = dailyPLs.length > 0 && dailyPLs.some(pnl => pnl < 0) ? Math.min(...dailyPLs) : 0;
            
            // Ìã∞Ïª§Î≥Ñ ÌÜµÍ≥Ñ Í≥ÑÏÇ∞
            const tickerStats = {};
            weekTrades.forEach(trade => {
                const symbol = trade.symbol;
                if (!tickerStats[symbol]) {
                    tickerStats[symbol] = {
                        totalShares: 0,
                        totalCost: 0,
                        totalPnL: 0,
                        tradeCount: 0
                    };
                }
                
                const shares = trade.shares || (trade.amount && trade.buyPrice ? Math.round(trade.amount / trade.buyPrice) : 0);
                tickerStats[symbol].totalShares += shares;
                tickerStats[symbol].totalCost += shares * trade.buyPrice;
                tickerStats[symbol].totalPnL += trade.pnl;
                tickerStats[symbol].tradeCount++;
            });
            
            // Ï£ºÍ∞ÑÏöîÏïΩ Ïπ∏ ÏóÖÎç∞Ïù¥Ìä∏
            const weekText = currentLanguage === 'ko' ? 
                `${monthNames[month]} ${weekNumber}Ï£ºÏ∞®` : 
                `Week ${weekNumber} of ${monthNames[month]}`;
                
            document.getElementById('selectedWeekLabel').textContent = weekText;
            document.getElementById('selectedWeekTrades').textContent = weekTrades.length;
            document.getElementById('selectedWeekPnl').textContent = `$${weekPnl.toFixed(2)}`;
            document.getElementById('selectedWeekPnl').className = `weekly-value ${weekPnl >= 0 ? 'positive' : 'negative'}`;
            document.getElementById('selectedWeekWinRate').textContent = `${winRate.toFixed(1)}%`;
            document.getElementById('selectedWeekWinRate').className = `weekly-value ${winRate >= 50 ? 'positive' : 'negative'}`;
            document.getElementById('selectedWeekBestDay').textContent = `$${bestDay.toFixed(2)}`;
            document.getElementById('selectedWeekWorstDay').textContent = worstDay < 0 ? `$${worstDay.toFixed(2)}` : '$0.00';
            
            // Í∏∞Ï°¥ ÏÉÅÏÑ∏ Ï†ïÎ≥¥ Ï†úÍ±∞
            let existingWeekDetails = document.getElementById('weekTickerDetails');
            if (existingWeekDetails) {
                existingWeekDetails.remove();
            }
            
            // Ìã∞Ïª§Î≥Ñ Ï†ïÎ≥¥Î•º P/L ÏàúÏúºÎ°ú Ï†ïÎ†¨
            const sortedTickers = Object.entries(tickerStats)
                .sort((a, b) => b[1].totalPnL - a[1].totalPnL);
            
            if (sortedTickers.length > 0) {
                const weekDetailsDiv = document.createElement('div');
                weekDetailsDiv.id = 'weekTickerDetails';
                weekDetailsDiv.style.cssText = `
                    margin-top: 20px;
                    padding-top: 20px;
                    border-top: 1px solid #334155;
                `;
                
                // ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò Î≥ÄÏàò (6Í∞úÏî©)
                const itemsPerPage = 6;
                const totalPages = Math.ceil(sortedTickers.length / itemsPerPage);
                let currentPage = 1;
                
                const detailsTitle = document.createElement('div');
                detailsTitle.style.cssText = `
                    color: #f8fafc;
                    font-size: 14px;
                    font-weight: 600;
                    margin-bottom: 12px;
                    text-align: center;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                `;
                
                const titleText = currentLanguage === 'ko' ? 'Ï£ºÍ∞Ñ Ìã∞Ïª§ ÏÉÅÏÑ∏' : 'Week Ticker Details';
                
                if (totalPages > 1) {
                    detailsTitle.innerHTML = `
                        <span>${titleText}</span>
                        <div style="display: flex; gap: 4px; align-items: center;">
                            <button id="weekPrevBtn" style="background: #374151; border: 1px solid #4b5563; color: #e4e4e7; padding: 4px 6px; border-radius: 3px; cursor: pointer; font-size: 11px;">‚Äπ</button>
                            <span id="weekPageInfo" style="font-size: 11px; color: #94a3b8; min-width: 30px; text-align: center;">1/${totalPages}</span>
                            <button id="weekNextBtn" style="background: #374151; border: 1px solid #4b5563; color: #e4e4e7; padding: 4px 6px; border-radius: 3px; cursor: pointer; font-size: 11px;">‚Ä∫</button>
                        </div>
                    `;
                } else {
                    detailsTitle.innerHTML = `<span>${titleText}</span>`;
                }
                
                weekDetailsDiv.appendChild(detailsTitle);
                
                const tickerList = document.createElement('div');
                tickerList.id = 'weekTickerList';
                weekDetailsDiv.appendChild(tickerList);
                
                // ÌéòÏù¥ÏßÄ Î†åÎçîÎßÅ Ìï®Ïàò
                function renderWeekPage() {
                    const startIndex = (currentPage - 1) * itemsPerPage;
                    const endIndex = Math.min(startIndex + itemsPerPage, sortedTickers.length);
                    const pageItems = sortedTickers.slice(startIndex, endIndex);
                    
                    tickerList.innerHTML = pageItems.map(([symbol, stats]) => {
                        const avgCostBasis = stats.totalCost / stats.totalShares;
                        return `
                            <div style="background: #0f172a; border: 1px solid #334155; border-radius: 6px; padding: 8px; margin-bottom: 8px; font-size: 12px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                    <span style="font-weight: 600; color: #e4e4e7;">${symbol}</span>
                                    <span style="font-weight: 600;" class="${stats.totalPnL >= 0 ? 'positive' : 'negative'}">$${stats.totalPnL.toFixed(2)}</span>
                                </div>
                                <div style="font-size: 11px; color: #64748b;">
                                    ${currentLanguage === 'ko' ? 'Cost Basis' : 'Cost Basis'}: $${avgCostBasis.toFixed(2)} | ${stats.tradeCount} ${currentLanguage === 'ko' ? 'Í±∞Îûò' : 'trade'}${stats.tradeCount !== 1 && currentLanguage !== 'ko' ? 's' : ''}
                                </div>
                            </div>
                        `;
                    }).join('');
                    
                    if (totalPages > 1) {
                        const pageInfo = document.getElementById('weekPageInfo');
                        const prevBtn = document.getElementById('weekPrevBtn');
                        const nextBtn = document.getElementById('weekNextBtn');
                        
                        if (pageInfo) pageInfo.textContent = `${currentPage}/${totalPages}`;
                        if (prevBtn) prevBtn.style.opacity = currentPage === 1 ? '0.5' : '1';
                        if (nextBtn) nextBtn.style.opacity = currentPage === totalPages ? '0.5' : '1';
                    }
                }
                
                // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä
                if (totalPages > 1) {
                    setTimeout(() => {
                        const prevBtn = document.getElementById('weekPrevBtn');
                        const nextBtn = document.getElementById('weekNextBtn');
                        
                        if (prevBtn) {
                            prevBtn.onclick = () => {
                                if (currentPage > 1) {
                                    currentPage--;
                                    renderWeekPage();
                                }
                            };
                        }
                        
                        if (nextBtn) {
                            nextBtn.onclick = () => {
                                if (currentPage < totalPages) {
                                    currentPage++;
                                    renderWeekPage();
                                }
                            };
                        }
                    }, 50);
                }
                
                renderWeekPage();
                document.getElementById('weeklySummary').parentNode.appendChild(weekDetailsDiv);
            }
            
            // Day details Ïà®Í∏∞Í∏∞
            document.getElementById('dayDetails').style.display = 'none';
        }
        
        function closeWeekDetails() {
            document.getElementById('weekDetailsModal').style.display = 'none';
        }

  </script>
 </body>
</html>
